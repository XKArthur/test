
// stats.js - http://github.com/mrdoob/stats.js
var Stats=function(){function h(a){c.appendChild(a.dom);return a}function k(a){for(var d=0;d<c.children.length;d++)c.children[d].style.display=d===a?"block":"none";l=a}var l=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";c.addEventListener("click",function(a){a.preventDefault();k(++l%c.children.length)},!1);var g=(performance||Date).now(),e=g,a=0,r=h(new Stats.Panel("FPS","#0ff","#002")),f=h(new Stats.Panel("MS","#0f0","#020"));
if(self.performance&&self.performance.memory)var t=h(new Stats.Panel("MB","#f08","#201"));k(0);return{REVISION:16,dom:c,addPanel:h,showPanel:k,begin:function(){g=(performance||Date).now()},end:function(){a++;var c=(performance||Date).now();f.update(c-g,200);if(c>e+1E3&&(r.update(1E3*a/(c-e),100),e=c,a=0,t)){var d=performance.memory;t.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return c},update:function(){g=this.end()},domElement:c,setMode:k}};
Stats.Panel=function(h,k,l){var c=Infinity,g=0,e=Math.round,a=e(window.devicePixelRatio||1),r=80*a,f=48*a,t=3*a,u=2*a,d=3*a,m=15*a,n=74*a,p=30*a,q=document.createElement("canvas");q.width=r;q.height=f;q.style.cssText="width:80px;height:48px";var b=q.getContext("2d");b.font="bold "+9*a+"px Helvetica,Arial,sans-serif";b.textBaseline="top";b.fillStyle=l;b.fillRect(0,0,r,f);b.fillStyle=k;b.fillText(h,t,u);b.fillRect(d,m,n,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d,m,n,p);return{dom:q,update:function(f,
v){c=Math.min(c,f);g=Math.max(g,f);b.fillStyle=l;b.globalAlpha=1;b.fillRect(0,0,r,m);b.fillStyle=k;b.fillText(e(f)+" "+h+" ("+e(c)+"-"+e(g)+")",t,u);b.drawImage(q,d+a,m,n-a,p,d,m,n-a,p);b.fillRect(d+n-a,m,a,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d+n-a,m,a,e((1-f/v)*p))}}};"object"===typeof module&&(module.exports=Stats);



/**
 * dat-gui JavaScript Controller Library
 * https://github.com/dataarts/dat.gui
 *
 * Copyright 2016 Data Arts Team, Google Creative Lab
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
 !function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.dat=t():e.dat=t()}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var i=n(1),r=o(i);e.exports=r["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=n(2),r=o(i),a=n(6),l=o(a),s=n(3),u=o(s),d=n(7),c=o(d),f=n(8),_=o(f),p=n(10),h=o(p),m=n(11),b=o(m),g=n(12),v=o(g),y=n(13),w=o(y),x=n(14),E=o(x),C=n(15),A=o(C),S=n(16),k=o(S),O=n(9),T=o(O),R=n(17),L=o(R);t["default"]={color:{Color:r["default"],math:l["default"],interpret:u["default"]},controllers:{Controller:c["default"],BooleanController:_["default"],OptionController:h["default"],StringController:b["default"],NumberController:v["default"],NumberControllerBox:w["default"],NumberControllerSlider:E["default"],FunctionController:A["default"],ColorController:k["default"]},dom:{dom:T["default"]},gui:{GUI:L["default"]},GUI:L["default"]}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(h.recalculateRGB(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(h.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function a(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(h.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(h.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}t.__esModule=!0;var l=n(3),s=o(l),u=n(6),d=o(u),c=n(4),f=o(c),_=n(5),p=o(_),h=function(){function e(){if(i(this,e),this.__state=s["default"].apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return e.prototype.toString=function(){return(0,f["default"])(this)},e.prototype.toHexString=function(){return(0,f["default"])(this,!0)},e.prototype.toOriginal=function(){return this.__state.conversion.write(this)},e}();h.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=d["default"].component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");p["default"].extend(e.__state,d["default"].hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},h.recalculateHSV=function(e){var t=d["default"].rgb_to_hsv(e.r,e.g,e.b);p["default"].extend(e.__state,{s:t.s,v:t.v}),p["default"].isNaN(t.h)?p["default"].isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},h.COMPONENTS=["r","g","b","h","s","v","hex","a"],r(h.prototype,"r",2),r(h.prototype,"g",1),r(h.prototype,"b",0),a(h.prototype,"h"),a(h.prototype,"s"),a(h.prototype,"v"),Object.defineProperty(h.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(h.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=d["default"].rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),t["default"]=h},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=n(4),r=o(i),a=n(5),l=o(a),s=[{litmus:l["default"].isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:r["default"]},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:r["default"]},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:r["default"]},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:r["default"]}}},{litmus:l["default"].isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:l["default"].isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:l["default"].isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(l["default"].isNumber(e.r)&&l["default"].isNumber(e.g)&&l["default"].isNumber(e.b)&&l["default"].isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(l["default"].isNumber(e.r)&&l["default"].isNumber(e.g)&&l["default"].isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(l["default"].isNumber(e.h)&&l["default"].isNumber(e.s)&&l["default"].isNumber(e.v)&&l["default"].isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(l["default"].isNumber(e.h)&&l["default"].isNumber(e.s)&&l["default"].isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],u=void 0,d=void 0,c=function(){d=!1;var e=arguments.length>1?l["default"].toArray(arguments):arguments[0];return l["default"].each(s,function(t){if(t.litmus(e))return l["default"].each(t.conversions,function(t,n){if(u=t.read(e),d===!1&&u!==!1)return d=u,u.conversionName=n,u.conversion=t,l["default"].BREAK}),l["default"].BREAK}),d};t["default"]=c},function(e,t){"use strict";t.__esModule=!0,t["default"]=function(e,t){var n=e.__state.conversionName.toString(),o=Math.round(e.r),i=Math.round(e.g),r=Math.round(e.b),a=e.a,l=Math.round(e.h),s=e.s.toFixed(1),u=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var d=e.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}return"CSS_RGB"===n?"rgb("+o+","+i+","+r+")":"CSS_RGBA"===n?"rgba("+o+","+i+","+r+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+o+","+i+","+r+"]":"RGBA_ARRAY"===n?"["+o+","+i+","+r+","+a+"]":"RGB_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+l+",s:"+s+",v:"+u+"}":"HSVA_OBJ"===n?"{h:"+l+",s:"+s+",v:"+u+",a:"+a+"}":"unknown format"}},function(e,t){"use strict";t.__esModule=!0;var n=Array.prototype.forEach,o=Array.prototype.slice,i={BREAK:{},extend:function(e){return this.each(o.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))},this),e},defaults:function(e){return this.each(o.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))},this),e},compose:function(){var e=o.call(arguments);return function(){for(var t=o.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,o){if(e)if(n&&e.forEach&&e.forEach===n)e.forEach(t,o);else if(e.length===e.length+0){var i=void 0,r=void 0;for(i=0,r=e.length;i<r;i++)if(i in e&&t.call(o,e[i],i)===this.BREAK)return}else for(var a in e)if(t.call(o,e[a],a)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t){var n=void 0;return function(){function o(){n=null}var i=this,r=arguments,a=!n;clearTimeout(n),n=setTimeout(o,t),a&&e.apply(i,r)}},toArray:function(e){return e.toArray?e.toArray():o.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}};t["default"]=i},function(e,t){"use strict";t.__esModule=!0;var n=void 0,o={hsv_to_rgb:function(e,t,n){var o=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),r=n*(1-t),a=n*(1-i*t),l=n*(1-(1-i)*t),s=[[n,l,r],[a,n,r],[r,n,l],[r,a,n],[l,r,n],[n,r,a]][o];return{r:255*s[0],g:255*s[1],b:255*s[2]}},rgb_to_hsv:function(e,t,n){var o=Math.min(e,t,n),i=Math.max(e,t,n),r=i-o,a=void 0,l=void 0;return 0===i?{h:NaN,s:0,v:0}:(l=r/i,a=e===i?(t-n)/r:t===i?2+(n-e)/r:4+(e-t)/r,a/=6,a<0&&(a+=1),{h:360*a,s:l,v:i/255})},rgb_to_hex:function(e,t,n){var o=this.hex_with_component(0,2,e);return o=this.hex_with_component(o,1,t),o=this.hex_with_component(o,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,o){return o<<(n=8*t)|e&~(255<<n)}};t["default"]=o},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var o=function(){function e(t,o){n(this,e),this.initialValue=t[o],this.domElement=document.createElement("div"),this.object=t,this.property=o,this.__onChange=void 0,this.__onFinishChange=void 0}return e.prototype.onChange=function(e){return this.__onChange=e,this},e.prototype.onFinishChange=function(e){return this.__onFinishChange=e,this},e.prototype.setValue=function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this},e.prototype.getValue=function(){return this.object[this.property]},e.prototype.updateDisplay=function(){return this},e.prototype.isModified=function(){return this.initialValue!==this.getValue()},e}();t["default"]=o},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var l=n(7),s=o(l),u=n(9),d=o(u),c=function(e){function t(n,o){function a(){s.setValue(!s.__prev)}i(this,t);var l=r(this,e.call(this,n,o)),s=l;return l.__prev=l.getValue(),l.__checkbox=document.createElement("input"),l.__checkbox.setAttribute("type","checkbox"),d["default"].bind(l.__checkbox,"change",a,!1),l.domElement.appendChild(l.__checkbox),l.updateDisplay(),l}return a(t,e),t.prototype.setValue=function(t){var n=e.prototype.setValue.call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n},t.prototype.updateDisplay=function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,e.prototype.updateDisplay.call(this)},t}(s["default"]);t["default"]=c},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e){if("0"===e||a["default"].isUndefined(e))return 0;var t=e.match(u);return a["default"].isNull(t)?0:parseFloat(t[1])}t.__esModule=!0;var r=n(5),a=o(r),l={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},s={};a["default"].each(l,function(e,t){a["default"].each(e,function(e){s[e]=t})});var u=/(\d+(\.\d+)?)px/,d={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var o=n,i=t;a["default"].isUndefined(i)&&(i=!0),a["default"].isUndefined(o)&&(o=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),o&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,o){var i=n||{},r=s[t];if(!r)throw new Error("Event type "+t+" not supported.");var l=document.createEvent(r);switch(r){case"MouseEvents":var u=i.x||i.clientX||0,d=i.y||i.clientY||0;l.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,u,d,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=l.initKeyboardEvent||l.initKeyEvent;a["default"].defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:l.initEvent(t,i.bubbles||!1,i.cancelable||!0)}a["default"].defaults(l,o),e.dispatchEvent(l)},bind:function(e,t,n,o){var i=o||!1;return e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on"+t,n),d},unbind:function(e,t,n,o){var i=o||!1;return e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent("on"+t,n),d},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);n.indexOf(t)===-1&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return d},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),o=n.indexOf(t);o!==-1&&(n.splice(o,1),e.className=n.join(" "))}else e.className=void 0;return d},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return i(t["border-left-width"])+i(t["border-right-width"])+i(t["padding-left"])+i(t["padding-right"])+i(t.width)},getHeight:function(e){var t=getComputedStyle(e);return i(t["border-top-width"])+i(t["border-bottom-width"])+i(t["padding-top"])+i(t["padding-bottom"])+i(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent;while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};t["default"]=d},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var l=n(7),s=o(l),u=n(9),d=o(u),c=n(5),f=o(c),_=function(e){function t(n,o,a){i(this,t);var l=r(this,e.call(this,n,o)),s=a,u=l;return l.__select=document.createElement("select"),f["default"].isArray(s)&&!function(){var e={};f["default"].each(s,function(t){e[t]=t}),s=e}(),f["default"].each(s,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),u.__select.appendChild(n)}),l.updateDisplay(),d["default"].bind(l.__select,"change",function(){var e=this.options[this.selectedIndex].value;u.setValue(e)}),l.domElement.appendChild(l.__select),l}return a(t,e),t.prototype.setValue=function(t){var n=e.prototype.setValue.call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n},t.prototype.updateDisplay=function(){return d["default"].isActive(this.__select)?this:(this.__select.value=this.getValue(),e.prototype.updateDisplay.call(this))},t}(s["default"]);t["default"]=_},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var l=n(7),s=o(l),u=n(9),d=o(u),c=function(e){function t(n,o){function a(){u.setValue(u.__input.value)}function l(){u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}i(this,t);var s=r(this,e.call(this,n,o)),u=s;return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),d["default"].bind(s.__input,"keyup",a),d["default"].bind(s.__input,"change",a),d["default"].bind(s.__input,"blur",l),d["default"].bind(s.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return a(t,e),t.prototype.updateDisplay=function(){return d["default"].isActive(this.__input)||(this.__input.value=this.getValue()),e.prototype.updateDisplay.call(this)},t}(s["default"]);t["default"]=c},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}t.__esModule=!0;var s=n(7),u=o(s),d=n(5),c=o(d),f=function(e){function t(n,o,a){i(this,t);var s=r(this,e.call(this,n,o)),u=a||{};return s.__min=u.min,s.__max=u.max,s.__step=u.step,c["default"].isUndefined(s.__step)?0===s.initialValue?s.__impliedStep=1:s.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(s.initialValue))/Math.LN10))/10:s.__impliedStep=s.__step,s.__precision=l(s.__impliedStep),s}return a(t,e),t.prototype.setValue=function(t){var n=t;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!==0&&(n=Math.round(n/this.__step)*this.__step),e.prototype.setValue.call(this,n)},t.prototype.min=function(e){return this.__min=e,this},t.prototype.max=function(e){return this.__max=e,this},t.prototype.step=function(e){return this.__step=e,this.__impliedStep=e,this.__precision=l(e),this},t}(u["default"]);t["default"]=f},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}t.__esModule=!0;var s=n(12),u=o(s),d=n(9),c=o(d),f=n(5),_=o(f),p=function(e){function t(n,o,a){function l(){var e=parseFloat(m.__input.value);_["default"].isNaN(e)||m.setValue(e)}function s(){m.__onFinishChange&&m.__onFinishChange.call(m,m.getValue())}function u(){s()}function d(e){var t=b-e.clientY;m.setValue(m.getValue()+t*m.__impliedStep),b=e.clientY}function f(){c["default"].unbind(window,"mousemove",d),c["default"].unbind(window,"mouseup",f),s()}function p(e){c["default"].bind(window,"mousemove",d),c["default"].bind(window,"mouseup",f),b=e.clientY}i(this,t);var h=r(this,e.call(this,n,o,a));h.__truncationSuspended=!1;var m=h,b=void 0;return h.__input=document.createElement("input"),h.__input.setAttribute("type","text"),c["default"].bind(h.__input,"change",l),c["default"].bind(h.__input,"blur",u),c["default"].bind(h.__input,"mousedown",p),c["default"].bind(h.__input,"keydown",function(e){13===e.keyCode&&(m.__truncationSuspended=!0,this.blur(),m.__truncationSuspended=!1,s())}),h.updateDisplay(),h.domElement.appendChild(h.__input),h}return a(t,e),t.prototype.updateDisplay=function(){return this.__input.value=this.__truncationSuspended?this.getValue():l(this.getValue(),this.__precision),e.prototype.updateDisplay.call(this)},t}(u["default"]);t["default"]=p},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t,n,o,i){return o+(i-o)*((e-t)/(n-t))}t.__esModule=!0;var s=n(12),u=o(s),d=n(9),c=o(d),f=function(e){function t(n,o,a,s,u){function d(e){document.activeElement.blur(),c["default"].bind(window,"mousemove",f),c["default"].bind(window,"mouseup",_),f(e)}function f(e){e.preventDefault();var t=h.__background.getBoundingClientRect();return h.setValue(l(e.clientX,t.left,t.right,h.__min,h.__max)),!1}function _(){c["default"].unbind(window,"mousemove",f),c["default"].unbind(window,"mouseup",_),h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}i(this,t);var p=r(this,e.call(this,n,o,{min:a,max:s,step:u})),h=p;return p.__background=document.createElement("div"),p.__foreground=document.createElement("div"),c["default"].bind(p.__background,"mousedown",d),c["default"].addClass(p.__background,"slider"),c["default"].addClass(p.__foreground,"slider-fg"),p.updateDisplay(),p.__background.appendChild(p.__foreground),p.domElement.appendChild(p.__background),p}return a(t,e),t.prototype.updateDisplay=function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",e.prototype.updateDisplay.call(this)},t}(u["default"]);t["default"]=f},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var l=n(7),s=o(l),u=n(9),d=o(u),c=function(e){function t(n,o,a){i(this,t);var l=r(this,e.call(this,n,o)),s=l;return l.__button=document.createElement("div"),l.__button.innerHTML=void 0===a?"Fire":a,d["default"].bind(l.__button,"click",function(e){return e.preventDefault(),s.fire(),!1}),d["default"].addClass(l.__button,"button"),l.domElement.appendChild(l.__button),l}return a(t,e),t.prototype.fire=function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())},t}(s["default"]);t["default"]=c},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t,n,o){e.style.background="",g["default"].each(y,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+o+" 100%); "})}function s(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}t.__esModule=!0;var u=n(7),d=o(u),c=n(9),f=o(c),_=n(2),p=o(_),h=n(3),m=o(h),b=n(5),g=o(b),v=function(e){function t(n,o){function a(e){h(e),f["default"].bind(window,"mousemove",h),f["default"].bind(window,"mouseup",u)}function u(){f["default"].unbind(window,"mousemove",h),f["default"].unbind(window,"mouseup",u),_()}function d(){var e=(0,m["default"])(this.value);e!==!1?(y.__color.__state=e,y.setValue(y.__color.toOriginal())):this.value=y.__color.toString()}function c(){f["default"].unbind(window,"mousemove",b),f["default"].unbind(window,"mouseup",c),_()}function _(){y.__onFinishChange&&y.__onFinishChange.call(y,y.__color.toOriginal())}function h(e){e.preventDefault();var t=y.__saturation_field.getBoundingClientRect(),n=(e.clientX-t.left)/(t.right-t.left),o=1-(e.clientY-t.top)/(t.bottom-t.top);return o>1?o=1:o<0&&(o=0),n>1?n=1:n<0&&(n=0),y.__color.v=o,y.__color.s=n,y.setValue(y.__color.toOriginal()),!1}function b(e){e.preventDefault();var t=y.__hue_field.getBoundingClientRect(),n=1-(e.clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),y.__color.h=360*n,y.setValue(y.__color.toOriginal()),!1}i(this,t);var v=r(this,e.call(this,n,o));v.__color=new p["default"](v.getValue()),v.__temp=new p["default"](0);var y=v;v.domElement=document.createElement("div"),f["default"].makeSelectable(v.domElement,!1),v.__selector=document.createElement("div"),v.__selector.className="selector",v.__saturation_field=document.createElement("div"),v.__saturation_field.className="saturation-field",v.__field_knob=document.createElement("div"),v.__field_knob.className="field-knob",v.__field_knob_border="2px solid ",v.__hue_knob=document.createElement("div"),v.__hue_knob.className="hue-knob",v.__hue_field=document.createElement("div"),v.__hue_field.className="hue-field",v.__input=document.createElement("input"),v.__input.type="text",v.__input_textShadow="0 1px 1px ",f["default"].bind(v.__input,"keydown",function(e){13===e.keyCode&&d.call(this)}),f["default"].bind(v.__input,"blur",d),f["default"].bind(v.__selector,"mousedown",function(){f["default"].addClass(this,"drag").bind(window,"mouseup",function(){f["default"].removeClass(y.__selector,"drag")})});var w=document.createElement("div");return g["default"].extend(v.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),g["default"].extend(v.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:v.__field_knob_border+(v.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),g["default"].extend(v.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),g["default"].extend(v.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),g["default"].extend(w.style,{width:"100%",height:"100%",background:"none"}),l(w,"top","rgba(0,0,0,0)","#000"),g["default"].extend(v.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),s(v.__hue_field),g["default"].extend(v.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:v.__input_textShadow+"rgba(0,0,0,0.7)"}),f["default"].bind(v.__saturation_field,"mousedown",a),f["default"].bind(v.__field_knob,"mousedown",a),f["default"].bind(v.__hue_field,"mousedown",function(e){b(e),f["default"].bind(window,"mousemove",b),f["default"].bind(window,"mouseup",c)}),v.__saturation_field.appendChild(w),v.__selector.appendChild(v.__field_knob),v.__selector.appendChild(v.__saturation_field),v.__selector.appendChild(v.__hue_field),v.__hue_field.appendChild(v.__hue_knob),v.domElement.appendChild(v.__input),v.domElement.appendChild(v.__selector),v.updateDisplay(),v}return a(t,e),t.prototype.updateDisplay=function(){var e=(0,m["default"])(this.getValue());if(e!==!1){var t=!1;g["default"].each(p["default"].COMPONENTS,function(n){if(!g["default"].isUndefined(e[n])&&!g["default"].isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&g["default"].extend(this.__color.__state,e)}g["default"].extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,o=255-n;g["default"].extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,l(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),g["default"].extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})},t}(d["default"]),y=["-moz-","-o-","-webkit-","-ms-",""];t["default"]=v},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n){var o=document.createElement("li");return t&&o.appendChild(t),n?e.__ul.insertBefore(o,n):e.__ul.appendChild(o),e.onResize(),o}function r(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];t?n.innerHTML=n.value+"*":n.innerHTML=n.value}function a(e,t,n){if(n.__li=t,n.__gui=e,U["default"].extend(n,{options:function(t){if(arguments.length>1){var o=n.__li.nextElementSibling;return n.remove(),s(e,n.object,n.property,{before:o,factoryArgs:[U["default"].toArray(arguments)]})}if(U["default"].isArray(t)||U["default"].isObject(t)){var i=n.__li.nextElementSibling;return n.remove(),s(e,n.object,n.property,{before:i,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){
  return n.__gui.remove(n),n}}),n instanceof B["default"])!function(){var e=new N["default"](n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});U["default"].each(["updateDisplay","onChange","onFinishChange","step"],function(t){var o=n[t],i=e[t];n[t]=e[t]=function(){var t=Array.prototype.slice.call(arguments);return i.apply(e,t),o.apply(n,t)}}),z["default"].addClass(t,"has-slider"),n.domElement.insertBefore(e.domElement,n.domElement.firstElementChild)}();else if(n instanceof N["default"]){var o=function(t){if(U["default"].isNumber(n.__min)&&U["default"].isNumber(n.__max)){var o=n.__li.firstElementChild.firstElementChild.innerHTML,i=n.__gui.__listening.indexOf(n)>-1;n.remove();var r=s(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return r.name(o),i&&r.listen(),r}return t};n.min=U["default"].compose(o,n.min),n.max=U["default"].compose(o,n.max)}else n instanceof O["default"]?(z["default"].bind(t,"click",function(){z["default"].fakeEvent(n.__checkbox,"click")}),z["default"].bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof R["default"]?(z["default"].bind(t,"click",function(){z["default"].fakeEvent(n.__button,"click")}),z["default"].bind(t,"mouseover",function(){z["default"].addClass(n.__button,"hover")}),z["default"].bind(t,"mouseout",function(){z["default"].removeClass(n.__button,"hover")})):n instanceof j["default"]&&(z["default"].addClass(t,"color"),n.updateDisplay=U["default"].compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=U["default"].compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&r(e.getRoot(),!0),t},n.setValue)}function l(e,t){var n=e.getRoot(),o=n.__rememberedObjects.indexOf(t.object);if(o!==-1){var i=n.__rememberedObjectIndecesToControllers[o];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[o]=i),i[t.property]=t,n.load&&n.load.remembered){var r=n.load.remembered,a=void 0;if(r[e.preset])a=r[e.preset];else{if(!r[Q])return;a=r[Q]}if(a[o]&&void 0!==a[o][t.property]){var l=a[o][t.property];t.initialValue=l,t.setValue(l)}}}}function s(e,t,n,o){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var r=void 0;if(o.color)r=new j["default"](t,n);else{var s=[t,n].concat(o.factoryArgs);r=C["default"].apply(e,s)}o.before instanceof S["default"]&&(o.before=o.before.__li),l(e,r),z["default"].addClass(r.domElement,"c");var u=document.createElement("span");z["default"].addClass(u,"property-name"),u.innerHTML=r.property;var d=document.createElement("div");d.appendChild(u),d.appendChild(r.domElement);var c=i(e,d,o.before);return z["default"].addClass(c,oe.CLASS_CONTROLLER_ROW),r instanceof j["default"]?z["default"].addClass(c,"color"):z["default"].addClass(c,g(r.getValue())),a(e,c,r),e.__controllers.push(r),r}function u(e,t){return document.location.href+"."+t}function d(e,t,n){var o=document.createElement("option");o.innerHTML=t,o.value=t,e.__preset_select.appendChild(o),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function c(e,t){t.style.display=e.useLocalStorage?"block":"none"}function f(e){var t=e.__save_row=document.createElement("li");z["default"].addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),z["default"].addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",z["default"].addClass(n,"button gears");var o=document.createElement("span");o.innerHTML="Save",z["default"].addClass(o,"button"),z["default"].addClass(o,"save");var i=document.createElement("span");i.innerHTML="New",z["default"].addClass(i,"button"),z["default"].addClass(i,"save-as");var r=document.createElement("span");r.innerHTML="Revert",z["default"].addClass(r,"button"),z["default"].addClass(r,"revert");var a=e.__preset_select=document.createElement("select");e.load&&e.load.remembered?U["default"].each(e.load.remembered,function(t,n){d(e,n,n===e.preset)}):d(e,Q,!1),z["default"].bind(a,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(a),t.appendChild(n),t.appendChild(o),t.appendChild(i),t.appendChild(r),q&&!function(){var t=document.getElementById("dg-local-explain"),n=document.getElementById("dg-local-storage"),o=document.getElementById("dg-save-locally");o.style.display="block","true"===localStorage.getItem(u(e,"isLocal"))&&n.setAttribute("checked","checked"),c(e,t),z["default"].bind(n,"change",function(){e.useLocalStorage=!e.useLocalStorage,c(e,t)})}();var l=document.getElementById("dg-new-constructor");z["default"].bind(l,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Z.hide()}),z["default"].bind(n,"click",function(){l.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),Z.show(),l.focus(),l.select()}),z["default"].bind(o,"click",function(){e.save()}),z["default"].bind(i,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),z["default"].bind(r,"click",function(){e.revert()})}function _(e){function t(t){return t.preventDefault(),e.width+=i-t.clientX,e.onResize(),i=t.clientX,!1}function n(){z["default"].removeClass(e.__closeButton,oe.CLASS_DRAG),z["default"].unbind(window,"mousemove",t),z["default"].unbind(window,"mouseup",n)}function o(o){return o.preventDefault(),i=o.clientX,z["default"].addClass(e.__closeButton,oe.CLASS_DRAG),z["default"].bind(window,"mousemove",t),z["default"].bind(window,"mouseup",n),!1}var i=void 0;e.__resize_handle=document.createElement("div"),U["default"].extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),z["default"].bind(e.__resize_handle,"mousedown",o),z["default"].bind(e.__closeButton,"mousedown",o),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function p(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function h(e,t){var n={};return U["default"].each(e.__rememberedObjects,function(o,i){var r={},a=e.__rememberedObjectIndecesToControllers[i];U["default"].each(a,function(e,n){r[n]=t?e.initialValue:e.getValue()}),n[i]=r}),n}function m(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}function b(e){0!==e.length&&D["default"].call(window,function(){b(e)}),U["default"].each(e,function(e){e.updateDisplay()})}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},v=n(18),y=o(v),w=n(19),x=o(w),E=n(20),C=o(E),A=n(7),S=o(A),k=n(8),O=o(k),T=n(15),R=o(T),L=n(13),N=o(L),M=n(14),B=o(M),H=n(16),j=o(H),P=n(21),D=o(P),V=n(22),F=o(V),I=n(9),z=o(I),G=n(5),U=o(G),X=n(23),K=o(X);y["default"].inject(K["default"]);var Y="dg",J=72,W=20,Q="Default",q=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}(),Z=void 0,$=!0,ee=void 0,te=!1,ne=[],oe=function ie(e){function t(){var e=n.getRoot();e.width+=1,U["default"].defer(function(){e.width-=1})}var n=this,o=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),z["default"].addClass(this.domElement,Y),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],o=U["default"].defaults(o,{autoPlace:!0,width:ie.DEFAULT_WIDTH}),o=U["default"].defaults(o,{resizable:o.autoPlace,hideable:o.autoPlace}),U["default"].isUndefined(o.load)?o.load={preset:Q}:o.preset&&(o.load.preset=o.preset),U["default"].isUndefined(o.parent)&&o.hideable&&ne.push(this),o.resizable=U["default"].isUndefined(o.parent)&&o.resizable,o.autoPlace&&U["default"].isUndefined(o.scrollable)&&(o.scrollable=!0);var r=q&&"true"===localStorage.getItem(u(this,"isLocal")),a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return o.parent}},scrollable:{get:function(){return o.scrollable}},autoPlace:{get:function(){return o.autoPlace}},preset:{get:function(){return n.parent?n.getRoot().preset:o.load.preset},set:function(e){n.parent?n.getRoot().preset=e:o.load.preset=e,m(this),n.revert()}},width:{get:function(){return o.width},set:function(e){o.width=e,p(n,e)}},name:{get:function(){return o.name},set:function(e){o.name=e,titleRowName&&(titleRowName.innerHTML=o.name)}},closed:{get:function(){return o.closed},set:function(e){o.closed=e,o.closed?z["default"].addClass(n.__ul,ie.CLASS_CLOSED):z["default"].removeClass(n.__ul,ie.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?ie.TEXT_OPEN:ie.TEXT_CLOSED)}},load:{get:function(){return o.load}},useLocalStorage:{get:function(){return r},set:function(e){q&&(r=e,e?z["default"].bind(window,"unload",a):z["default"].unbind(window,"unload",a),localStorage.setItem(u(n,"isLocal"),e))}}}),U["default"].isUndefined(o.parent)){if(o.closed=!1,z["default"].addClass(this.domElement,ie.CLASS_MAIN),z["default"].makeSelectable(this.domElement,!1),q&&r){n.useLocalStorage=!0;var l=localStorage.getItem(u(this,"gui"));l&&(o.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=ie.TEXT_CLOSED,z["default"].addClass(this.__closeButton,ie.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),z["default"].bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===o.closed&&(o.closed=!0);var s=document.createTextNode(o.name);z["default"].addClass(s,"controller-name");var d=i(n,s),c=function(e){return e.preventDefault(),n.closed=!n.closed,!1};z["default"].addClass(this.__ul,ie.CLASS_CLOSED),z["default"].addClass(d,"title"),z["default"].bind(d,"click",c),o.closed||(this.closed=!1)}o.autoPlace&&(U["default"].isUndefined(o.parent)&&($&&(ee=document.createElement("div"),z["default"].addClass(ee,Y),z["default"].addClass(ee,ie.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(ee),$=!1),ee.appendChild(this.domElement),z["default"].addClass(this.domElement,ie.CLASS_AUTO_PLACE)),this.parent||p(n,o.width)),this.__resizeHandler=function(){n.onResizeDebounced()},z["default"].bind(window,"resize",this.__resizeHandler),z["default"].bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),z["default"].bind(this.__ul,"transitionend",this.__resizeHandler),z["default"].bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),o.resizable&&_(this),a=function(){q&&"true"===localStorage.getItem(u(n,"isLocal"))&&localStorage.setItem(u(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=a,o.parent||t()};oe.toggleHide=function(){te=!te,U["default"].each(ne,function(e){e.domElement.style.display=te?"none":""})},oe.CLASS_AUTO_PLACE="a",oe.CLASS_AUTO_PLACE_CONTAINER="ac",oe.CLASS_MAIN="main",oe.CLASS_CONTROLLER_ROW="cr",oe.CLASS_TOO_TALL="taller-than-window",oe.CLASS_CLOSED="closed",oe.CLASS_CLOSE_BUTTON="close-button",oe.CLASS_DRAG="drag",oe.DEFAULT_WIDTH=245,oe.TEXT_CLOSED="Close Controls",oe.TEXT_OPEN="Open Controls",oe._keydownHandler=function(e){"text"===document.activeElement.type||e.which!==J&&e.keyCode!==J||oe.toggleHide()},z["default"].bind(window,"keydown",oe._keydownHandler,!1),U["default"].extend(oe.prototype,{add:function(e,t){return s(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return s(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;U["default"].defer(function(){t.onResize()})},destroy:function(){this.autoPlace&&ee.removeChild(this.domElement),z["default"].unbind(window,"keydown",oe._keydownHandler,!1),z["default"].unbind(window,"resize",this.__resizeHandler),this.saveToLocalStorageIfPossible&&z["default"].unbind(window,"unload",this.saveToLocalStorageIfPossible)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new oe(t);this.__folders[e]=n;var o=i(this,n.domElement);return z["default"].addClass(o,"folder"),n},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=z["default"].getOffset(e.__ul).top,n=0;U["default"].each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=z["default"].getHeight(t))}),window.innerHeight-t-W<n?(z["default"].addClass(e.domElement,oe.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-W+"px"):(z["default"].removeClass(e.domElement,oe.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&U["default"].defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:U["default"].debounce(function(){this.onResize()},200),remember:function(){if(U["default"].isUndefined(Z)&&(Z=new F["default"],Z.domElement.innerHTML=x["default"]),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;U["default"].each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&f(e),e.__rememberedObjects.indexOf(t)===-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&p(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=h(this)),e.folders={},U["default"].each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=h(this),r(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Q]=h(this,!0)),this.load.remembered[e]=h(this),this.preset=e,d(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){U["default"].each(this.__controllers,function(t){this.getRoot().load.remembered?l(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),U["default"].each(this.__folders,function(e){e.revert(e)}),e||r(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&b(this.__listening)},updateDisplay:function(){U["default"].each(this.__controllers,function(e){e.updateDisplay()}),U["default"].each(this.__folders,function(e){e.updateDisplay()})}}),e.exports=oe},function(e,t){"use strict";e.exports={load:function(e,t){var n=t||document,o=n.createElement("link");o.type="text/css",o.rel="stylesheet",o.href=e,n.getElementsByTagName("head")[0].appendChild(o)},inject:function(e,t){var n=t||document,o=document.createElement("style");o.type="text/css",o.innerHTML=e;var i=n.getElementsByTagName("head")[0];try{i.appendChild(o)}catch(r){}}}},function(e,t){e.exports="<div id=dg-save class=\"dg dialogue\"> Here's the new load parameter for your <code>GUI</code>'s constructor: <textarea id=dg-new-constructor></textarea> <div id=dg-save-locally> <input id=dg-local-storage type=checkbox /> Automatically save values to <code>localStorage</code> on exit. <div id=dg-local-explain>The values saved to <code>localStorage</code> will override those passed to <code>dat.GUI</code>'s constructor. This makes it easier to work incrementally, but <code>localStorage</code> is fragile, and your friends may not see the same values you do. </div> </div> </div>"},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=n(10),r=o(i),a=n(13),l=o(a),s=n(14),u=o(s),d=n(11),c=o(d),f=n(15),_=o(f),p=n(8),h=o(p),m=n(5),b=o(m),g=function(e,t){var n=e[t];return b["default"].isArray(arguments[2])||b["default"].isObject(arguments[2])?new r["default"](e,t,arguments[2]):b["default"].isNumber(n)?b["default"].isNumber(arguments[2])&&b["default"].isNumber(arguments[3])?b["default"].isNumber(arguments[4])?new u["default"](e,t,arguments[2],arguments[3],arguments[4]):new u["default"](e,t,arguments[2],arguments[3]):b["default"].isNumber(arguments[4])?new l["default"](e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new l["default"](e,t,{min:arguments[2],max:arguments[3]}):b["default"].isString(n)?new c["default"](e,t):b["default"].isFunction(n)?new _["default"](e,t,""):b["default"].isBoolean(n)?new h["default"](e,t):null};t["default"]=g},function(e,t){"use strict";function n(e){setTimeout(e,1e3/60)}t.__esModule=!0,t["default"]=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||n},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var r=n(9),a=o(r),l=n(5),s=o(l),u=function(){function e(){i(this,e),this.backgroundElement=document.createElement("div"),s["default"].extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),a["default"].makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),s["default"].extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;a["default"].bind(this.backgroundElement,"click",function(){t.hide()})}return e.prototype.show=function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),s["default"].defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})},e.prototype.hide=function t(){var e=this,t=function n(){e.domElement.style.display="none",e.backgroundElement.style.display="none",a["default"].unbind(e.domElement,"webkitTransitionEnd",n),a["default"].unbind(e.domElement,"transitionend",n),a["default"].unbind(e.domElement,"oTransitionEnd",n)};a["default"].bind(this.domElement,"webkitTransitionEnd",t),a["default"].bind(this.domElement,"transitionend",t),a["default"].bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},e.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-a["default"].getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-a["default"].getHeight(this.domElement)/2+"px"},e}();t["default"]=u},function(e,t,n){t=e.exports=n(24)(),t.push([e.id,".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1!important}.dg.main .close-button.drag,.dg.main:hover .close-button{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;transition:opacity .1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save>ul{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height .1s ease-out;transition:height .1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid transparent}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.boolean,.dg .cr.boolean *,.dg .cr.function,.dg .cr.function *,.dg .cr.function .property-name{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco,monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px Lucida Grande,sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid hsla(0,0%,100%,.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.boolean:hover,.dg .cr.function:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}",""])},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var n=this[t];n[2]?e.push("@media "+n[2]+"{"+n[1]+"}"):e.push(n[1])}return e.join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var o={},i=0;i<this.length;i++){var r=this[i][0];"number"==typeof r&&(o[r]=!0)}for(i=0;i<t.length;i++){var a=t[i];"number"==typeof a[0]&&o[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}}])});
  

 /*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/
!function(f){typeof module!='undefined'&&typeof exports=='object'?module.exports=f():typeof define!='undefined'&&define.amd?define(['fflate',f]):(typeof self!='undefined'?self:this).fflate=f()}(function(){var _e={};"use strict";var t=(typeof module!='undefined'&&typeof exports=='object'?function(_f){"use strict";var e,t=";var __w=require('worker_threads');__w.parentPort.on('message',function(m){onmessage({data:m})}),postMessage=function(m,t){__w.parentPort.postMessage(m,t)},close=process.exit;self=global";try{e=require("worker_threads").Worker}catch(e){}exports.default=e?function(r,n,o,a,s){var u=!1,i=new e(r+t,{eval:!0}).on("error",(function(e){return s(e,null)})).on("message",(function(e){return s(null,e)})).on("exit",(function(e){e&&!u&&s(Error("exited with code "+e),null)}));return i.postMessage(o,a),i.terminate=function(){return u=!0,e.prototype.terminate.call(i)},i}:function(e,t,r,n,o){setImmediate((function(){return o(Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)}));var a=function(){};return{terminate:a,postMessage:a}};return _f}:function(_f){"use strict";var e={},r=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},t=function(e){return new Worker(e)};try{URL.revokeObjectURL(r(""))}catch(e){r=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},t=function(e){return new Worker(e,{type:"module"})}}_f.default=function(n,o,u,a,c){var i=t(e[o]||(e[o]=r(n)));return i.onerror=function(e){return c(e.error,null)},i.onmessage=function(e){return c(null,e.data)},i.postMessage(u,a),i};return _f})({}),n=Uint8Array,r=Uint16Array,e=Uint32Array,i=new n([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),o=new n([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new n([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(t,n){for(var i=new r(31),o=0;o<31;++o)i[o]=n+=1<<t[o-1];var a=new e(i[30]);for(o=1;o<30;++o)for(var s=i[o];s<i[o+1];++s)a[s]=s-i[o]<<5|o;return[i,a]},f=s(i,2),u=f[0],h=f[1];u[28]=258,h[258]=28;for(var c=s(o,0),l=c[0],p=c[1],v=new r(32768),d=0;d<32768;++d){var g=(43690&d)>>>1|(21845&d)<<1;v[d]=((65280&(g=(61680&(g=(52428&g)>>>2|(13107&g)<<2))>>>4|(3855&g)<<4))>>>8|(255&g)<<8)>>>1}var w=function(t,n,e){for(var i=t.length,o=0,a=new r(n);o<i;++o)++a[t[o]-1];var s,f=new r(n);for(o=0;o<n;++o)f[o]=f[o-1]+a[o-1]<<1;if(e){s=new r(1<<n);var u=15-n;for(o=0;o<i;++o)if(t[o])for(var h=o<<4|t[o],c=n-t[o],l=f[t[o]-1]++<<c,p=l|(1<<c)-1;l<=p;++l)s[v[l]>>>u]=h}else for(s=new r(i),o=0;o<i;++o)t[o]&&(s[o]=v[f[t[o]-1]++]>>>15-t[o]);return s},y=new n(288);for(d=0;d<144;++d)y[d]=8;for(d=144;d<256;++d)y[d]=9;for(d=256;d<280;++d)y[d]=7;for(d=280;d<288;++d)y[d]=8;var m=new n(32);for(d=0;d<32;++d)m[d]=5;var b=w(y,9,0),x=w(y,9,1),z=w(m,5,0),k=w(m,5,1),M=function(t){for(var n=t[0],r=1;r<t.length;++r)t[r]>n&&(n=t[r]);return n},A=function(t,n,r){var e=n/8|0;return(t[e]|t[e+1]<<8)>>(7&n)&r},S=function(t,n){var r=n/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(7&n)},D=function(t){return(t/8|0)+(7&t&&1)},C=function(t,i,o){(null==i||i<0)&&(i=0),(null==o||o>t.length)&&(o=t.length);var a=new(t instanceof r?r:t instanceof e?e:n)(o-i);return a.set(t.subarray(i,o)),a},U=function(t,r,e){var s=t.length;if(!s||e&&!e.l&&s<5)return r||new n(0);var f=!r||e,h=!e||e.i;e||(e={}),r||(r=new n(3*s));var c=function(t){var e=r.length;if(t>e){var i=new n(Math.max(2*e,t));i.set(r),r=i}},p=e.f||0,v=e.p||0,d=e.b||0,g=e.l,y=e.d,m=e.m,b=e.n,z=8*s;do{if(!g){e.f=p=A(t,v,1);var U=A(t,v+1,3);if(v+=3,!U){var O=t[(Y=D(v)+4)-4]|t[Y-3]<<8,T=Y+O;if(T>s){if(h)throw"unexpected EOF";break}f&&c(d+O),r.set(t.subarray(Y,T),d),e.b=d+=O,e.p=v=8*T;continue}if(1==U)g=x,y=k,m=9,b=5;else{if(2!=U)throw"invalid block type";var Z=A(t,v,31)+257,I=A(t,v+10,15)+4,F=Z+A(t,v+5,31)+1;v+=14;for(var E=new n(F),G=new n(19),P=0;P<I;++P)G[a[P]]=A(t,v+3*P,7);v+=3*I;var j=M(G),q=(1<<j)-1,H=w(G,j,1);for(P=0;P<F;){var Y,B=H[A(t,v,q)];if(v+=15&B,(Y=B>>>4)<16)E[P++]=Y;else{var J=0,K=0;for(16==Y?(K=3+A(t,v,3),v+=2,J=E[P-1]):17==Y?(K=3+A(t,v,7),v+=3):18==Y&&(K=11+A(t,v,127),v+=7);K--;)E[P++]=J}}var L=E.subarray(0,Z),N=E.subarray(Z);m=M(L),b=M(N),g=w(L,m,1),y=w(N,b,1)}if(v>z){if(h)throw"unexpected EOF";break}}f&&c(d+131072);for(var Q=(1<<m)-1,R=(1<<b)-1,V=v;;V=v){var W=(J=g[S(t,v)&Q])>>>4;if((v+=15&J)>z){if(h)throw"unexpected EOF";break}if(!J)throw"invalid length/literal";if(W<256)r[d++]=W;else{if(256==W){V=v,g=null;break}var X=W-254;W>264&&(X=A(t,v,(1<<(tt=i[P=W-257]))-1)+u[P],v+=tt);var $=y[S(t,v)&R],_=$>>>4;if(!$)throw"invalid distance";if(v+=15&$,N=l[_],_>3){var tt=o[_];N+=S(t,v)&(1<<tt)-1,v+=tt}if(v>z){if(h)throw"unexpected EOF";break}f&&c(d+131072);for(var nt=d+X;d<nt;d+=4)r[d]=r[d-N],r[d+1]=r[d+1-N],r[d+2]=r[d+2-N],r[d+3]=r[d+3-N];d=nt}}e.l=g,e.p=V,e.b=d,g&&(p=1,e.m=m,e.d=y,e.n=b)}while(!p);return d==r.length?r:C(r,0,d)},O=function(t,n,r){var e=n/8|0;t[e]|=r<<=7&n,t[e+1]|=r>>>8},T=function(t,n,r){var e=n/8|0;t[e]|=r<<=7&n,t[e+1]|=r>>>8,t[e+2]|=r>>>16},Z=function(t,e){for(var i=[],o=0;o<t.length;++o)t[o]&&i.push({s:o,f:t[o]});var a=i.length,s=i.slice();if(!a)return[q,0];if(1==a){var f=new n(i[0].s+1);return f[i[0].s]=1,[f,1]}i.sort((function(t,n){return t.f-n.f})),i.push({s:-1,f:25001});var u=i[0],h=i[1],c=0,l=1,p=2;for(i[0]={s:-1,f:u.f+h.f,l:u,r:h};l!=a-1;)u=i[i[c].f<i[p].f?c++:p++],h=i[c!=l&&i[c].f<i[p].f?c++:p++],i[l++]={s:-1,f:u.f+h.f,l:u,r:h};var v=s[0].s;for(o=1;o<a;++o)s[o].s>v&&(v=s[o].s);var d=new r(v+1),g=I(i[l-1],d,0);if(g>e){o=0;var w=0,y=g-e,m=1<<y;for(s.sort((function(t,n){return d[n.s]-d[t.s]||t.f-n.f}));o<a;++o){var b=s[o].s;if(!(d[b]>e))break;w+=m-(1<<g-d[b]),d[b]=e}for(w>>>=y;w>0;){var x=s[o].s;d[x]<e?w-=1<<e-d[x]++-1:++o}for(;o>=0&&w;--o){var z=s[o].s;d[z]==e&&(--d[z],++w)}g=e}return[new n(d),g]},I=function(t,n,r){return-1==t.s?Math.max(I(t.l,n,r+1),I(t.r,n,r+1)):n[t.s]=r},F=function(t){for(var n=t.length;n&&!t[--n];);for(var e=new r(++n),i=0,o=t[0],a=1,s=function(t){e[i++]=t},f=1;f<=n;++f)if(t[f]==o&&f!=n)++a;else{if(!o&&a>2){for(;a>138;a-=138)s(32754);a>2&&(s(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(s(o),--a;a>6;a-=6)s(8304);a>2&&(s(a-3<<5|8208),a=0)}for(;a--;)s(o);a=1,o=t[f]}return[e.subarray(0,i),n]},E=function(t,n){for(var r=0,e=0;e<n.length;++e)r+=t[e]*n[e];return r},G=function(t,n,r){var e=r.length,i=D(n+2);t[i]=255&e,t[i+1]=e>>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var o=0;o<e;++o)t[i+o+4]=r[o];return 8*(i+4+e)},P=function(t,n,e,s,f,u,h,c,l,p,v){O(n,v++,e),++f[256];for(var d=Z(f,15),g=d[0],x=d[1],k=Z(u,15),M=k[0],A=k[1],S=F(g),D=S[0],C=S[1],U=F(M),I=U[0],P=U[1],j=new r(19),q=0;q<D.length;++q)j[31&D[q]]++;for(q=0;q<I.length;++q)j[31&I[q]]++;for(var H=Z(j,7),Y=H[0],B=H[1],J=19;J>4&&!Y[a[J-1]];--J);var K,L,N,Q,R=p+5<<3,V=E(f,y)+E(u,m)+h,W=E(f,g)+E(u,M)+h+14+3*J+E(j,Y)+(2*j[16]+3*j[17]+7*j[18]);if(R<=V&&R<=W)return G(n,v,t.subarray(l,l+p));if(O(n,v,1+(W<V)),v+=2,W<V){K=w(g,x,0),L=g,N=w(M,A,0),Q=M;var X=w(Y,B,0);for(O(n,v,C-257),O(n,v+5,P-1),O(n,v+10,J-4),v+=14,q=0;q<J;++q)O(n,v+3*q,Y[a[q]]);v+=3*J;for(var $=[D,I],_=0;_<2;++_){var tt=$[_];for(q=0;q<tt.length;++q)O(n,v,X[nt=31&tt[q]]),v+=Y[nt],nt>15&&(O(n,v,tt[q]>>>5&127),v+=tt[q]>>>12)}}else K=b,L=y,N=z,Q=m;for(q=0;q<c;++q)if(s[q]>255){var nt;T(n,v,K[257+(nt=s[q]>>>18&31)]),v+=L[nt+257],nt>7&&(O(n,v,s[q]>>>23&31),v+=i[nt]);var rt=31&s[q];T(n,v,N[rt]),v+=Q[rt],rt>3&&(T(n,v,s[q]>>>5&8191),v+=o[rt])}else T(n,v,K[s[q]]),v+=L[s[q]];return T(n,v,K[256]),v+L[256]},j=new e([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),q=new n(0),H=function(t,a,s,f,u,c){var l=t.length,v=new n(f+l+5*(1+Math.ceil(l/7e3))+u),d=v.subarray(f,v.length-u),g=0;if(!a||l<8)for(var w=0;w<=l;w+=65535){var y=w+65535;y<l?g=G(d,g,t.subarray(w,y)):(d[w]=c,g=G(d,g,t.subarray(w,l)))}else{for(var m=j[a-1],b=m>>>13,x=8191&m,z=(1<<s)-1,k=new r(32768),M=new r(z+1),A=Math.ceil(s/3),S=2*A,U=function(n){return(t[n]^t[n+1]<<A^t[n+2]<<S)&z},O=new e(25e3),T=new r(288),Z=new r(32),I=0,F=0,E=(w=0,0),H=0,Y=0;w<l;++w){var B=U(w),J=32767&w,K=M[B];if(k[J]=K,M[B]=J,H<=w){var L=l-w;if((I>7e3||E>24576)&&L>423){g=P(t,d,0,O,T,Z,F,E,Y,w-Y,g),E=I=F=0,Y=w;for(var N=0;N<286;++N)T[N]=0;for(N=0;N<30;++N)Z[N]=0}var Q=2,R=0,V=x,W=J-K&32767;if(L>2&&B==U(w-W))for(var X=Math.min(b,L)-1,$=Math.min(32767,w),_=Math.min(258,L);W<=$&&--V&&J!=K;){if(t[w+Q]==t[w+Q-W]){for(var tt=0;tt<_&&t[w+tt]==t[w+tt-W];++tt);if(tt>Q){if(Q=tt,R=W,tt>X)break;var nt=Math.min(W,tt-2),rt=0;for(N=0;N<nt;++N){var et=w-W+N+32768&32767,it=et-k[et]+32768&32767;it>rt&&(rt=it,K=et)}}}W+=(J=K)-(K=k[J])+32768&32767}if(R){O[E++]=268435456|h[Q]<<18|p[R];var ot=31&h[Q],at=31&p[R];F+=i[ot]+o[at],++T[257+ot],++Z[at],H=w+Q,++I}else O[E++]=t[w],++T[t[w]]}}g=P(t,d,c,O,T,Z,F,E,Y,w-Y,g),!c&&7&g&&(g=G(d,g+1,q))}return C(v,0,f+D(g)+u)},Y=function(){for(var t=new e(256),n=0;n<256;++n){for(var r=n,i=9;--i;)r=(1&r&&3988292384)^r>>>1;t[n]=r}return t}(),B=function(){var t=-1;return{p:function(n){for(var r=t,e=0;e<n.length;++e)r=Y[255&r^n[e]]^r>>>8;t=r},d:function(){return~t}}},J=function(){var t=1,n=0;return{p:function(r){for(var e=t,i=n,o=r.length,a=0;a!=o;){for(var s=Math.min(a+2655,o);a<s;++a)i+=e+=r[a];e=(65535&e)+15*(e>>16),i=(65535&i)+15*(i>>16)}t=e,n=i},d:function(){return(255&(t%=65521))<<24|t>>>8<<16|(255&(n%=65521))<<8|n>>>8}}},K=function(t,n,r,e,i){return H(t,null==n.level?6:n.level,null==n.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+n.mem,r,e,!i)},L=function(t,n){var r={};for(var e in t)r[e]=t[e];for(var e in n)r[e]=n[e];return r},N=function(t,n,r){for(var e=t(),i=""+t,o=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<e.length;++a){var s=e[a],f=o[a];if("function"==typeof s){n+=";"+f+"=";var u=""+s;if(s.prototype)if(-1!=u.indexOf("[native code]")){var h=u.indexOf(" ",8)+1;n+=u.slice(h,u.indexOf("(",h))}else for(var c in n+=u,s.prototype)n+=";"+f+".prototype."+c+"="+s.prototype[c];else n+=u}else r[f]=s}return[n,r]},Q=[],R=function(t){var i=[];for(var o in t)(t[o]instanceof n||t[o]instanceof r||t[o]instanceof e)&&i.push((t[o]=new t[o].constructor(t[o])).buffer);return i},V=function(n,r,e,i){var o;if(!Q[e]){for(var a="",s={},f=n.length-1,u=0;u<f;++u)a=(o=N(n[u],a,s))[0],s=o[1];Q[e]=N(n[f],a,s)}var h=L({},Q[e][1]);return t.default(Q[e][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+r+"}",e,h,R(h),i)},W=function(){return[n,r,e,i,o,a,u,l,x,k,v,w,M,A,S,D,C,U,At,rt,et]},X=function(){return[n,r,e,i,o,a,h,p,b,y,z,m,v,j,q,w,O,T,Z,I,F,E,G,P,D,C,H,K,xt,rt]},$=function(){return[ct,vt,ht,B,Y]},_=function(){return[lt,pt]},tt=function(){return[dt,ht,J]},nt=function(){return[gt]},rt=function(t){return postMessage(t,[t.buffer])},et=function(t){return t&&t.size&&new n(t.size)},it=function(t,n,r,e,i,o){var a=V(r,e,i,(function(t,n){a.terminate(),o(t,n)}));return a.postMessage([t,n],n.consume?[t.buffer]:[]),function(){a.terminate()}},ot=function(t){return t.ondata=function(t,n){return postMessage([t,n],[t.buffer])},function(n){return t.push(n.data[0],n.data[1])}},at=function(t,n,r,e,i){var o,a=V(t,e,i,(function(t,r){t?(a.terminate(),n.ondata.call(n,t)):(r[1]&&a.terminate(),n.ondata.call(n,t,r[0],r[1]))}));a.postMessage(r),n.push=function(t,r){if(o)throw"stream finished";if(!n.ondata)throw"no stream handler";a.postMessage([t,o=r],[t.buffer])},n.terminate=function(){a.terminate()}},st=function(t,n){return t[n]|t[n+1]<<8},ft=function(t,n){return(t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24)>>>0},ut=function(t,n){return ft(t,n)+4294967296*ft(t,n+4)},ht=function(t,n,r){for(;r;++n)t[n]=r,r>>>=8},ct=function(t,n){var r=n.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=n.level<2?4:9==n.level?2:0,t[9]=3,0!=n.mtime&&ht(t,4,Math.floor(new Date(n.mtime||Date.now())/1e3)),r){t[3]=8;for(var e=0;e<=r.length;++e)t[e+10]=r.charCodeAt(e)}},lt=function(t){if(31!=t[0]||139!=t[1]||8!=t[2])throw"invalid gzip data";var n=t[3],r=10;4&n&&(r+=t[10]|2+(t[11]<<8));for(var e=(n>>3&1)+(n>>4&1);e>0;e-=!t[r++]);return r+(2&n)},pt=function(t){var n=t.length;return(t[n-4]|t[n-3]<<8|t[n-2]<<16|t[n-1]<<24)>>>0},vt=function(t){return 10+(t.filename&&t.filename.length+1||0)},dt=function(t,n){var r=n.level,e=0==r?0:r<6?1:9==r?3:2;t[0]=120,t[1]=e<<6|(e?32-2*e:1)},gt=function(t){if(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(32&t[1])throw"invalid zlib data: preset dictionaries not supported"};function wt(t,n){return n||"function"!=typeof t||(n=t,t={}),this.ondata=n,t}var yt=function(){function t(t,n){n||"function"!=typeof t||(n=t,t={}),this.ondata=n,this.o=t||{}}return t.prototype.p=function(t,n){this.ondata(K(t,this.o,0,0,!n),n)},t.prototype.push=function(t,n){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=n,this.p(t,n||!1)},t}();_e.Deflate=yt;var mt=function(){return function(t,n){at([X,function(){return[ot,yt]}],this,wt.call(this,t,n),(function(t){var n=new yt(t.data);onmessage=ot(n)}),6)}}();function bt(t,n,r){if(r||(r=n,n={}),"function"!=typeof r)throw"no callback";return it(t,n,[X],(function(t){return rt(xt(t.data[0],t.data[1]))}),0,r)}function xt(t,n){return K(t,n||{},0,0)}_e.AsyncDeflate=mt,_e.deflate=bt,_e.deflateSync=xt;var zt=function(){function t(t){this.s={},this.p=new n(0),this.ondata=t}return t.prototype.e=function(t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var r=this.p.length,e=new n(r+t.length);e.set(this.p),e.set(t,r),this.p=e},t.prototype.c=function(t){this.d=this.s.i=t||!1;var n=this.s.b,r=U(this.p,this.o,this.s);this.ondata(C(r,n,this.s.b),this.d),this.o=C(r,this.s.b-32768),this.s.b=this.o.length,this.p=C(this.p,this.s.p/8|0),this.s.p&=7},t.prototype.push=function(t,n){this.e(t),this.c(n)},t}();_e.Inflate=zt;var kt=function(){return function(t){this.ondata=t,at([W,function(){return[ot,zt]}],this,0,(function(){var t=new zt;onmessage=ot(t)}),7)}}();function Mt(t,n,r){if(r||(r=n,n={}),"function"!=typeof r)throw"no callback";return it(t,n,[W],(function(t){return rt(At(t.data[0],et(t.data[1])))}),1,r)}function At(t,n){return U(t,n)}_e.AsyncInflate=kt,_e.inflate=Mt,_e.inflateSync=At;var St=function(){function t(t,n){this.c=B(),this.l=0,this.v=1,yt.call(this,t,n)}return t.prototype.push=function(t,n){yt.prototype.push.call(this,t,n)},t.prototype.p=function(t,n){this.c.p(t),this.l+=t.length;var r=K(t,this.o,this.v&&vt(this.o),n&&8,!n);this.v&&(ct(r,this.o),this.v=0),n&&(ht(r,r.length-8,this.c.d()),ht(r,r.length-4,this.l)),this.ondata(r,n)},t}();_e.Gzip=St,_e.Compress=St;var Dt=function(){return function(t,n){at([X,$,function(){return[ot,yt,St]}],this,wt.call(this,t,n),(function(t){var n=new St(t.data);onmessage=ot(n)}),8)}}();function Ct(t,n,r){if(r||(r=n,n={}),"function"!=typeof r)throw"no callback";return it(t,n,[X,$,function(){return[Ut]}],(function(t){return rt(Ut(t.data[0],t.data[1]))}),2,r)}function Ut(t,n){n||(n={});var r=B(),e=t.length;r.p(t);var i=K(t,n,vt(n),8),o=i.length;return ct(i,n),ht(i,o-8,r.d()),ht(i,o-4,e),i}_e.AsyncGzip=Dt,_e.AsyncCompress=Dt,_e.gzip=Ct,_e.compress=Ct,_e.gzipSync=Ut,_e.compressSync=Ut;var Ot=function(){function t(t){this.v=1,zt.call(this,t)}return t.prototype.push=function(t,n){if(zt.prototype.e.call(this,t),this.v){var r=this.p.length>3?lt(this.p):4;if(r>=this.p.length&&!n)return;this.p=this.p.subarray(r),this.v=0}if(n){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}zt.prototype.c.call(this,n)},t}();_e.Gunzip=Ot;var Tt=function(){return function(t){this.ondata=t,at([W,_,function(){return[ot,zt,Ot]}],this,0,(function(){var t=new Ot;onmessage=ot(t)}),9)}}();function Zt(t,n,r){if(r||(r=n,n={}),"function"!=typeof r)throw"no callback";return it(t,n,[W,_,function(){return[It]}],(function(t){return rt(It(t.data[0]))}),3,r)}function It(t,r){return U(t.subarray(lt(t),-8),r||new n(pt(t)))}_e.AsyncGunzip=Tt,_e.gunzip=Zt,_e.gunzipSync=It;var Ft=function(){function t(t,n){this.c=J(),this.v=1,yt.call(this,t,n)}return t.prototype.push=function(t,n){yt.prototype.push.call(this,t,n)},t.prototype.p=function(t,n){this.c.p(t);var r=K(t,this.o,this.v&&2,n&&4,!n);this.v&&(dt(r,this.o),this.v=0),n&&ht(r,r.length-4,this.c.d()),this.ondata(r,n)},t}();_e.Zlib=Ft;var Et=function(){return function(t,n){at([X,tt,function(){return[ot,yt,Ft]}],this,wt.call(this,t,n),(function(t){var n=new Ft(t.data);onmessage=ot(n)}),10)}}();function Gt(t,n,r){if(r||(r=n,n={}),"function"!=typeof r)throw"no callback";return it(t,n,[X,tt,function(){return[Pt]}],(function(t){return rt(Pt(t.data[0],t.data[1]))}),4,r)}function Pt(t,n){n||(n={});var r=J();r.p(t);var e=K(t,n,2,4);return dt(e,n),ht(e,e.length-4,r.d()),e}_e.AsyncZlib=Et,_e.zlib=Gt,_e.zlibSync=Pt;var jt=function(){function t(t){this.v=1,zt.call(this,t)}return t.prototype.push=function(t,n){if(zt.prototype.e.call(this,t),this.v){if(this.p.length<2&&!n)return;this.p=this.p.subarray(2),this.v=0}if(n){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}zt.prototype.c.call(this,n)},t}();_e.Unzlib=jt;var qt=function(){return function(t){this.ondata=t,at([W,nt,function(){return[ot,zt,jt]}],this,0,(function(){var t=new jt;onmessage=ot(t)}),11)}}();function Ht(t,n,r){if(r||(r=n,n={}),"function"!=typeof r)throw"no callback";return it(t,n,[W,nt,function(){return[Yt]}],(function(t){return rt(Yt(t.data[0],et(t.data[1])))}),5,r)}function Yt(t,n){return U((gt(t),t.subarray(2,-4)),n)}_e.AsyncUnzlib=qt,_e.unzlib=Ht,_e.unzlibSync=Yt;var Bt=function(){function t(t){this.G=Ot,this.I=zt,this.Z=jt,this.ondata=t}return t.prototype.push=function(t,r){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(t,r);else{if(this.p&&this.p.length){var e=new n(this.p.length+t.length);e.set(this.p),e.set(t,this.p.length)}else this.p=t;if(this.p.length>2){var i=this,o=function(){i.ondata.apply(i,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(o):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(o):new this.Z(o),this.s.push(this.p,r),this.p=null}}},t}();_e.Decompress=Bt;var Jt=function(){function t(t){this.G=Tt,this.I=kt,this.Z=qt,this.ondata=t}return t.prototype.push=function(t,n){Bt.prototype.push.call(this,t,n)},t}();function Kt(t,n,r){if(r||(r=n,n={}),"function"!=typeof r)throw"no callback";return 31==t[0]&&139==t[1]&&8==t[2]?Zt(t,n,r):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?Mt(t,n,r):Ht(t,n,r)}function Lt(t,n){return 31==t[0]&&139==t[1]&&8==t[2]?It(t,n):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?At(t,n):Yt(t,n)}_e.AsyncDecompress=Jt,_e.decompress=Kt,_e.decompressSync=Lt;var Nt=function(t,r,e,i){for(var o in t){var a=t[o],s=r+o;a instanceof n?e[s]=[a,i]:Array.isArray(a)?e[s]=[a[0],L(i,a[1])]:Nt(a,s+"/",e,i)}},Qt="undefined"!=typeof TextEncoder&&new TextEncoder,Rt="undefined"!=typeof TextDecoder&&new TextDecoder,Vt=0;try{Rt.decode(q,{stream:!0}),Vt=1}catch(t){}var Wt=function(t){for(var n="",r=0;;){var e=t[r++],i=(e>127)+(e>223)+(e>239);if(r+i>t.length)return[n,C(t,r-1)];i?3==i?(e=((15&e)<<18|(63&t[r++])<<12|(63&t[r++])<<6|63&t[r++])-65536,n+=String.fromCharCode(55296|e>>10,56320|1023&e)):n+=String.fromCharCode(1&i?(31&e)<<6|63&t[r++]:(15&e)<<12|(63&t[r++])<<6|63&t[r++]):n+=String.fromCharCode(e)}},Xt=function(){function t(t){this.ondata=t,Vt?this.t=new TextDecoder:this.p=q}return t.prototype.push=function(t,r){if(!this.ondata)throw"no callback";if(r=!!r,this.t){if(this.ondata(this.t.decode(t,{stream:!0}),r),r){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var e=new n(this.p.length+t.length);e.set(this.p),e.set(t,this.p.length);var i=Wt(e),o=i[0],a=i[1];if(r){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(o,r)}},t}();_e.DecodeUTF8=Xt;var $t=function(){function t(t){this.ondata=t}return t.prototype.push=function(t,n){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(_t(t),this.d=n||!1)},t}();function _t(t,r){if(r){for(var e=new n(t.length),i=0;i<t.length;++i)e[i]=t.charCodeAt(i);return e}if(Qt)return Qt.encode(t);var o=t.length,a=new n(t.length+(t.length>>1)),s=0,f=function(t){a[s++]=t};for(i=0;i<o;++i){if(s+5>a.length){var u=new n(s+8+(o-i<<1));u.set(a),a=u}var h=t.charCodeAt(i);h<128||r?f(h):h<2048?(f(192|h>>6),f(128|63&h)):h>55295&&h<57344?(f(240|(h=65536+(1047552&h)|1023&t.charCodeAt(++i))>>18),f(128|h>>12&63),f(128|h>>6&63),f(128|63&h)):(f(224|h>>12),f(128|h>>6&63),f(128|63&h))}return C(a,0,s)}function tn(t,n){if(n){for(var r="",e=0;e<t.length;e+=16384)r+=String.fromCharCode.apply(null,t.subarray(e,e+16384));return r}if(Rt)return Rt.decode(t);var i=Wt(t);if(i[1].length)throw"invalid utf-8 data";return i[0]}_e.EncodeUTF8=$t,_e.strToU8=_t,_e.strFromU8=tn;var nn=function(t){return 1==t?3:t<6?2:9==t?1:0},rn=function(t,n){return n+30+st(t,n+26)+st(t,n+28)},en=function(t,n,r){var e=st(t,n+28),i=tn(t.subarray(n+46,n+46+e),!(2048&st(t,n+8))),o=n+46+e,a=ft(t,n+20),s=r&&4294967295==a?on(t,o):[a,ft(t,n+24),ft(t,n+42)],f=s[0],u=s[1],h=s[2];return[st(t,n+10),f,u,i,o+st(t,n+30)+st(t,n+32),h]},on=function(t,n){for(;1!=st(t,n);n+=4+st(t,n+2));return[ut(t,n+12),ut(t,n+4),ut(t,n+20)]},an=function(t){var n=0;if(t)for(var r in t){var e=t[r].length;if(e>65535)throw"extra field too long";n+=e+4}return n},sn=function(t,n,r,e,i,o,a,s){var f=e.length,u=r.extra,h=s&&s.length,c=an(u);ht(t,n,null!=a?33639248:67324752),n+=4,null!=a&&(t[n++]=20,t[n++]=r.os),t[n]=20,n+=2,t[n++]=r.flag<<1|(null==o&&8),t[n++]=i&&8,t[n++]=255&r.compression,t[n++]=r.compression>>8;var l=new Date(null==r.mtime?Date.now():r.mtime),p=l.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(ht(t,n,p<<25|l.getMonth()+1<<21|l.getDate()<<16|l.getHours()<<11|l.getMinutes()<<5|l.getSeconds()>>>1),n+=4,null!=o&&(ht(t,n,r.crc),ht(t,n+4,o),ht(t,n+8,r.size)),ht(t,n+12,f),ht(t,n+14,c),n+=16,null!=a&&(ht(t,n,h),ht(t,n+6,r.attrs),ht(t,n+10,a),n+=14),t.set(e,n),n+=f,c)for(var v in u){var d=u[v],g=d.length;ht(t,n,+v),ht(t,n+2,g),t.set(d,n+4),n+=4+g}return h&&(t.set(s,n),n+=h),n},fn=function(t,n,r,e,i){ht(t,n,101010256),ht(t,n+8,r),ht(t,n+10,r),ht(t,n+12,e),ht(t,n+16,i)},un=function(){function t(t){this.filename=t,this.c=B(),this.size=0,this.compression=0}return t.prototype.process=function(t,n){this.ondata(null,t,n)},t.prototype.push=function(t,n){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(t),this.size+=t.length,n&&(this.crc=this.c.d()),this.process(t,n||!1)},t}();_e.ZipPassThrough=un;var hn=function(){function t(t,n){var r=this;n||(n={}),un.call(this,t),this.d=new yt(n,(function(t,n){r.ondata(null,t,n)})),this.compression=8,this.flag=nn(n.level)}return t.prototype.process=function(t,n){try{this.d.push(t,n)}catch(t){this.ondata(t,null,n)}},t.prototype.push=function(t,n){un.prototype.push.call(this,t,n)},t}();_e.ZipDeflate=hn;var cn=function(){function t(t,n){var r=this;n||(n={}),un.call(this,t),this.d=new mt(n,(function(t,n,e){r.ondata(t,n,e)})),this.compression=8,this.flag=nn(n.level),this.terminate=this.d.terminate}return t.prototype.process=function(t,n){this.d.push(t,n)},t.prototype.push=function(t,n){un.prototype.push.call(this,t,n)},t}();_e.AsyncZipDeflate=cn;var ln=function(){function t(t){this.ondata=t,this.u=[],this.d=1}return t.prototype.add=function(t){var r=this;if(2&this.d)throw"stream finished";var e=_t(t.filename),i=e.length,o=t.comment,a=o&&_t(o),s=i!=t.filename.length||a&&o.length!=a.length,f=i+an(t.extra)+30;if(i>65535)throw"filename too long";var u=new n(f);sn(u,0,t,e,s);var h=[u],c=function(){for(var t=0,n=h;t<n.length;t++)r.ondata(null,n[t],!1);h=[]},l=this.d;this.d=0;var p=this.u.length,v=L(t,{f:e,u:s,o:a,t:function(){t.terminate&&t.terminate()},r:function(){if(c(),l){var t=r.u[p+1];t?t.r():r.d=1}l=1}}),d=0;t.ondata=function(e,i,o){if(e)r.ondata(e,i,o),r.terminate();else if(d+=i.length,h.push(i),o){var a=new n(16);ht(a,0,134695760),ht(a,4,t.crc),ht(a,8,d),ht(a,12,t.size),h.push(a),v.c=d,v.b=f+d+16,v.crc=t.crc,v.size=t.size,l&&v.r(),l=1}else l&&c()},this.u.push(v)},t.prototype.end=function(){var t=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&t.d&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},t.prototype.e=function(){for(var t=0,r=0,e=0,i=0,o=this.u;i<o.length;i++)e+=46+(u=o[i]).f.length+an(u.extra)+(u.o?u.o.length:0);for(var a=new n(e+22),s=0,f=this.u;s<f.length;s++){var u;sn(a,t,u=f[s],u.f,u.u,u.c,r,u.o),t+=46+u.f.length+an(u.extra)+(u.o?u.o.length:0),r+=u.b}fn(a,t,this.u.length,e,r),this.ondata(null,a,!0),this.d=2},t.prototype.terminate=function(){for(var t=0,n=this.u;t<n.length;t++)n[t].t();this.d=2},t}();function pn(t,r,e){if(e||(e=r,r={}),"function"!=typeof e)throw"no callback";var i={};Nt(t,"",i,r);var o=Object.keys(i),a=o.length,s=0,f=0,u=a,h=Array(a),c=[],l=function(){for(var t=0;t<c.length;++t)c[t]()},p=function(){var t=new n(f+22),r=s,i=f-s;f=0;for(var o=0;o<u;++o){var a=h[o];try{var c=a.c.length;sn(t,f,a,a.f,a.u,c);var l=30+a.f.length+an(a.extra),p=f+l;t.set(a.c,p),sn(t,s,a,a.f,a.u,c,f,a.m),s+=16+l+(a.m?a.m.length:0),f=p+c}catch(t){return e(t,null)}}fn(t,s,h.length,i,r),e(null,t)};a||p();for(var v=function(t){var n=o[t],r=i[n],u=r[0],v=r[1],d=B(),g=u.length;d.p(u);var w=_t(n),y=w.length,m=v.comment,b=m&&_t(m),x=b&&b.length,z=an(v.extra),k=0==v.level?0:8,M=function(r,i){if(r)l(),e(r,null);else{var o=i.length;h[t]=L(v,{size:g,crc:d.d(),c:i,f:w,m:b,u:y!=n.length||b&&m.length!=x,compression:k}),s+=30+y+z+o,f+=76+2*(y+z)+(x||0)+o,--a||p()}};if(y>65535&&M("filename too long",null),k)if(g<16e4)try{M(null,xt(u,v))}catch(t){M(t,null)}else c.push(bt(u,v,M));else M(null,u)},d=0;d<u;++d)v(d);return l}function vn(t,r){r||(r={});var e={},i=[];Nt(t,"",e,r);var o=0,a=0;for(var s in e){var f=e[s],u=f[0],h=f[1],c=0==h.level?0:8,l=(M=_t(s)).length,p=h.comment,v=p&&_t(p),d=v&&v.length,g=an(h.extra);if(l>65535)throw"filename too long";var w=c?xt(u,h):u,y=w.length,m=B();m.p(u),i.push(L(h,{size:u.length,crc:m.d(),c:w,f:M,m:v,u:l!=s.length||v&&p.length!=d,o:o,compression:c})),o+=30+l+g+y,a+=76+2*(l+g)+(d||0)+y}for(var b=new n(a+22),x=o,z=a-o,k=0;k<i.length;++k){var M;sn(b,(M=i[k]).o,M,M.f,M.u,M.c.length);var A=30+M.f.length+an(M.extra);b.set(M.c,M.o+A),sn(b,o,M,M.f,M.u,M.c.length,M.o,M.m),o+=16+A+(M.m?M.m.length:0)}return fn(b,o,i.length,z,x),b}_e.Zip=ln,_e.zip=pn,_e.zipSync=vn;var dn=function(){function t(){}return t.prototype.push=function(t,n){this.ondata(null,t,n)},t.compression=0,t}();_e.UnzipPassThrough=dn;var gn=function(){function t(){var t=this;this.i=new zt((function(n,r){t.ondata(null,n,r)}))}return t.prototype.push=function(t,n){try{this.i.push(t,n)}catch(r){this.ondata(r,t,n)}},t.compression=8,t}();_e.UnzipInflate=gn;var wn=function(){function t(t,n){var r=this;n<32e4?this.i=new zt((function(t,n){r.ondata(null,t,n)})):(this.i=new kt((function(t,n,e){r.ondata(t,n,e)})),this.terminate=this.i.terminate)}return t.prototype.push=function(t,n){this.i.terminate&&(t=C(t,0)),this.i.push(t,n)},t.compression=8,t}();_e.AsyncUnzipInflate=wn;var yn=function(){function t(t){this.onfile=t,this.k=[],this.o={0:dn},this.p=q}return t.prototype.push=function(t,r){var e=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,t.length),o=t.subarray(0,i);if(this.c-=i,this.d?this.d.push(o,!this.c):this.k[0].push(o),(t=t.subarray(i)).length)return this.push(t,r)}else{var a=0,s=0,f=void 0,u=void 0;this.p.length?t.length?((u=new n(this.p.length+t.length)).set(this.p),u.set(t,this.p.length)):u=this.p:u=t;for(var h=u.length,c=this.c,l=c&&this.d,p=function(){var t,n=ft(u,s);if(67324752==n){a=1,f=s,v.d=null,v.c=0;var r=st(u,s+6),i=st(u,s+8),o=2048&r,l=8&r,p=st(u,s+26),d=st(u,s+28);if(h>s+30+p+d){var g=[];v.k.unshift(g),a=2;var w,y=ft(u,s+18),m=ft(u,s+22),b=tn(u.subarray(s+30,s+=30+p),!o);4294967295==y?(t=l?[-2]:on(u,s),y=t[0],m=t[1]):l&&(y=-1),s+=d,v.c=y;var x={name:b,compression:i,start:function(){if(!x.ondata)throw"no callback";if(y){var t=e.o[i];if(!t)throw"unknown compression type "+i;(w=y<0?new t(b):new t(b,y,m)).ondata=function(t,n,r){x.ondata(t,n,r)};for(var n=0,r=g;n<r.length;n++)w.push(r[n],!1);e.k[0]==g&&e.c?e.d=w:w.push(q,!0)}else x.ondata(null,q,!0)},terminate:function(){w&&w.terminate&&w.terminate()}};y>=0&&(x.size=y,x.originalSize=m),v.onfile(x)}return"break"}if(c){if(134695760==n)return f=s+=12+(-2==c&&8),a=3,v.c=0,"break";if(33639248==n)return f=s-=4,a=3,v.c=0,"break"}},v=this;s<h-4&&"break"!==p();++s);if(this.p=q,c<0){var d=u.subarray(0,a?f-12-(-2==c&&8)-(134695760==ft(u,f-16)&&4):s);l?l.push(d,!!a):this.k[+(2==a)].push(d)}if(2&a)return this.push(u.subarray(s),r);this.p=u.subarray(s)}if(r){if(this.c)throw"invalid zip file";this.p=null}},t.prototype.register=function(t){this.o[t.compression]=t},t}();function mn(t,r){if("function"!=typeof r)throw"no callback";for(var e=[],i=function(){for(var t=0;t<e.length;++t)e[t]()},o={},a=t.length-22;101010256!=ft(t,a);--a)if(!a||t.length-a>65558)return void r("invalid zip file",null);var s=st(t,a+8);s||r(null,{});var f=s,u=ft(t,a+16),h=4294967295==u;if(h){if(a=ft(t,a-12),101075792!=ft(t,a))return void r("invalid zip file",null);f=s=ft(t,a+32),u=ft(t,a+48)}for(var c=function(a){var f=en(t,u,h),c=f[0],l=f[1],p=f[2],v=f[3],d=f[4],g=rn(t,f[5]);u=d;var w=function(t,n){t?(i(),r(t,null)):(o[v]=n,--s||r(null,o))};if(c)if(8==c){var y=t.subarray(g,g+l);if(l<32e4)try{w(null,At(y,new n(p)))}catch(t){w(t,null)}else e.push(Mt(y,{size:p},w))}else w("unknown compression type "+c,null);else w(null,C(t,g,g+l))},l=0;l<f;++l)c();return i}function bn(t){for(var r={},e=t.length-22;101010256!=ft(t,e);--e)if(!e||t.length-e>65558)throw"invalid zip file";var i=st(t,e+8);if(!i)return{};var o=ft(t,e+16),a=4294967295==o;if(a){if(e=ft(t,e-12),101075792!=ft(t,e))throw"invalid zip file";i=ft(t,e+32),o=ft(t,e+48)}for(var s=0;s<i;++s){var f=en(t,o,a),u=f[0],h=f[1],c=f[2],l=f[3],p=f[4],v=rn(t,f[5]);if(o=p,u){if(8!=u)throw"unknown compression type "+u;r[l]=At(t.subarray(v,v+h),new n(c))}else r[l]=C(t,v,v+h)}return r}_e.Unzip=yn,_e.unzip=mn,_e.unzipSync=bn;return _e})


THREE.TrackballControls=function(A,C){if(C===undefined){console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.')}if(C===document){console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.')}var y=this;var h={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=A;this.domElement=C;this.enabled=true;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.staticMoving=false;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.DOLLY,RIGHT:THREE.MOUSE.PAN};this.target=new THREE.Vector3();var c=0.000001;var f=new THREE.Vector3();var d=1;var b=h.NONE,l=h.NONE,B=new THREE.Vector3(),K=new THREE.Vector2(),e=new THREE.Vector2(),g=new THREE.Vector3(),u=0,j=new THREE.Vector2(),o=new THREE.Vector2(),i=0,k=0,r=new THREE.Vector2(),x=new THREE.Vector2();this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();this.zoom0=this.object.zoom;var I={type:"change"};var D={type:"start"};var s={type:"end"};this.handleResize=function(){var M=y.domElement.getBoundingClientRect();var N=y.domElement.ownerDocument.documentElement;y.screen.left=M.left+window.pageXOffset-N.clientLeft;y.screen.top=M.top+window.pageYOffset-N.clientTop;y.screen.width=M.width;y.screen.height=M.height};var m=(function(){var N=new THREE.Vector2();return function M(P,O){N.set((P-y.screen.left)/y.screen.width,(O-y.screen.top)/y.screen.height);return N}}());var p=(function(){var M=new THREE.Vector2();return function N(P,O){M.set(((P-y.screen.width*0.5-y.screen.left)/(y.screen.width*0.5)),((y.screen.height+2*(y.screen.top-O))/y.screen.width));return M}}());this.rotateCamera=(function(){var Q=new THREE.Vector3(),S=new THREE.Quaternion(),R=new THREE.Vector3(),N=new THREE.Vector3(),M=new THREE.Vector3(),P=new THREE.Vector3(),T;return function O(){P.set(e.x-K.x,e.y-K.y,0);T=P.length();if(T){B.copy(y.object.position).sub(y.target);R.copy(B).normalize();N.copy(y.object.up).normalize();M.crossVectors(N,R).normalize();N.setLength(e.y-K.y);M.setLength(e.x-K.x);P.copy(N.add(M));Q.crossVectors(P,B).normalize();T*=y.rotateSpeed;S.setFromAxisAngle(Q,T);B.applyQuaternion(S);y.object.up.applyQuaternion(S);g.copy(Q);u=T}else{if(!y.staticMoving&&u){u*=Math.sqrt(1-y.dynamicDampingFactor);B.copy(y.object.position).sub(y.target);S.setFromAxisAngle(g,u);B.applyQuaternion(S);y.object.up.applyQuaternion(S)}}K.copy(e)}}());this.zoomCamera=function(){var M;if(b===h.TOUCH_ZOOM_PAN){M=i/k;i=k;if(y.object.isPerspectiveCamera){B.multiplyScalar(M)}else{if(y.object.isOrthographicCamera){y.object.zoom*=M;y.object.updateProjectionMatrix()}else{console.warn("THREE.TrackballControls: Unsupported camera type")}}}else{M=1+(o.y-j.y)*y.zoomSpeed;if(M!==1&&M>0){if(y.object.isPerspectiveCamera){B.multiplyScalar(M)}else{if(y.object.isOrthographicCamera){y.object.zoom/=M;y.object.updateProjectionMatrix()}else{console.warn("THREE.TrackballControls: Unsupported camera type")}}}if(y.staticMoving){j.copy(o)}else{j.y+=(o.y-j.y)*this.dynamicDampingFactor}}};this.panCamera=(function(){var O=new THREE.Vector2(),M=new THREE.Vector3(),P=new THREE.Vector3();return function N(){O.copy(x).sub(r);if(O.lengthSq()){if(y.object.isOrthographicCamera){var R=(y.object.right-y.object.left)/y.object.zoom/y.domElement.clientWidth;var Q=(y.object.top-y.object.bottom)/y.object.zoom/y.domElement.clientWidth;O.x*=R;O.y*=Q}O.multiplyScalar(B.length()*y.panSpeed);P.copy(B).cross(y.object.up).setLength(O.x);P.add(M.copy(y.object.up).setLength(O.y));y.object.position.add(P);y.target.add(P);if(y.staticMoving){r.copy(x)}else{r.add(O.subVectors(x,r).multiplyScalar(y.dynamicDampingFactor))}}}}());this.checkDistances=function(){if(!y.noZoom||!y.noPan){if(B.lengthSq()>y.maxDistance*y.maxDistance){y.object.position.addVectors(y.target,B.setLength(y.maxDistance));j.copy(o)}if(B.lengthSq()<y.minDistance*y.minDistance){y.object.position.addVectors(y.target,B.setLength(y.minDistance));j.copy(o)}}};this.update=function(){B.subVectors(y.object.position,y.target);if(!y.noRotate){y.rotateCamera()}if(!y.noZoom){y.zoomCamera()}if(!y.noPan){y.panCamera()}y.object.position.addVectors(y.target,B);if(y.object.isPerspectiveCamera){y.checkDistances();y.object.lookAt(y.target);if(f.distanceToSquared(y.object.position)>c){y.dispatchEvent(I);f.copy(y.object.position)}}else{if(y.object.isOrthographicCamera){y.object.lookAt(y.target);if(f.distanceToSquared(y.object.position)>c||d!==y.object.zoom){y.dispatchEvent(I);f.copy(y.object.position);d=y.object.zoom}}else{console.warn("THREE.TrackballControls: Unsupported camera type")}}};this.reset=function(){b=h.NONE;l=h.NONE;y.target.copy(y.target0);y.object.position.copy(y.position0);y.object.up.copy(y.up0);y.object.zoom=y.zoom0;
y.object.updateProjectionMatrix();B.subVectors(y.object.position,y.target);y.object.lookAt(y.target);y.dispatchEvent(I);f.copy(y.object.position);d=y.object.zoom};function v(M){if(y.enabled===false){return}switch(M.pointerType){case"mouse":case"pen":H(M);break}}function E(M){if(y.enabled===false){return}switch(M.pointerType){case"mouse":case"pen":a(M);break}}function z(M){if(y.enabled===false){return}switch(M.pointerType){case"mouse":case"pen":L(M);break}}function q(M){if(y.enabled===false){return}window.removeEventListener("keydown",q);if(l!==h.NONE){return}else{if(M.keyCode===y.keys[h.ROTATE]&&!y.noRotate){l=h.ROTATE}else{if(M.keyCode===y.keys[h.ZOOM]&&!y.noZoom){l=h.ZOOM}else{if(M.keyCode===y.keys[h.PAN]&&!y.noPan){l=h.PAN}}}}}function F(){if(y.enabled===false){return}l=h.NONE;window.addEventListener("keydown",q)}function H(M){M.preventDefault();if(b===h.NONE){switch(M.button){case y.mouseButtons.LEFT:b=h.ROTATE;break;case y.mouseButtons.MIDDLE:b=h.ZOOM;break;case y.mouseButtons.RIGHT:b=h.PAN;break;default:b=h.NONE}}var N=(l!==h.NONE)?l:b;if(N===h.ROTATE&&!y.noRotate){e.copy(p(M.pageX,M.pageY));K.copy(e)}else{if(N===h.ZOOM&&!y.noZoom){j.copy(m(M.pageX,M.pageY));o.copy(j)}else{if(N===h.PAN&&!y.noPan){r.copy(m(M.pageX,M.pageY));x.copy(r)}}}y.domElement.ownerDocument.addEventListener("pointermove",E);y.domElement.ownerDocument.addEventListener("pointerup",z);y.dispatchEvent(D)}function a(M){if(y.enabled===false){return}M.preventDefault();var N=(l!==h.NONE)?l:b;if(N===h.ROTATE&&!y.noRotate){K.copy(e);e.copy(p(M.pageX,M.pageY))}else{if(N===h.ZOOM&&!y.noZoom){o.copy(m(M.pageX,M.pageY))}else{if(N===h.PAN&&!y.noPan){x.copy(m(M.pageX,M.pageY))}}}}function L(M){if(y.enabled===false){return}M.preventDefault();b=h.NONE;y.domElement.ownerDocument.removeEventListener("pointermove",E);y.domElement.ownerDocument.removeEventListener("pointerup",z);y.dispatchEvent(s)}function G(M){if(y.enabled===false){return}if(y.noZoom===true){return}M.preventDefault();switch(M.deltaMode){case 2:j.y-=M.deltaY*0.025;break;case 1:j.y-=M.deltaY*0.01;break;default:j.y-=M.deltaY*0.00025;break}y.dispatchEvent(D);y.dispatchEvent(s)}function J(P){if(y.enabled===false){return}P.preventDefault();switch(P.touches.length){case 1:b=h.TOUCH_ROTATE;e.copy(p(P.touches[0].pageX,P.touches[0].pageY));K.copy(e);break;default:b=h.TOUCH_ZOOM_PAN;var O=P.touches[0].pageX-P.touches[1].pageX;var N=P.touches[0].pageY-P.touches[1].pageY;k=i=Math.sqrt(O*O+N*N);var M=(P.touches[0].pageX+P.touches[1].pageX)/2;var Q=(P.touches[0].pageY+P.touches[1].pageY)/2;r.copy(m(M,Q));x.copy(r);break}y.dispatchEvent(D)}function n(P){if(y.enabled===false){return}P.preventDefault();switch(P.touches.length){case 1:K.copy(e);e.copy(p(P.touches[0].pageX,P.touches[0].pageY));break;default:var O=P.touches[0].pageX-P.touches[1].pageX;var N=P.touches[0].pageY-P.touches[1].pageY;k=Math.sqrt(O*O+N*N);var M=(P.touches[0].pageX+P.touches[1].pageX)/2;var Q=(P.touches[0].pageY+P.touches[1].pageY)/2;x.copy(m(M,Q));break}}function w(M){if(y.enabled===false){return}switch(M.touches.length){case 0:b=h.NONE;break;case 1:b=h.TOUCH_ROTATE;e.copy(p(M.touches[0].pageX,M.touches[0].pageY));K.copy(e);break}y.dispatchEvent(s)}function t(M){if(y.enabled===false){return}M.preventDefault()}this.dispose=function(){y.domElement.removeEventListener("contextmenu",t);y.domElement.removeEventListener("pointerdown",v);y.domElement.removeEventListener("wheel",G);y.domElement.removeEventListener("touchstart",J);y.domElement.removeEventListener("touchend",w);y.domElement.removeEventListener("touchmove",n);y.domElement.ownerDocument.removeEventListener("pointermove",E);y.domElement.ownerDocument.removeEventListener("pointerup",z);window.removeEventListener("keydown",q);window.removeEventListener("keyup",F)};this.domElement.addEventListener("contextmenu",t);this.domElement.addEventListener("pointerdown",v);this.domElement.addEventListener("wheel",G);this.domElement.addEventListener("touchstart",J);this.domElement.addEventListener("touchend",w);this.domElement.addEventListener("touchmove",n);this.domElement.ownerDocument.addEventListener("pointermove",E);this.domElement.ownerDocument.addEventListener("pointerup",z);window.addEventListener("keydown",q);window.addEventListener("keyup",F);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;

THREE.OrbitControls=function(R,S){if(S===undefined){console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.')}if(S===document){console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.')}this.object=R;this.domElement=S;this.enabled=true;this.target=new THREE.Vector3();this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=false;this.dampingFactor=0.05;this.enableZoom=true;this.zoomSpeed=1;this.enableRotate=true;this.rotateSpeed=1;this.enablePan=true;this.panSpeed=1;this.screenSpacePanning=true;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.DOLLY,RIGHT:THREE.MOUSE.PAN};this.touches={ONE:THREE.TOUCH.ROTATE,TWO:THREE.TOUCH.DOLLY_PAN};this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;this._domElementKeyEvents=null;this.getPolarAngle=function(){return X.phi};this.getAzimuthalAngle=function(){return X.theta};this.listenToKeyEvents=function(am){am.addEventListener("keydown",j);this._domElementKeyEvents=am};this.saveState=function(){N.target0.copy(N.target);N.position0.copy(N.object.position);N.zoom0=N.object.zoom};this.reset=function(){N.target.copy(N.target0);N.object.position.copy(N.position0);N.object.zoom=N.zoom0;N.object.updateProjectionMatrix();N.dispatchEvent(ae);N.update();al=e.NONE};this.update=function(){var ar=new THREE.Vector3();var ap=new THREE.Quaternion().setFromUnitVectors(R.up,new THREE.Vector3(0,1,0));var aq=ap.clone().invert();var an=new THREE.Vector3();var am=new THREE.Quaternion();var ao=2*Math.PI;return function at(){var av=N.object.position;ar.copy(av).sub(N.target);ar.applyQuaternion(ap);X.setFromVector3(ar);if(N.autoRotate&&al===e.NONE){A(f())}if(N.enableDamping){X.theta+=i.theta*N.dampingFactor;X.phi+=i.phi*N.dampingFactor}else{X.theta+=i.theta;X.phi+=i.phi}var aw=N.minAzimuthAngle;var au=N.maxAzimuthAngle;if(isFinite(aw)&&isFinite(au)){if(aw<-Math.PI){aw+=ao}else{if(aw>Math.PI){aw-=ao}}if(au<-Math.PI){au+=ao}else{if(au>Math.PI){au-=ao}}if(aw<=au){X.theta=Math.max(aw,Math.min(au,X.theta))}else{X.theta=(X.theta>(aw+au)/2)?Math.max(aw,X.theta):Math.min(au,X.theta)}}X.phi=Math.max(N.minPolarAngle,Math.min(N.maxPolarAngle,X.phi));X.makeSafe();X.radius*=I;X.radius=Math.max(N.minDistance,Math.min(N.maxDistance,X.radius));if(N.enableDamping===true){N.target.addScaledVector(Y,N.dampingFactor)}else{N.target.add(Y)}ar.setFromSpherical(X);ar.applyQuaternion(aq);av.copy(N.target).add(ar);N.object.lookAt(N.target);if(N.enableDamping===true){i.theta*=(1-N.dampingFactor);i.phi*=(1-N.dampingFactor);Y.multiplyScalar(1-N.dampingFactor)}else{i.set(0,0,0);Y.set(0,0,0)}I=1;if(K||an.distanceToSquared(N.object.position)>c||8*(1-am.dot(N.object.quaternion))>c){N.dispatchEvent(ae);an.copy(N.object.position);am.copy(N.object.quaternion);K=false;return true}return false}}();this.dispose=function(){N.domElement.removeEventListener("contextmenu",G);N.domElement.removeEventListener("pointerdown",L);N.domElement.removeEventListener("wheel",U);N.domElement.removeEventListener("touchstart",ac);N.domElement.removeEventListener("touchend",T);N.domElement.removeEventListener("touchmove",af);N.domElement.ownerDocument.removeEventListener("pointermove",V);N.domElement.ownerDocument.removeEventListener("pointerup",O);if(N._domElementKeyEvents!==null){N._domElementKeyEvents.removeEventListener("keydown",j)}};var N=this;var ae={type:"change"};var W={type:"start"};var F={type:"end"};var e={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};var al=e.NONE;var c=0.000001;var X=new THREE.Spherical();var i=new THREE.Spherical();var I=1;var Y=new THREE.Vector3();var K=false;var C=new THREE.Vector2();var u=new THREE.Vector2();var P=new THREE.Vector2();var d=new THREE.Vector2();var x=new THREE.Vector2();var q=new THREE.Vector2();var z=new THREE.Vector2();var b=new THREE.Vector2();var M=new THREE.Vector2();function f(){return 2*Math.PI/60/60*N.autoRotateSpeed}function J(){return Math.pow(0.95,N.zoomSpeed)}function A(am){i.theta-=am}function E(am){i.phi-=am}var p=function(){var am=new THREE.Vector3();return function an(ap,ao){am.setFromMatrixColumn(ao,0);am.multiplyScalar(-ap);Y.add(am)}}();var D=function(){var am=new THREE.Vector3();return function an(ap,ao){if(N.screenSpacePanning===true){am.setFromMatrixColumn(ao,1)}else{am.setFromMatrixColumn(ao,0);am.crossVectors(N.object.up,am)}am.multiplyScalar(ap);Y.add(am)}}();var n=function(){var an=new THREE.Vector3();return function am(aq,ap){var ar=N.domElement;if(N.object.isPerspectiveCamera){var ao=N.object.position;an.copy(ao).sub(N.target);var at=an.length();at*=Math.tan((N.object.fov/2)*Math.PI/180);p(2*aq*at/ar.clientHeight,N.object.matrix);
D(2*ap*at/ar.clientHeight,N.object.matrix)}else{if(N.object.isOrthographicCamera){p(aq*(N.object.right-N.object.left)/N.object.zoom/ar.clientWidth,N.object.matrix);D(ap*(N.object.top-N.object.bottom)/N.object.zoom/ar.clientHeight,N.object.matrix)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.");N.enablePan=false}}}}();function v(am){if(N.object.isPerspectiveCamera){I/=am}else{if(N.object.isOrthographicCamera){N.object.zoom=Math.max(N.minZoom,Math.min(N.maxZoom,N.object.zoom*am));N.object.updateProjectionMatrix();K=true}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.");N.enableZoom=false}}}function r(am){if(N.object.isPerspectiveCamera){I*=am}else{if(N.object.isOrthographicCamera){N.object.zoom=Math.max(N.minZoom,Math.min(N.maxZoom,N.object.zoom/am));N.object.updateProjectionMatrix();K=true}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.");N.enableZoom=false}}}function w(am){C.set(am.clientX,am.clientY)}function aa(am){z.set(am.clientX,am.clientY)}function H(am){d.set(am.clientX,am.clientY)}function o(an){u.set(an.clientX,an.clientY);P.subVectors(u,C).multiplyScalar(N.rotateSpeed);var am=N.domElement;A(2*Math.PI*P.x/am.clientHeight);E(2*Math.PI*P.y/am.clientHeight);C.copy(u);N.update()}function ak(am){b.set(am.clientX,am.clientY);M.subVectors(b,z);if(M.y>0){v(J())}else{if(M.y<0){r(J())}}z.copy(b);N.update()}function l(am){x.set(am.clientX,am.clientY);q.subVectors(x,d).multiplyScalar(N.panSpeed);n(q.x,q.y);d.copy(x);N.update()}function ai(){}function Z(am){if(am.deltaY<0){r(J())}else{if(am.deltaY>0){v(J())}}N.update()}function h(an){var am=false;switch(an.keyCode){case N.keys.UP:n(0,N.keyPanSpeed);am=true;break;case N.keys.BOTTOM:n(0,-N.keyPanSpeed);am=true;break;case N.keys.LEFT:n(N.keyPanSpeed,0);am=true;break;case N.keys.RIGHT:n(-N.keyPanSpeed,0);am=true;break}if(am){an.preventDefault();N.update()}}function k(an){if(an.touches.length==1){C.set(an.touches[0].pageX,an.touches[0].pageY)}else{var am=0.5*(an.touches[0].pageX+an.touches[1].pageX);var ao=0.5*(an.touches[0].pageY+an.touches[1].pageY);C.set(am,ao)}}function ab(an){if(an.touches.length==1){d.set(an.touches[0].pageX,an.touches[0].pageY)}else{var am=0.5*(an.touches[0].pageX+an.touches[1].pageX);var ao=0.5*(an.touches[0].pageY+an.touches[1].pageY);d.set(am,ao)}}function t(ao){var an=ao.touches[0].pageX-ao.touches[1].pageX;var am=ao.touches[0].pageY-ao.touches[1].pageY;var ap=Math.sqrt(an*an+am*am);z.set(0,ap)}function ah(am){if(N.enableZoom){t(am)}if(N.enablePan){ab(am)}}function ag(am){if(N.enableZoom){t(am)}if(N.enableRotate){k(am)}}function m(ao){if(ao.touches.length==1){u.set(ao.touches[0].pageX,ao.touches[0].pageY)}else{var am=0.5*(ao.touches[0].pageX+ao.touches[1].pageX);var ap=0.5*(ao.touches[0].pageY+ao.touches[1].pageY);u.set(am,ap)}P.subVectors(u,C).multiplyScalar(N.rotateSpeed);var an=N.domElement;A(2*Math.PI*P.x/an.clientHeight);E(2*Math.PI*P.y/an.clientHeight);C.copy(u)}function s(an){if(an.touches.length==1){x.set(an.touches[0].pageX,an.touches[0].pageY)}else{var am=0.5*(an.touches[0].pageX+an.touches[1].pageX);var ao=0.5*(an.touches[0].pageY+an.touches[1].pageY);x.set(am,ao)}q.subVectors(x,d).multiplyScalar(N.panSpeed);n(q.x,q.y);d.copy(x)}function Q(ao){var an=ao.touches[0].pageX-ao.touches[1].pageX;var am=ao.touches[0].pageY-ao.touches[1].pageY;var ap=Math.sqrt(an*an+am*am);b.set(0,ap);M.set(0,Math.pow(b.y/z.y,N.zoomSpeed));v(M.y);z.copy(b)}function B(am){if(N.enableZoom){Q(am)}if(N.enablePan){s(am)}}function y(am){if(N.enableZoom){Q(am)}if(N.enableRotate){m(am)}}function g(){}function L(am){if(N.enabled===false){return}switch(am.pointerType){case"mouse":case"pen":ad(am);break}}function V(am){if(N.enabled===false){return}switch(am.pointerType){case"mouse":case"pen":a(am);break}}function O(am){switch(am.pointerType){case"mouse":case"pen":aj(am);break}}function ad(an){an.preventDefault();N.domElement.focus?N.domElement.focus():window.focus();var am;switch(an.button){case 0:am=N.mouseButtons.LEFT;break;case 1:am=N.mouseButtons.MIDDLE;break;case 2:am=N.mouseButtons.RIGHT;break;default:am=-1}switch(am){case THREE.MOUSE.DOLLY:if(N.enableZoom===false){return}aa(an);al=e.DOLLY;break;case THREE.MOUSE.ROTATE:if(an.ctrlKey||an.metaKey||an.shiftKey){if(N.enablePan===false){return}H(an);al=e.PAN}else{if(N.enableRotate===false){return}w(an);al=e.ROTATE}break;case THREE.MOUSE.PAN:if(an.ctrlKey||an.metaKey||an.shiftKey){if(N.enableRotate===false){return}w(an);al=e.ROTATE}else{if(N.enablePan===false){return}H(an);al=e.PAN}break;default:al=e.NONE}if(al!==e.NONE){N.domElement.ownerDocument.addEventListener("pointermove",V);N.domElement.ownerDocument.addEventListener("pointerup",O);N.dispatchEvent(W)}}function a(am){if(N.enabled===false){return}am.preventDefault();switch(al){case e.ROTATE:if(N.enableRotate===false){return}o(am);break;case e.DOLLY:if(N.enableZoom===false){return}ak(am);break;case e.PAN:if(N.enablePan===false){return
}l(am);break}}function aj(am){N.domElement.ownerDocument.removeEventListener("pointermove",V);N.domElement.ownerDocument.removeEventListener("pointerup",O);if(N.enabled===false){return}ai(am);N.dispatchEvent(F);al=e.NONE}function U(am){if(N.enabled===false||N.enableZoom===false||(al!==e.NONE&&al!==e.ROTATE)){return}am.preventDefault();N.dispatchEvent(W);Z(am);N.dispatchEvent(F)}function j(am){if(N.enabled===false||N.enablePan===false){return}h(am)}function ac(am){if(N.enabled===false){return}am.preventDefault();switch(am.touches.length){case 1:switch(N.touches.ONE){case THREE.TOUCH.ROTATE:if(N.enableRotate===false){return}k(am);al=e.TOUCH_ROTATE;break;case THREE.TOUCH.PAN:if(N.enablePan===false){return}ab(am);al=e.TOUCH_PAN;break;default:al=e.NONE}break;case 2:switch(N.touches.TWO){case THREE.TOUCH.DOLLY_PAN:if(N.enableZoom===false&&N.enablePan===false){return}ah(am);al=e.TOUCH_DOLLY_PAN;break;case THREE.TOUCH.DOLLY_ROTATE:if(N.enableZoom===false&&N.enableRotate===false){return}ag(am);al=e.TOUCH_DOLLY_ROTATE;break;default:al=e.NONE}break;default:al=e.NONE}if(al!==e.NONE){N.dispatchEvent(W)}}function af(am){if(N.enabled===false){return}am.preventDefault();switch(al){case e.TOUCH_ROTATE:if(N.enableRotate===false){return}m(am);N.update();break;case e.TOUCH_PAN:if(N.enablePan===false){return}s(am);N.update();break;case e.TOUCH_DOLLY_PAN:if(N.enableZoom===false&&N.enablePan===false){return}B(am);N.update();break;case e.TOUCH_DOLLY_ROTATE:if(N.enableZoom===false&&N.enableRotate===false){return}y(am);N.update();break;default:al=e.NONE}}function T(am){if(N.enabled===false){return}g(am);N.dispatchEvent(F);al=e.NONE}function G(am){if(N.enabled===false){return}am.preventDefault()}N.domElement.addEventListener("contextmenu",G);N.domElement.addEventListener("pointerdown",L);N.domElement.addEventListener("wheel",U);N.domElement.addEventListener("touchstart",ac);N.domElement.addEventListener("touchend",T);N.domElement.addEventListener("touchmove",af);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;THREE.MapControls=function(a,b){THREE.OrbitControls.call(this,a,b);this.screenSpacePanning=false;this.mouseButtons.LEFT=THREE.MOUSE.PAN;this.mouseButtons.RIGHT=THREE.MOUSE.ROTATE;this.touches.ONE=THREE.TOUCH.PAN;this.touches.TWO=THREE.TOUCH.DOLLY_ROTATE};THREE.MapControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.MapControls.prototype.constructor=THREE.MapControls;

THREE.GLTFLoader=function(){function a(a){THREE.Loader.call(this,a),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(a){return new f(a)}),this.register(function(a){return new h(a)}),this.register(function(a){return new i(a)}),this.register(function(a){return new g(a)}),this.register(function(a){return new d(a)}),this.register(function(a){return new j(a)})}function b(){var a={};return{get:function(b){return a[b]},add:function(b,c){a[b]=c},remove:function(b){delete a[b]},removeAll:function(){a={}}}}function d(a){this.parser=a,this.name=c.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function e(){this.name=c.KHR_MATERIALS_UNLIT}function f(a){this.parser=a,this.name=c.KHR_MATERIALS_CLEARCOAT}function g(a){this.parser=a,this.name=c.KHR_MATERIALS_TRANSMISSION}function h(a){this.parser=a,this.name=c.KHR_TEXTURE_BASISU}function i(a){this.parser=a,this.name=c.EXT_TEXTURE_WEBP,this.isSupported=null}function j(a){this.name=c.EXT_MESHOPT_COMPRESSION,this.parser=a}function n(a){var b,d,e,f,g,h,i,j;if(this.name=c.KHR_BINARY_GLTF,this.content=null,this.body=null,b=new DataView(a,0,l),this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(a.slice(0,4))),version:b.getUint32(4,!0),length:b.getUint32(8,!0)},this.header.magic!==k)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(d=this.header.length-l,e=new DataView(a,l),f=0;d>f;)g=e.getUint32(f,!0),f+=4,h=e.getUint32(f,!0),f+=4,h===m.JSON?(i=new Uint8Array(a,l+f,g),this.content=THREE.LoaderUtils.decodeText(i)):h===m.BIN&&(j=l+f,this.body=a.slice(j,j+g)),f+=g;if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function o(a,b){if(!b)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=c.KHR_DRACO_MESH_COMPRESSION,this.json=a,this.dracoLoader=b,this.dracoLoader.preload()}function p(){this.name=c.KHR_TEXTURE_TRANSFORM}function q(a){var b,c,d,e,f,g;THREE.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0,b=["#ifdef USE_SPECULARMAP","   uniform sampler2D specularMap;","#endif"].join("\n"),c=["#ifdef USE_GLOSSINESSMAP","    uniform sampler2D glossinessMap;","#endif"].join("\n"),d=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","  vec4 texelSpecular = texture2D( specularMap, vUv );","  texelSpecular = sRGBToLinear( texelSpecular );","   // reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","  specularFactor *= texelSpecular.rgb;","#endif"].join("\n"),e=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","   vec4 texelGlossiness = texture2D( glossinessMap, vUv );","  // reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","    glossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),f=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),g={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}},this._extraUniforms=g,this.onBeforeCompile=function(a){for(var h in g)a.uniforms[h]=g[h];a.fragmentShader=a.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",b).replace("#include <metalnessmap_pars_fragment>",c).replace("#include <roughnessmap_fragment>",d).replace("#include <metalnessmap_fragment>",e).replace("#include <lights_physical_fragment>",f)},Object.defineProperties(this,{specular:{get:function(){return g.specular.value},set:function(a){g.specular.value=a}},specularMap:{get:function(){return g.specularMap.value},set:function(a){g.specularMap.value=a,a?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return g.glossiness.value},set:function(a){g.glossiness.value=a}},glossinessMap:{get:function(){return g.glossinessMap.value},set:function(a){g.glossinessMap.value=a,a?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(a)}function r(){return{name:c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return q},extendParams:function(a,b,c){var e,f,g,d=b.extensions[this.name];return a.color=new THREE.Color(1,1,1),a.opacity=1,e=[],Array.isArray(d.diffuseFactor)&&(f=d.diffuseFactor,a.color.fromArray(f),a.opacity=f[3]),void 0!==d.diffuseTexture&&e.push(c.assignTexture(a,"map",d.diffuseTexture)),a.emissive=new THREE.Color(0,0,0),a.glossiness=void 0!==d.glossinessFactor?d.glossinessFactor:1,a.specular=new THREE.Color(1,1,1),Array.isArray(d.specularFactor)&&a.specular.fromArray(d.specularFactor),void 0!==d.specularGlossinessTexture&&(g=d.specularGlossinessTexture,e.push(c.assignTexture(a,"glossinessMap",g)),e.push(c.assignTexture(a,"specularMap",g))),Promise.all(e)},createMaterial:function(a){var b=new q(a);return b.fog=!0,b.color=a.color,b.map=void 0===a.map?null:a.map,b.lightMap=null,b.lightMapIntensity=1,b.aoMap=void 0===a.aoMap?null:a.aoMap,b.aoMapIntensity=1,b.emissive=a.emissive,b.emissiveIntensity=1,b.emissiveMap=void 0===a.emissiveMap?null:a.emissiveMap,b.bumpMap=void 0===a.bumpMap?null:a.bumpMap,b.bumpScale=1,b.normalMap=void 0===a.normalMap?null:a.normalMap,b.normalMapType=THREE.TangentSpaceNormalMap,a.normalScale&&(b.normalScale=a.normalScale),b.displacementMap=null,b.displacementScale=1,b.displacementBias=0,b.specularMap=void 0===a.specularMap?null:a.specularMap,b.specular=a.specular,b.glossinessMap=void 0===a.glossinessMap?null:a.glossinessMap,b.glossiness=a.glossiness,b.alphaMap=null,b.envMap=void 0===a.envMap?null:a.envMap,b.envMapIntensity=1,b.refractionRatio=.98,b}}}function s(){this.name=c.KHR_MESH_QUANTIZATION}function t(a,b,c,d){THREE.Interpolant.call(this,a,b,c,d)}function D(a,b){return"string"!=typeof a||""===a?"":(/^https?:\/\//i.test(b)&&/^\//.test(a)&&(b=b.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(a)?a:/^data:.*,.*$/i.test(a)?a:/^blob:.*$/i.test(a)?a:b+a)}function E(a){return void 0===a["DefaultMaterial"]&&(a["DefaultMaterial"]=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),a["DefaultMaterial"]}function F(a,b,c){for(var d in c.extensions)void 0===a[d]&&(b.userData.gltfExtensions=b.userData.gltfExtensions||{},b.userData.gltfExtensions[d]=c.extensions[d])}function G(a,b){void 0!==b.extras&&("object"==typeof b.extras?Object.assign(a.userData,b.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+b.extras))}function H(a,b,c){var f,g,h,i,j,k,d=!1,e=!1;for(f=0,g=b.length;g>f&&(h=b[f],void 0!==h.POSITION&&(d=!0),void 0!==h.NORMAL&&(e=!0),!d||!e);f++);if(!d&&!e)return Promise.resolve(a);for(i=[],j=[],f=0,g=b.length;g>f;f++)h=b[f],d&&(k=void 0!==h.POSITION?c.getDependency("accessor",h.POSITION):a.attributes.position,i.push(k)),e&&(k=void 0!==h.NORMAL?c.getDependency("accessor",h.NORMAL):a.attributes.normal,j.push(k));return Promise.all([Promise.all(i),Promise.all(j)]).then(function(b){var c=b[0],f=b[1];return d&&(a.morphAttributes.position=c),e&&(a.morphAttributes.normal=f),a.morphTargetsRelative=!0,a})}function I(a,b){var c,d,e;if(a.updateMorphTargets(),void 0!==b.weights)for(c=0,d=b.weights.length;d>c;c++)a.morphTargetInfluences[c]=b.weights[c];if(b.extras&&Array.isArray(b.extras.targetNames))if(e=b.extras.targetNames,a.morphTargetInfluences.length===e.length)for(a.morphTargetDictionary={},c=0,d=e.length;d>c;c++)a.morphTargetDictionary[e[c]]=c;else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}function J(a){var d,b=a.extensions&&a.extensions[c.KHR_DRACO_MESH_COMPRESSION];return d=b?"draco:"+b.bufferView+":"+b.indices+":"+K(b.attributes):a.indices+":"+K(a.attributes)+":"+a.mode}function K(a){var d,e,b="",c=Object.keys(a).sort();for(d=0,e=c.length;e>d;d++)b+=c[d]+":"+a[c[d]]+";";return b}function L(a,c){this.json=a||{},this.extensions={},this.plugins={},this.options=c||{},this.cache=new b,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},this.textureLoader="undefined"!=typeof createImageBitmap&&/Firefox/.test(navigator.userAgent)===!1?new THREE.ImageBitmapLoader(this.options.manager):new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function M(a,b,c){var f,g,h,i,j,k,l,m,n,o,d=b.attributes,e=new THREE.Box3;if(void 0!==d.POSITION){if(f=c.json.accessors[d.POSITION],g=f.min,h=f.max,void 0===g||void 0===h)return console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."),void 0;if(e.set(new THREE.Vector3(g[0],g[1],g[2]),new THREE.Vector3(h[0],h[1],h[2])),i=b.targets,void 0!==i){for(j=new THREE.Vector3,k=new THREE.Vector3,l=0,m=i.length;m>l;l++)n=i[l],void 0!==n.POSITION&&(f=c.json.accessors[n.POSITION],g=f.min,h=f.max,void 0!==g&&void 0!==h?(k.setX(Math.max(Math.abs(g[0]),Math.abs(h[0]))),k.setY(Math.max(Math.abs(g[1]),Math.abs(h[1]))),k.setZ(Math.max(Math.abs(g[2]),Math.abs(h[2]))),j.max(k)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."));e.expandByVector(j)}a.boundingBox=e,o=new THREE.Sphere,e.getCenter(o.center),o.radius=e.min.distanceTo(e.max)/2,a.boundingSphere=o}}function N(a,b,c){function f(b,d){return c.getDependency("accessor",b).then(function(b){a.setAttribute(d,b)})}var g,h,i,d=b.attributes,e=[];for(g in d)h=z[g]||g.toLowerCase(),h in a.attributes||e.push(f(d[g],h));return void 0===b.indices||a.index||(i=c.getDependency("accessor",b.indices).then(function(b){a.setIndex(b)}),e.push(i)),G(a,b),M(a,b,c),Promise.all(e).then(function(){return void 0!==b.targets?H(a,b.targets,c):a})}function O(a,b){var d,e,f,g,h,i,c=a.getIndex();if(null===c){if(d=[],e=a.getAttribute("position"),void 0===e)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a;for(f=0;f<e.count;f++)d.push(f);a.setIndex(d),c=a.getIndex()}if(g=c.count-2,h=[],b===THREE.TriangleFanDrawMode)for(f=1;g>=f;f++)h.push(c.getX(0)),h.push(c.getX(f)),h.push(c.getX(f+1));else for(f=0;g>f;f++)0===f%2?(h.push(c.getX(f)),h.push(c.getX(f+1)),h.push(c.getX(f+2))):(h.push(c.getX(f+2)),h.push(c.getX(f+1)),h.push(c.getX(f)));return h.length/3!==g&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles."),i=a.clone(),i.setIndex(h),i}var c,k,l,m,u,v,w,x,y,z,A,B,C;return a.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:a,load:function(a,b,c,d){var f,g,h,e=this;f=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(a),this.manager.itemStart(a),g=function(b){d?d(b):console.error(b),e.manager.itemError(a),e.manager.itemEnd(a)},h=new THREE.FileLoader(this.manager),h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(a,function(c){try{e.parse(c,f,function(c){b(c),e.manager.itemEnd(a)},g)}catch(d){g(d)}},c,g)},setDRACOLoader:function(a){return this.dracoLoader=a,this},setDDSLoader:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')},setKTX2Loader:function(a){return this.ktx2Loader=a,this},setMeshoptDecoder:function(a){return this.meshoptDecoder=a,this},register:function(a){return-1===this.pluginCallbacks.indexOf(a)&&this.pluginCallbacks.push(a),this},unregister:function(a){return-1!==this.pluginCallbacks.indexOf(a)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(a),1),this},parse:function(a,b,d,f){var g,j,m,q,t,u,v,w,h={},i={};if("string"==typeof a)g=a;else if(j=THREE.LoaderUtils.decodeText(new Uint8Array(a,0,4)),j===k){try{h[c.KHR_BINARY_GLTF]=new n(a)}catch(l){return f&&f(l),void 0}g=h[c.KHR_BINARY_GLTF].content}else g=THREE.LoaderUtils.decodeText(new Uint8Array(a));if(m=JSON.parse(g),void 0===m.asset||m.asset.version[0]<2)return f&&f(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")),void 0;for(q=new L(m,{path:b||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder}),q.fileLoader.setRequestHeader(this.requestHeader),t=0;t<this.pluginCallbacks.length;t++)u=this.pluginCallbacks[t](q),i[u.name]=u,h[u.name]=!0;if(m.extensionsUsed)for(t=0;t<m.extensionsUsed.length;++t)switch(v=m.extensionsUsed[t],w=m.extensionsRequired||[],v){case c.KHR_MATERIALS_UNLIT:h[v]=new e;break;case c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:h[v]=new r;break;case c.KHR_DRACO_MESH_COMPRESSION:h[v]=new o(m,this.dracoLoader);break;case c.KHR_TEXTURE_TRANSFORM:h[v]=new p;break;case c.KHR_MESH_QUANTIZATION:h[v]=new s;break;default:w.indexOf(v)>=0&&void 0===i[v]&&console.warn('THREE.GLTFLoader: Unknown extension "'+v+'".')}q.setExtensions(h),q.setPlugins(i),q.parse(d,f)}}),c={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},d.prototype._markDefs=function(){var c,d,e,a=this.parser,b=this.parser.json.nodes||[];for(c=0,d=b.length;d>c;c++)e=b[c],e.extensions&&e.extensions[this.name]&&void 0!==e.extensions[this.name].light&&a._addNodeRef(this.cache,e.extensions[this.name].light)},d.prototype._loadLight=function(a){var e,f,g,h,i,j,k,b=this.parser,c="light:"+a,d=b.cache.get(c);if(d)return d;switch(e=b.json,f=e.extensions&&e.extensions[this.name]||{},g=f.lights||[],h=g[a],j=new THREE.Color(16777215),void 0!==h.color&&j.fromArray(h.color),k=void 0!==h.range?h.range:0,h.type){case"directional":i=new THREE.DirectionalLight(j),i.target.position.set(0,0,-1),i.add(i.target);break;case"point":i=new THREE.PointLight(j),i.distance=k;break;case"spot":i=new THREE.SpotLight(j),i.distance=k,h.spot=h.spot||{},h.spot.innerConeAngle=void 0!==h.spot.innerConeAngle?h.spot.innerConeAngle:0,h.spot.outerConeAngle=void 0!==h.spot.outerConeAngle?h.spot.outerConeAngle:Math.PI/4,i.angle=h.spot.outerConeAngle,i.penumbra=1-h.spot.innerConeAngle/h.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+h.type)}return i.position.set(0,0,0),i.decay=2,void 0!==h.intensity&&(i.intensity=h.intensity),i.name=b.createUniqueName(h.name||"light_"+a),d=Promise.resolve(i),b.cache.add(c,d),d},d.prototype.createNodeAttachment=function(a){var b=this,c=this.parser,d=c.json,e=d.nodes[a],f=e.extensions&&e.extensions[this.name]||{},g=f.light;return void 0===g?null:this._loadLight(g).then(function(a){return c._getNodeRef(b.cache,g,a)})},e.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial},e.prototype.extendParams=function(a,b,c){var e,f,d=[];return a.color=new THREE.Color(1,1,1),a.opacity=1,e=b.pbrMetallicRoughness,e&&(Array.isArray(e.baseColorFactor)&&(f=e.baseColorFactor,a.color.fromArray(f),a.opacity=f[3]),void 0!==e.baseColorTexture&&d.push(c.assignTexture(a,"map",e.baseColorTexture))),Promise.all(d)},f.prototype.getMaterialType=function(a){var b=this.parser,c=b.json.materials[a];return c.extensions&&c.extensions[this.name]?THREE.MeshPhysicalMaterial:null},f.prototype.extendMaterialParams=function(a,b){var e,f,g,c=this.parser,d=c.json.materials[a];return d.extensions&&d.extensions[this.name]?(e=[],f=d.extensions[this.name],void 0!==f.clearcoatFactor&&(b.clearcoat=f.clearcoatFactor),void 0!==f.clearcoatTexture&&e.push(c.assignTexture(b,"clearcoatMap",f.clearcoatTexture)),void 0!==f.clearcoatRoughnessFactor&&(b.clearcoatRoughness=f.clearcoatRoughnessFactor),void 0!==f.clearcoatRoughnessTexture&&e.push(c.assignTexture(b,"clearcoatRoughnessMap",f.clearcoatRoughnessTexture)),void 0!==f.clearcoatNormalTexture&&(e.push(c.assignTexture(b,"clearcoatNormalMap",f.clearcoatNormalTexture)),void 0!==f.clearcoatNormalTexture.scale&&(g=f.clearcoatNormalTexture.scale,b.clearcoatNormalScale=new THREE.Vector2(g,-g))),Promise.all(e)):Promise.resolve()},g.prototype.getMaterialType=function(a){var b=this.parser,c=b.json.materials[a];return c.extensions&&c.extensions[this.name]?THREE.MeshPhysicalMaterial:null},g.prototype.extendMaterialParams=function(a,b){var e,f,c=this.parser,d=c.json.materials[a];return d.extensions&&d.extensions[this.name]?(e=[],f=d.extensions[this.name],void 0!==f.transmissionFactor&&(b.transmission=f.transmissionFactor),void 0!==f.transmissionTexture&&e.push(c.assignTexture(b,"transmissionMap",f.transmissionTexture)),Promise.all(e)):Promise.resolve()},h.prototype.loadTexture=function(a){var e,f,g,b=this.parser,c=b.json,d=c.textures[a];if(!d.extensions||!d.extensions[this.name])return null;if(e=d.extensions[this.name],f=c.images[e.source],g=b.options.ktx2Loader,!g){if(c.extensionsRequired&&c.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return b.loadTextureImage(a,f,g)},i.prototype.loadTexture=function(a){var f,g,h,i,b=this.name,c=this.parser,d=c.json,e=d.textures[a];return e.extensions&&e.extensions[b]?(f=e.extensions[b],g=d.images[f.source],h=c.textureLoader,g.uri&&(i=c.options.manager.getHandler(g.uri),null!==i&&(h=i)),this.detectSupport().then(function(e){if(e)return c.loadTextureImage(a,g,h);if(d.extensionsRequired&&d.extensionsRequired.indexOf(b)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return c.loadTexture(a)})):null},i.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise(function(a){var b=new Image;b.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",b.onload=b.onerror=function(){a(1===b.height)}})),this.isSupported},j.prototype.loadBufferView=function(a){var d,e,f,b=this.parser.json,c=b.bufferViews[a];if(c.extensions&&c.extensions[this.name]){if(d=c.extensions[this.name],e=this.parser.getDependency("buffer",d.buffer),f=this.parser.options.meshoptDecoder,!f||!f.supported){if(b.extensionsRequired&&b.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([e,f.ready]).then(function(a){var b=d.byteOffset||0,c=d.byteLength||0,e=d.count,g=d.byteStride,h=new ArrayBuffer(e*g),i=new Uint8Array(a[0],b,c);return f.decodeGltfBuffer(new Uint8Array(h),e,g,i,d.mode,d.filter),h})}return null},k="glTF",l=12,m={JSON:1313821514,BIN:5130562},o.prototype.decodePrimitive=function(a,b){var j,k,l,m,c=this.json,d=this.dracoLoader,e=a.extensions[this.name].bufferView,f=a.extensions[this.name].attributes,g={},h={},i={};for(j in f)k=z[j]||j.toLowerCase(),g[k]=f[j];for(j in a.attributes)k=z[j]||j.toLowerCase(),void 0!==f[j]&&(l=c.accessors[a.attributes[j]],m=v[l.componentType],i[k]=m,h[k]=l.normalized===!0);return b.getDependency("bufferView",e).then(function(a){return new Promise(function(b){d.decodeDracoFile(a,function(a){var c,d,e;for(c in a.attributes)d=a.attributes[c],e=h[c],void 0!==e&&(d.normalized=e);b(a)},g,i)})})},p.prototype.extendTexture=function(a,b){return a=a.clone(),void 0!==b.offset&&a.offset.fromArray(b.offset),void 0!==b.rotation&&(a.rotation=b.rotation),void 0!==b.scale&&a.repeat.fromArray(b.scale),void 0!==b.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),a.needsUpdate=!0,a},q.prototype=Object.create(THREE.MeshStandardMaterial.prototype),q.prototype.constructor=q,q.prototype.copy=function(a){return THREE.MeshStandardMaterial.prototype.copy.call(this,a),this.specularMap=a.specularMap,this.specular.copy(a.specular),this.glossinessMap=a.glossinessMap,this.glossiness=a.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},t.prototype=Object.create(THREE.Interpolant.prototype),t.prototype.constructor=t,t.prototype.copySampleValue_=function(a){var f,b=this.resultBuffer,c=this.sampleValues,d=this.valueSize,e=3*a*d+d;for(f=0;f!==d;f++)b[f]=c[e+f];return b},t.prototype.beforeStart_=t.prototype.copySampleValue_,t.prototype.afterEnd_=t.prototype.copySampleValue_,t.prototype.interpolate_=function(a,b,c,d){var t,u,v,w,x,e=this.resultBuffer,f=this.sampleValues,g=this.valueSize,h=2*g,i=3*g,j=d-b,k=(c-b)/j,l=k*k,m=l*k,n=a*i,o=n-i,p=-2*m+3*l,q=m-l,r=1-p,s=q-l+k;for(t=0;t!==g;t++)u=f[o+t+g],v=f[o+t+h]*j,w=f[n+t+g],x=f[n+t]*j,e[t]=r*u+s*v+p*w+q*x;return e},u={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},v={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},w={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},x={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},y={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},z={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},A={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},B={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},C={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},L.prototype.setExtensions=function(a){this.extensions=a},L.prototype.setPlugins=function(a){this.plugins=a},L.prototype.parse=function(a,b){var c=this,d=this.json,e=this.extensions;this.cache.removeAll(),this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([c.getDependencies("scene"),c.getDependencies("animation"),c.getDependencies("camera")])}).then(function(b){var f={scene:b[0][d.scene||0],scenes:b[0],animations:b[1],cameras:b[2],asset:d.asset,parser:c,userData:{}};F(e,f,d),G(f,d),Promise.all(c._invokeAll(function(a){return a.afterRoot&&a.afterRoot(f)})).then(function(){a(f)})}).catch(b)},L.prototype._markDefs=function(){var d,e,f,g,h,i,j,k,a=this.json.nodes||[],b=this.json.skins||[],c=this.json.meshes||[];for(d=0,e=b.length;e>d;d++)for(f=b[d].joints,g=0,h=f.length;h>g;g++)a[f[g]].isBone=!0;for(i=0,j=a.length;j>i;i++)k=a[i],void 0!==k.mesh&&(this._addNodeRef(this.meshCache,k.mesh),void 0!==k.skin&&(c[k.mesh].isSkinnedMesh=!0)),void 0!==k.camera&&this._addNodeRef(this.cameraCache,k.camera)},L.prototype._addNodeRef=function(a,b){void 0!==b&&(void 0===a.refs[b]&&(a.refs[b]=a.uses[b]=0),a.refs[b]++)},L.prototype._getNodeRef=function(a,b,c){if(a.refs[b]<=1)return c;var d=c.clone();return d.name+="_instance_"+a.uses[b]++,d},L.prototype._invokeOne=function(a){var c,d,b=Object.values(this.plugins);for(b.push(this),c=0;c<b.length;c++)if(d=a(b[c]))return d},L.prototype._invokeAll=function(a){var c,d,e,b=Object.values(this.plugins);for(b.unshift(this),c=[],d=0;d<b.length;d++)e=a(b[d]),e&&c.push(e);return c},L.prototype.getDependency=function(a,b){var c=a+":"+b,d=this.cache.get(c);if(!d){switch(a){case"scene":d=this.loadScene(b);break;case"node":d=this.loadNode(b);break;case"mesh":d=this._invokeOne(function(a){return a.loadMesh&&a.loadMesh(b)});break;case"accessor":d=this.loadAccessor(b);break;case"bufferView":d=this._invokeOne(function(a){return a.loadBufferView&&a.loadBufferView(b)});break;case"buffer":d=this.loadBuffer(b);break;case"material":d=this._invokeOne(function(a){return a.loadMaterial&&a.loadMaterial(b)});break;case"texture":d=this._invokeOne(function(a){return a.loadTexture&&a.loadTexture(b)});break;case"skin":d=this.loadSkin(b);break;case"animation":d=this.loadAnimation(b);break;case"camera":d=this.loadCamera(b);break;default:throw new Error("Unknown type: "+a)}this.cache.add(c,d)}return d},L.prototype.getDependencies=function(a){var c,d,b=this.cache.get(a);return b||(c=this,d=this.json[a+("mesh"===a?"es":"s")]||[],b=Promise.all(d.map(function(b,d){return c.getDependency(a,d)})),this.cache.add(a,b)),b},L.prototype.loadBuffer=function(a){var e,b=this.json.buffers[a],d=this.fileLoader;if(b.type&&"arraybuffer"!==b.type)throw new Error("THREE.GLTFLoader: "+b.type+" buffer type is not supported.");return void 0===b.uri&&0===a?Promise.resolve(this.extensions[c.KHR_BINARY_GLTF].body):(e=this.options,new Promise(function(a,c){d.load(D(b.uri,e.path),a,void 0,function(){c(new Error('THREE.GLTFLoader: Failed to load buffer "'+b.uri+'".'))})}))},L.prototype.loadBufferView=function(a){var b=this.json.bufferViews[a];return this.getDependency("buffer",b.buffer).then(function(a){var c=b.byteLength||0,d=b.byteOffset||0;return a.slice(d,d+c)})},L.prototype.loadAccessor=function(a){var e,b=this,c=this.json,d=this.json.accessors[a];return void 0===d.bufferView&&void 0===d.sparse?Promise.resolve(null):(e=[],void 0!==d.bufferView?e.push(this.getDependency("bufferView",d.bufferView)):e.push(null),void 0!==d.sparse&&(e.push(this.getDependency("bufferView",d.sparse.indices.bufferView)),e.push(this.getDependency("bufferView",d.sparse.values.bufferView))),Promise.all(e).then(function(a){var m,n,o,p,q,r,s,t,u,w,x,z,A,B,e=a[0],f=y[d.type],g=v[d.componentType],h=g.BYTES_PER_ELEMENT,i=h*f,j=d.byteOffset||0,k=void 0!==d.bufferView?c.bufferViews[d.bufferView].byteStride:void 0,l=d.normalized===!0;if(k&&k!==i?(o=Math.floor(j/k),p="InterleavedBuffer:"+d.bufferView+":"+d.componentType+":"+o+":"+d.count,q=b.cache.get(p),q||(m=new g(e,o*k,d.count*k/h),q=new THREE.InterleavedBuffer(m,k/h),b.cache.add(p,q)),n=new THREE.InterleavedBufferAttribute(q,f,j%k/h,l)):(m=null===e?new g(d.count*f):new g(e,j,d.count*f),n=new THREE.BufferAttribute(m,f,l)),void 0!==d.sparse)for(r=y.SCALAR,s=v[d.sparse.indices.componentType],t=d.sparse.indices.byteOffset||0,u=d.sparse.values.byteOffset||0,w=new s(a[1],t,d.sparse.count*r),x=new g(a[2],u,d.sparse.count*f),null!==e&&(n=new THREE.BufferAttribute(n.array.slice(),n.itemSize,n.normalized)),z=0,A=w.length;A>z;z++)if(B=w[z],n.setX(B,x[z*f]),f>=2&&n.setY(B,x[z*f+1]),f>=3&&n.setZ(B,x[z*f+2]),f>=4&&n.setW(B,x[z*f+3]),f>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.");return n}))},L.prototype.loadTexture=function(a){var g,b=this.json,c=this.options,d=b.textures[a],e=b.images[d.source],f=this.textureLoader;return e.uri&&(g=c.manager.getHandler(e.uri),null!==g&&(f=g)),this.loadTextureImage(a,e,f)},L.prototype.loadTextureImage=function(a,b,c){var d=this,e=this.json,f=this.options,g=e.textures[a],h=self.URL||self.webkitURL,i=b.uri,j=!1,k=!0;if("image/jpeg"===b.mimeType&&(k=!1),void 0!==b.bufferView)i=d.getDependency("bufferView",b.bufferView).then(function(a){var c,d;return"image/png"===b.mimeType&&(c=new DataView(a,25,1).getUint8(0,!1),k=6===c||4===c||3===c),j=!0,d=new Blob([a],{type:b.mimeType}),i=h.createObjectURL(d)});else if(void 0===b.uri)throw new Error("THREE.GLTFLoader: Image "+a+" is missing URI and bufferView");return Promise.resolve(i).then(function(a){return new Promise(function(b,d){var e=b;c.isImageBitmapLoader===!0&&(e=function(a){b(new THREE.CanvasTexture(a))}),c.load(D(a,f.path),e,void 0,d)})}).then(function(b){var c,f;return j===!0&&h.revokeObjectURL(i),b.flipY=!1,g.name&&(b.name=g.name),k||(b.format=THREE.RGBFormat),c=e.samplers||{},f=c[g.sampler]||{},b.magFilter=w[f.magFilter]||THREE.LinearFilter,b.minFilter=w[f.minFilter]||THREE.LinearMipmapLinearFilter,b.wrapS=x[f.wrapS]||THREE.RepeatWrapping,b.wrapT=x[f.wrapT]||THREE.RepeatWrapping,d.associations.set(b,{type:"textures",index:a}),b})},L.prototype.assignTexture=function(a,b,d){var e=this;return this.getDependency("texture",d.index).then(function(f){var g,h;void 0===d.texCoord||0==d.texCoord||"aoMap"===b&&1==d.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+d.texCoord+" for texture "+b+" not yet supported."),e.extensions[c.KHR_TEXTURE_TRANSFORM]&&(g=void 0!==d.extensions?d.extensions[c.KHR_TEXTURE_TRANSFORM]:void 0,g&&(h=e.associations.get(f),f=e.extensions[c.KHR_TEXTURE_TRANSFORM].extendTexture(f,g),e.associations.set(f,h))),a[b]=f})},L.prototype.assignFinalMaterial=function(a){var j,k,l,m,b=a.geometry,c=a.material,d=void 0!==b.attributes.tangent,e=void 0!==b.attributes.color,f=void 0===b.attributes.normal,g=a.isSkinnedMesh===!0,h=Object.keys(b.morphAttributes).length>0,i=h&&void 0!==b.morphAttributes.normal;a.isPoints?(j="PointsMaterial:"+c.uuid,k=this.cache.get(j),k||(k=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(k,c),k.color.copy(c.color),k.map=c.map,k.sizeAttenuation=!1,this.cache.add(j,k)),c=k):a.isLine&&(j="LineBasicMaterial:"+c.uuid,l=this.cache.get(j),l||(l=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(l,c),l.color.copy(c.color),this.cache.add(j,l)),c=l),(d||e||f||g||h)&&(j="ClonedMaterial:"+c.uuid+":",c.isGLTFSpecularGlossinessMaterial&&(j+="specular-glossiness:"),g&&(j+="skinning:"),d&&(j+="vertex-tangents:"),e&&(j+="vertex-colors:"),f&&(j+="flat-shading:"),h&&(j+="morph-targets:"),i&&(j+="morph-normals:"),m=this.cache.get(j),m||(m=c.clone(),g&&(m.skinning=!0),e&&(m.vertexColors=!0),f&&(m.flatShading=!0),h&&(m.morphTargets=!0),i&&(m.morphNormals=!0),d&&(m.vertexTangents=!0,m.normalScale&&(m.normalScale.y*=-1),m.clearcoatNormalScale&&(m.clearcoatNormalScale.y*=-1)),this.cache.add(j,m),this.associations.set(m,this.associations.get(c))),c=m),c.aoMap&&void 0===b.attributes.uv2&&void 0!==b.attributes.uv&&b.setAttribute("uv2",b.attributes.uv),a.material=c},L.prototype.getMaterialType=function(){return THREE.MeshStandardMaterial},L.prototype.loadMaterial=function(a){var g,k,l,m,n,o,b=this,d=this.json,e=this.extensions,f=d.materials[a],h={},i=f.extensions||{},j=[];return i[c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]?(k=e[c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS],g=k.getMaterialType(),j.push(k.extendParams(h,f,b))):i[c.KHR_MATERIALS_UNLIT]?(l=e[c.KHR_MATERIALS_UNLIT],g=l.getMaterialType(),j.push(l.extendParams(h,f,b))):(m=f.pbrMetallicRoughness||{},h.color=new THREE.Color(1,1,1),h.opacity=1,Array.isArray(m.baseColorFactor)&&(n=m.baseColorFactor,h.color.fromArray(n),h.opacity=n[3]),void 0!==m.baseColorTexture&&j.push(b.assignTexture(h,"map",m.baseColorTexture)),h.metalness=void 0!==m.metallicFactor?m.metallicFactor:1,h.roughness=void 0!==m.roughnessFactor?m.roughnessFactor:1,void 0!==m.metallicRoughnessTexture&&(j.push(b.assignTexture(h,"metalnessMap",m.metallicRoughnessTexture)),j.push(b.assignTexture(h,"roughnessMap",m.metallicRoughnessTexture))),g=this._invokeOne(function(b){return b.getMaterialType&&b.getMaterialType(a)
}),j.push(Promise.all(this._invokeAll(function(b){return b.extendMaterialParams&&b.extendMaterialParams(a,h)})))),f.doubleSided===!0&&(h.side=THREE.DoubleSide),o=f.alphaMode||C.OPAQUE,o===C.BLEND?(h.transparent=!0,h.depthWrite=!1):(h.transparent=!1,o===C.MASK&&(h.alphaTest=void 0!==f.alphaCutoff?f.alphaCutoff:.5)),void 0!==f.normalTexture&&g!==THREE.MeshBasicMaterial&&(j.push(b.assignTexture(h,"normalMap",f.normalTexture)),h.normalScale=new THREE.Vector2(1,-1),void 0!==f.normalTexture.scale&&h.normalScale.set(f.normalTexture.scale,-f.normalTexture.scale)),void 0!==f.occlusionTexture&&g!==THREE.MeshBasicMaterial&&(j.push(b.assignTexture(h,"aoMap",f.occlusionTexture)),void 0!==f.occlusionTexture.strength&&(h.aoMapIntensity=f.occlusionTexture.strength)),void 0!==f.emissiveFactor&&g!==THREE.MeshBasicMaterial&&(h.emissive=(new THREE.Color).fromArray(f.emissiveFactor)),void 0!==f.emissiveTexture&&g!==THREE.MeshBasicMaterial&&j.push(b.assignTexture(h,"emissiveMap",f.emissiveTexture)),Promise.all(j).then(function(){var d;return d=g===q?e[c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(h):new g(h),f.name&&(d.name=f.name),d.map&&(d.map.encoding=THREE.sRGBEncoding),d.emissiveMap&&(d.emissiveMap.encoding=THREE.sRGBEncoding),G(d,f),b.associations.set(d,{type:"materials",index:a}),f.extensions&&F(e,d,f),d})},L.prototype.createUniqueName=function(a){var d,b=THREE.PropertyBinding.sanitizeNodeName(a||""),c=b;for(d=1;this.nodeNamesUsed[c];++d)c=b+"_"+d;return this.nodeNamesUsed[c]=!0,c},L.prototype.loadGeometries=function(a){function f(a){return d[c.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,b).then(function(c){return N(c,a,b)})}var h,i,j,k,l,m,b=this,d=this.extensions,e=this.primitiveCache,g=[];for(h=0,i=a.length;i>h;h++)j=a[h],k=J(j),l=e[k],l?g.push(l.promise):(m=j.extensions&&j.extensions[c.KHR_DRACO_MESH_COMPRESSION]?f(j):N(new THREE.BufferGeometry,j,b),e[k]={primitive:j,promise:m},g.push(m));return Promise.all(g)},L.prototype.loadMesh=function(a){var h,i,j,b=this,c=this.json,d=this.extensions,e=c.meshes[a],f=e.primitives,g=[];for(h=0,i=f.length;i>h;h++)j=void 0===f[h].material?E(this.cache):this.getDependency("material",f[h].material),g.push(j);return g.push(b.loadGeometries(f)),Promise.all(g).then(function(c){var j,k,l,m,n,o,p,g=c.slice(0,c.length-1),h=c[c.length-1],i=[];for(j=0,k=h.length;k>j;j++){if(l=h[j],m=f[j],o=g[j],m.mode===u.TRIANGLES||m.mode===u.TRIANGLE_STRIP||m.mode===u.TRIANGLE_FAN||void 0===m.mode)n=e.isSkinnedMesh===!0?new THREE.SkinnedMesh(l,o):new THREE.Mesh(l,o),n.isSkinnedMesh!==!0||n.geometry.attributes.skinWeight.normalized||n.normalizeSkinWeights(),m.mode===u.TRIANGLE_STRIP?n.geometry=O(n.geometry,THREE.TriangleStripDrawMode):m.mode===u.TRIANGLE_FAN&&(n.geometry=O(n.geometry,THREE.TriangleFanDrawMode));else if(m.mode===u.LINES)n=new THREE.LineSegments(l,o);else if(m.mode===u.LINE_STRIP)n=new THREE.Line(l,o);else if(m.mode===u.LINE_LOOP)n=new THREE.LineLoop(l,o);else{if(m.mode!==u.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);n=new THREE.Points(l,o)}Object.keys(n.geometry.morphAttributes).length>0&&I(n,e),n.name=b.createUniqueName(e.name||"mesh_"+a),G(n,e),m.extensions&&F(d,n,m),b.assignFinalMaterial(n),i.push(n)}if(1===i.length)return i[0];for(p=new THREE.Group,j=0,k=i.length;k>j;j++)p.add(i[j]);return p})},L.prototype.loadCamera=function(a){var b,c=this.json.cameras[a],d=c[c.type];return d?("perspective"===c.type?b=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(d.yfov),d.aspectRatio||1,d.znear||1,d.zfar||2e6):"orthographic"===c.type&&(b=new THREE.OrthographicCamera(-d.xmag,d.xmag,d.ymag,-d.ymag,d.znear,d.zfar)),c.name&&(b.name=this.createUniqueName(c.name)),G(b,c),Promise.resolve(b)):(console.warn("THREE.GLTFLoader: Missing camera parameters."),void 0)},L.prototype.loadSkin=function(a){var b=this.json.skins[a],c={joints:b.joints};return void 0===b.inverseBindMatrices?Promise.resolve(c):this.getDependency("accessor",b.inverseBindMatrices).then(function(a){return c.inverseBindMatrices=a,c})},L.prototype.loadAnimation=function(a){var i,j,k,l,m,n,o,p,b=this.json,c=b.animations[a],d=[],e=[],f=[],g=[],h=[];for(i=0,j=c.channels.length;j>i;i++)k=c.channels[i],l=c.samplers[k.sampler],m=k.target,n=void 0!==m.node?m.node:m.id,o=void 0!==c.parameters?c.parameters[l.input]:l.input,p=void 0!==c.parameters?c.parameters[l.output]:l.output,d.push(this.getDependency("node",n)),e.push(this.getDependency("accessor",o)),f.push(this.getDependency("accessor",p)),g.push(l),h.push(m);return Promise.all([Promise.all(d),Promise.all(e),Promise.all(f),Promise.all(g),Promise.all(h)]).then(function(b){var j,k,l,m,n,o,p,q,r,s,u,v,w,x,y,z,C,D,d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=[];for(j=0,k=d.length;k>j;j++)if(l=d[j],m=e[j],n=f[j],o=g[j],p=h[j],void 0!==l){switch(l.updateMatrix(),l.matrixAutoUpdate=!0,A[p.path]){case A.weights:q=THREE.NumberKeyframeTrack;break;case A.rotation:q=THREE.QuaternionKeyframeTrack;break;case A.position:case A.scale:default:q=THREE.VectorKeyframeTrack}if(r=l.name?l.name:l.uuid,s=void 0!==o.interpolation?B[o.interpolation]:THREE.InterpolateLinear,u=[],A[p.path]===A.weights?l.traverse(function(a){a.isMesh===!0&&a.morphTargetInfluences&&u.push(a.name?a.name:a.uuid)}):u.push(r),v=n.array,n.normalized){if(v.constructor===Int8Array)w=1/127;else if(v.constructor===Uint8Array)w=1/255;else if(v.constructor==Int16Array)w=1/32767;else{if(v.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");w=1/65535}for(x=new Float32Array(v.length),y=0,z=v.length;z>y;y++)x[y]=v[y]*w;v=x}for(y=0,z=u.length;z>y;y++)C=new q(u[y]+"."+A[p.path],m.array,v,s),"CUBICSPLINE"===o.interpolation&&(C.createInterpolant=function(a){return new t(this.times,this.values,this.getValueSize()/3,a)},C.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),i.push(C)}return D=c.name?c.name:"animation_"+a,new THREE.AnimationClip(D,void 0,i)})},L.prototype.loadNode=function(a){var b=this.json,c=this.extensions,d=this,e=b.nodes[a],f=e.name?d.createUniqueName(e.name):"";return function(){var b=[];return void 0!==e.mesh&&b.push(d.getDependency("mesh",e.mesh).then(function(a){var b=d._getNodeRef(d.meshCache,e.mesh,a);return void 0!==e.weights&&b.traverse(function(a){if(a.isMesh)for(var b=0,c=e.weights.length;c>b;b++)a.morphTargetInfluences[b]=e.weights[b]}),b})),void 0!==e.camera&&b.push(d.getDependency("camera",e.camera).then(function(a){return d._getNodeRef(d.cameraCache,e.camera,a)})),d._invokeAll(function(b){return b.createNodeAttachment&&b.createNodeAttachment(a)}).forEach(function(a){b.push(a)}),Promise.all(b)}().then(function(b){var g,h,i,j;if(g=e.isBone===!0?new THREE.Bone:b.length>1?new THREE.Group:1===b.length?b[0]:new THREE.Object3D,g!==b[0])for(h=0,i=b.length;i>h;h++)g.add(b[h]);return e.name&&(g.userData.name=e.name,g.name=f),G(g,e),e.extensions&&F(c,g,e),void 0!==e.matrix?(j=new THREE.Matrix4,j.fromArray(e.matrix),g.applyMatrix4(j)):(void 0!==e.translation&&g.position.fromArray(e.translation),void 0!==e.rotation&&g.quaternion.fromArray(e.rotation),void 0!==e.scale&&g.scale.fromArray(e.scale)),d.associations.set(g,{type:"nodes",index:a}),g})},L.prototype.loadScene=function(){function a(b,c,d,e){var f=d.nodes[b];return e.getDependency("node",b).then(function(a){if(void 0===f.skin)return a;var b;return e.getDependency("skin",f.skin).then(function(a){var c,d,f;for(b=a,c=[],d=0,f=b.joints.length;f>d;d++)c.push(e.getDependency("node",b.joints[d]));return Promise.all(c)}).then(function(c){return a.traverse(function(a){var d,e,f,g,h,i;if(a.isMesh){for(d=[],e=[],f=0,g=c.length;g>f;f++)h=c[f],h?(d.push(h),i=new THREE.Matrix4,void 0!==b.inverseBindMatrices&&i.fromArray(b.inverseBindMatrices.array,16*f),e.push(i)):console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',b.joints[f]);a.bind(new THREE.Skeleton(d,e),a.matrixWorld)}}),a})}).then(function(b){var g,h,i,j,k;if(c.add(b),g=[],f.children)for(h=f.children,i=0,j=h.length;j>i;i++)k=h[i],g.push(a(k,b,d,e));return Promise.all(g)})}return function(b){var h,i,j,k,c=this.json,d=this.extensions,e=this.json.scenes[b],f=this,g=new THREE.Group;for(e.name&&(g.name=f.createUniqueName(e.name)),G(g,e),e.extensions&&F(d,g,e),h=e.nodes||[],i=[],j=0,k=h.length;k>j;j++)i.push(a(h[j],g,c,f));return Promise.all(i).then(function(){return g})}}(),a}();

THREE.RGBELoader=function(a){THREE.DataTextureLoader.call(this,a),this.type=THREE.UnsignedByteType},THREE.RGBELoader.prototype=Object.assign(Object.create(THREE.DataTextureLoader.prototype),{constructor:THREE.RGBELoader,parse:function(a){var r,s,t,u,v,w,x,y,z,A,B,b=-1,c=1,d=2,e=3,f=4,g=function(a,g){switch(a){case c:console.error("THREE.RGBELoader Read Error: "+(g||""));break;case d:console.error("THREE.RGBELoader Write Error: "+(g||""));break;case e:console.error("THREE.RGBELoader Bad File Format: "+(g||""));break;default:case f:console.error("THREE.RGBELoader: Error: "+(g||""))}return b},h=1,i=2,j=4,k="\n",l=function(a,b,c){b=b?b:1024;for(var d=a.pos,e=-1,f=0,g="",h=128,i=String.fromCharCode.apply(null,new Uint16Array(a.subarray(d,d+h)));0>(e=i.indexOf(k))&&b>f&&d<a.byteLength;)g+=i,f+=i.length,d+=h,i+=String.fromCharCode.apply(null,new Uint16Array(a.subarray(d,d+h)));return e>-1?(!1!==c&&(a.pos+=f+e+1),g+i.slice(0,e)):!1},m=function(a){var b,d,f=/^#\?(\S+)/,k=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,m=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,p={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(a.pos>=a.byteLength||!(b=l(a)))return g(c,"no header found");if(!(d=b.match(f)))return g(e,"bad initial token");for(p.valid|=h,p.programtype=d[1],p.string+=b+"\n";;){if(b=l(a),!1===b)break;if(p.string+=b+"\n","#"!==b.charAt(0)){if((d=b.match(k))&&(p.gamma=parseFloat(d[1],10)),(d=b.match(m))&&(p.exposure=parseFloat(d[1],10)),(d=b.match(n))&&(p.valid|=i,p.format=d[1]),(d=b.match(o))&&(p.valid|=j,p.height=parseInt(d[1],10),p.width=parseInt(d[2],10)),p.valid&i&&p.valid&j)break}else p.comments+=b+"\n"}return p.valid&i?p.valid&j?p:g(e,"missing image size specifier"):g(e,"missing format specifier")},n=function(a,b,d){var h,i,j,k,l,m,n,o,p,q,r,s,v,t=b,u=d;if(8>t||t>32767||2!==a[0]||2!==a[1]||128&a[2])return new Uint8Array(a);if(t!==(a[2]<<8|a[3]))return g(e,"wrong scanline width");if(h=new Uint8Array(4*b*d),!h.length)return g(f,"unable to allocate buffer space");for(i=0,j=0,o=4*t,v=new Uint8Array(4),m=new Uint8Array(o);u>0&&j<a.byteLength;){if(j+4>a.byteLength)return g(c);if(v[0]=a[j++],v[1]=a[j++],v[2]=a[j++],v[3]=a[j++],2!=v[0]||2!=v[1]||(v[2]<<8|v[3])!=t)return g(e,"bad rgbe scanline format");for(n=0;o>n&&j<a.byteLength;){if(k=a[j++],s=k>128,s&&(k-=128),0===k||n+k>o)return g(e,"bad scanline data");if(s)for(l=a[j++],p=0;k>p;p++)m[n++]=l;else m.set(a.subarray(j,j+k),n),n+=k,j+=k}for(q=t,p=0;q>p;p++)r=0,h[i]=m[p+r],r+=t,h[i+1]=m[p+r],r+=t,h[i+2]=m[p+r],r+=t,h[i+3]=m[p+r],i+=4;u--}return h},o=function(a,b,c,d){var e=a[b+3],f=Math.pow(2,e-128)/255;c[d+0]=a[b+0]*f,c[d+1]=a[b+1]*f,c[d+2]=a[b+2]*f},p=function(a,b,c,d){var e=a[b+3],f=Math.pow(2,e-128)/255;c[d+0]=THREE.DataUtils.toHalfFloat(a[b+0]*f),c[d+1]=THREE.DataUtils.toHalfFloat(a[b+1]*f),c[d+2]=THREE.DataUtils.toHalfFloat(a[b+2]*f)},q=new Uint8Array(a);if(q.pos=0,r=m(q),b!==r&&(s=r.width,t=r.height,u=n(q.subarray(q.pos),s,t),b!==u)){switch(this.type){case THREE.UnsignedByteType:v=u,w=THREE.RGBEFormat,x=THREE.UnsignedByteType;break;case THREE.FloatType:for(y=3*(u.length/4),z=new Float32Array(y),A=0;y>A;A++)o(u,4*A,z,3*A);v=z,w=THREE.RGBFormat,x=THREE.FloatType;break;case THREE.HalfFloatType:for(y=3*(u.length/4),B=new Uint16Array(y),A=0;y>A;A++)p(u,4*A,B,3*A);v=B,w=THREE.RGBFormat,x=THREE.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:s,height:t,data:v,header:r.string,gamma:r.gamma,exposure:r.exposure,format:w,type:x}}return null},setDataType:function(a){return this.type=a,this},load:function(a,b,c,d){function e(a,c){switch(a.type){case THREE.UnsignedByteType:a.encoding=THREE.RGBEEncoding,a.minFilter=THREE.NearestFilter,a.magFilter=THREE.NearestFilter,a.generateMipmaps=!1,a.flipY=!0;break;case THREE.FloatType:a.encoding=THREE.LinearEncoding,a.minFilter=THREE.LinearFilter,a.magFilter=THREE.LinearFilter,a.generateMipmaps=!1,a.flipY=!0;break;case THREE.HalfFloatType:a.encoding=THREE.LinearEncoding,a.minFilter=THREE.LinearFilter,a.magFilter=THREE.LinearFilter,a.generateMipmaps=!1,a.flipY=!0}b&&b(a,c)}return THREE.DataTextureLoader.prototype.load.call(this,a,e,c,d)}});

THREE.FBXLoader=function(){function d(a){THREE.Loader.call(this,a)}function e(a,b){this.textureLoader=a,this.manager=b}function f(){}function g(){}function h(){}function i(){}function j(a,b){this.dv=new DataView(a),this.offset=0,this.littleEndian=void 0!==b?b:!0}function k(){}function l(a){var b="Kaydara FBX Binary  \0";return a.byteLength>=b.length&&b===w(a,0,b.length)}function m(a){function d(b){var d=a[b-1];return a=a.slice(c+b),c++,d}var e,f,b=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],c=0;for(e=0;e<b.length;++e)if(f=d(1),f===b[e])return!1;return!0}function n(a){var d,b=/FBXVersion: (\d+)/,c=a.match(b);if(c)return d=parseInt(c[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function o(a){return a/46186158e3}function q(a,b,c,d){var e,f,g;switch(d.mappingType){case"ByPolygonVertex":e=a;break;case"ByPolygon":e=b;break;case"ByVertice":e=c;break;case"AllSame":e=d.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+d.mappingType)}return"IndexToDirect"===d.referenceType&&(e=d.indices[e]),f=e*d.dataSize,g=f+d.dataSize,y(p,d.buffer,f,g)}function t(a){var o,p,q,t,u,v,w,x,y,z,A,B,C,D,E,F,b=new THREE.Matrix4,c=new THREE.Matrix4,d=new THREE.Matrix4,e=new THREE.Matrix4,f=new THREE.Matrix4,g=new THREE.Matrix4,h=new THREE.Matrix4,i=new THREE.Matrix4,j=new THREE.Matrix4,k=new THREE.Matrix4,l=new THREE.Matrix4,m=new THREE.Matrix4,n=a.inheritType?a.inheritType:0;return a.translation&&b.setPosition(s.fromArray(a.translation)),a.preRotation&&(o=a.preRotation.map(THREE.MathUtils.degToRad),o.push(a.eulerOrder),c.makeRotationFromEuler(r.fromArray(o))),a.rotation&&(o=a.rotation.map(THREE.MathUtils.degToRad),o.push(a.eulerOrder),d.makeRotationFromEuler(r.fromArray(o))),a.postRotation&&(o=a.postRotation.map(THREE.MathUtils.degToRad),o.push(a.eulerOrder),e.makeRotationFromEuler(r.fromArray(o)),e.invert()),a.scale&&f.scale(s.fromArray(a.scale)),a.scalingOffset&&h.setPosition(s.fromArray(a.scalingOffset)),a.scalingPivot&&g.setPosition(s.fromArray(a.scalingPivot)),a.rotationOffset&&i.setPosition(s.fromArray(a.rotationOffset)),a.rotationPivot&&j.setPosition(s.fromArray(a.rotationPivot)),a.parentMatrixWorld&&(l.copy(a.parentMatrix),k.copy(a.parentMatrixWorld)),p=(new THREE.Matrix4).copy(c).multiply(d).multiply(e),q=new THREE.Matrix4,q.extractRotation(k),t=new THREE.Matrix4,t.copyPosition(k),u=new THREE.Matrix4,v=(new THREE.Matrix4).copy(t).invert().multiply(k),u.copy(q).invert().multiply(v),w=f,x=new THREE.Matrix4,0===n?x.copy(q).multiply(p).multiply(u).multiply(w):1===n?x.copy(q).multiply(u).multiply(p).multiply(w):(y=(new THREE.Matrix4).scale((new THREE.Vector3).setFromMatrixScale(l)),z=(new THREE.Matrix4).copy(y).invert(),A=(new THREE.Matrix4).copy(u).multiply(z),x.copy(q).multiply(p).multiply(A).multiply(w)),B=new THREE.Matrix4,B.copy(j).invert(),C=new THREE.Matrix4,C.copy(g).invert(),D=new THREE.Matrix4,D.copy(b).multiply(i).multiply(j).multiply(c).multiply(d).multiply(e).multiply(B).multiply(h).multiply(g).multiply(f).multiply(C),E=(new THREE.Matrix4).copyPosition(D),F=(new THREE.Matrix4).copy(k).multiply(E),m.copyPosition(F),D=(new THREE.Matrix4).copy(m).multiply(x),D.premultiply(k.invert()),D}function u(a){a=a||0;var b=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===a?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),b[0]):b[a]}function v(a){var b=a.split(",").map(function(a){return parseFloat(a)});return b}function w(a,b,c){return void 0===b&&(b=0),void 0===c&&(c=a.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(a,b,c))}function x(a,b){for(var c=0,d=a.length,e=b.length;e>c;c++,d++)a[d]=b[c]}function y(a,b,c,d){for(var e=c,f=0;d>e;e++,f++)a[f]=b[e];return a}function z(a,b,c){return a.slice(0,b).concat(c).concat(a.slice(b))}var a,b,c,p,r,s;return d.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:d,load:function(a,b,c,d){var e=this,f=""===e.path?THREE.LoaderUtils.extractUrlBase(a):e.path,g=new THREE.FileLoader(this.manager);g.setPath(e.path),g.setResponseType("arraybuffer"),g.setRequestHeader(e.requestHeader),g.setWithCredentials(e.withCredentials),g.load(a,function(c){try{b(e.parse(c,f))}catch(g){d?d(g):console.error(g),e.manager.itemError(a)}},c,d)},parse:function(b,c){var d,f;if(l(b))a=(new i).parse(b);else{if(d=w(b),!m(d))throw new Error("THREE.FBXLoader: Unknown format.");if(n(d)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n(d));a=(new h).parse(d)}return f=new THREE.TextureLoader(this.manager).setPath(this.resourcePath||c).setCrossOrigin(this.crossOrigin),new e(f,this.manager).parse(a)}}),e.prototype={constructor:e,parse:function(){var a,d,e,g,h;return b=this.parseConnections(),a=this.parseImages(),d=this.parseTextures(a),e=this.parseMaterials(d),g=this.parseDeformers(),h=(new f).parse(g),this.parseScene(g,h,e),c},parseConnections:function(){var c,b=new Map;return"Connections"in a&&(c=a.Connections.connections,c.forEach(function(a){var f,g,c=a[0],d=a[1],e=a[2];b.has(c)||b.set(c,{parents:[],children:[]}),f={ID:d,relationship:e},b.get(c).parents.push(f),b.has(d)||b.set(d,{parents:[],children:[]}),g={ID:c,relationship:e},b.get(d).children.push(g)})),b},parseImages:function(){var d,e,f,g,h,i,j,k,b={},c={};if("Video"in a.Objects){d=a.Objects.Video;for(e in d)f=d[e],g=parseInt(e),b[g]=f.RelativeFilename||f.Filename,"Content"in f&&(h=f.Content instanceof ArrayBuffer&&f.Content.byteLength>0,i="string"==typeof f.Content&&""!==f.Content,(h||i)&&(j=this.parseImage(d[e]),c[f.RelativeFilename||f.Filename]=j))}for(g in b)k=b[g],b[g]=void 0!==c[k]?c[k]:b[g].split("\\").pop();return b},parseImage:function(a){var e,f,b=a.Content,c=a.RelativeFilename||a.Filename,d=c.slice(c.lastIndexOf(".")+1).toLowerCase();switch(d){case"bmp":e="image/bmp";break;case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;case"tif":e="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",c),e="image/tga";break;default:return console.warn('FBXLoader: Image type "'+d+'" is not supported.'),void 0}return"string"==typeof b?"data:"+e+";base64,"+b:(f=new Uint8Array(b),window.URL.createObjectURL(new Blob([f],{type:e})))},parseTextures:function(b){var d,e,f,c=new Map;if("Texture"in a.Objects){d=a.Objects.Texture;for(e in d)f=this.parseTexture(d[e],b),c.set(parseInt(e),f)}return c},parseTexture:function(a,b){var d,e,f,g,h,c=this.loadTexture(a,b);return c.ID=a.id,c.name=a.attrName,d=a.WrapModeU,e=a.WrapModeV,f=void 0!==d?d.value:0,g=void 0!==e?e.value:0,c.wrapS=0===f?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,c.wrapT=0===g?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in a&&(h=a.Scaling.value,c.repeat.x=h[0],c.repeat.y=h[1]),c},loadTexture:function(a,c){var d,g,h,i,e=this.textureLoader.path,f=b.get(a.id).children;return void 0!==f&&f.length>0&&void 0!==c[f[0].ID]&&(d=c[f[0].ID],(0===d.indexOf("blob:")||0===d.indexOf("data:"))&&this.textureLoader.setPath(void 0)),h=a.FileName.slice(-3).toLowerCase(),"tga"===h?(i=this.manager.getHandler(".tga"),null===i?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",a.RelativeFilename),g=new THREE.Texture):g=i.load(d)):"psd"===h?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",a.RelativeFilename),g=new THREE.Texture):g=this.textureLoader.load(d),this.textureLoader.setPath(e),g},parseMaterials:function(b){var d,e,f,c=new Map;if("Material"in a.Objects){d=a.Objects.Material;for(e in d)f=this.parseMaterial(d[e],b),null!==f&&c.set(parseInt(e),f)}return c},parseMaterial:function(a,c){var g,h,d=a.id,e=a.attrName,f=a.ShadingModel;if("object"==typeof f&&(f=f.value),!b.has(d))return null;switch(g=this.parseParameters(a,c,d),f.toLowerCase()){case"phong":h=new THREE.MeshPhongMaterial;break;case"lambert":h=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',f),h=new THREE.MeshPhongMaterial}return h.setValues(g),h.name=e,h},parseParameters:function(a,c,d){var f,e={};return a.BumpFactor&&(e.bumpScale=a.BumpFactor.value),a.Diffuse?e.color=(new THREE.Color).fromArray(a.Diffuse.value):!a.DiffuseColor||"Color"!==a.DiffuseColor.type&&"ColorRGB"!==a.DiffuseColor.type||(e.color=(new THREE.Color).fromArray(a.DiffuseColor.value)),a.DisplacementFactor&&(e.displacementScale=a.DisplacementFactor.value),a.Emissive?e.emissive=(new THREE.Color).fromArray(a.Emissive.value):!a.EmissiveColor||"Color"!==a.EmissiveColor.type&&"ColorRGB"!==a.EmissiveColor.type||(e.emissive=(new THREE.Color).fromArray(a.EmissiveColor.value)),a.EmissiveFactor&&(e.emissiveIntensity=parseFloat(a.EmissiveFactor.value)),a.Opacity&&(e.opacity=parseFloat(a.Opacity.value)),e.opacity<1&&(e.transparent=!0),a.ReflectionFactor&&(e.reflectivity=a.ReflectionFactor.value),a.Shininess&&(e.shininess=a.Shininess.value),a.Specular?e.specular=(new THREE.Color).fromArray(a.Specular.value):a.SpecularColor&&"Color"===a.SpecularColor.type&&(e.specular=(new THREE.Color).fromArray(a.SpecularColor.value)),f=this,b.get(d).children.forEach(function(a){var b=a.relationship;switch(b){case"Bump":e.bumpMap=f.getTexture(c,a.ID);break;case"Maya|TEX_ao_map":e.aoMap=f.getTexture(c,a.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":e.map=f.getTexture(c,a.ID),e.map.encoding=THREE.sRGBEncoding;break;case"DisplacementColor":e.displacementMap=f.getTexture(c,a.ID);break;case"EmissiveColor":e.emissiveMap=f.getTexture(c,a.ID),e.emissiveMap.encoding=THREE.sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":e.normalMap=f.getTexture(c,a.ID);break;case"ReflectionColor":e.envMap=f.getTexture(c,a.ID),e.envMap.mapping=THREE.EquirectangularReflectionMapping,e.envMap.encoding=THREE.sRGBEncoding;break;case"SpecularColor":e.specularMap=f.getTexture(c,a.ID),e.specularMap.encoding=THREE.sRGBEncoding;break;case"TransparentColor":case"TransparencyFactor":e.alphaMap=f.getTexture(c,a.ID),e.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",b)}}),e},getTexture:function(c,d){return"LayeredTexture"in a.Objects&&d in a.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),d=b.get(d).children[0].ID),c.get(d)},parseDeformers:function(){var e,f,g,h,i,j,c={},d={};if("Deformer"in a.Objects){e=a.Objects.Deformer;for(f in e)g=e[f],h=b.get(parseInt(f)),"Skin"===g.attrType?(i=this.parseSkeleton(h,e),i.ID=f,h.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),i.geometryID=h.parents[0].ID,c[f]=i):"BlendShape"===g.attrType&&(j={id:f},j.rawTargets=this.parseMorphTargets(h,e),j.id=f,h.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),d[f]=j)}return{skeletons:c,morphTargets:d}},parseSkeleton:function(a,b){var c=[];return a.children.forEach(function(a){var e,d=b[a.ID];"Cluster"===d.attrType&&(e={ID:a.ID,indices:[],weights:[],transformLink:(new THREE.Matrix4).fromArray(d.TransformLink.a)},"Indexes"in d&&(e.indices=d.Indexes.a,e.weights=d.Weights.a),c.push(e))}),{rawBones:c,bones:[]}},parseMorphTargets:function(a,c){var e,f,g,h,d=[];for(e=0;e<a.children.length;e++){if(f=a.children[e],g=c[f.ID],h={name:g.attrName,initialWeight:g.DeformPercent,id:g.id,fullWeights:g.FullWeights.a},"BlendShapeChannel"!==g.attrType)return;h.geoID=b.get(parseInt(f.ID)).children.filter(function(a){return void 0===a.relationship})[0].ID,d.push(h)}return d},parseScene:function(d,e,f){var h,i,j,k;c=new THREE.Group,h=this.parseModels(d.skeletons,e,f),i=a.Objects.Model,j=this,h.forEach(function(a){var e,d=i[a.ID];j.setLookAtProperties(a,d),e=b.get(a.ID).parents,e.forEach(function(b){var c=h.get(b.ID);void 0!==c&&c.add(a)}),null===a.parent&&c.add(a)}),this.bindSkeleton(d.skeletons,e,h),this.createAmbientLight(),this.setupMorphMaterials(),c.traverse(function(a){if(a.userData.transformData){a.parent&&(a.userData.transformData.parentMatrix=a.parent.matrix,a.userData.transformData.parentMatrixWorld=a.parent.matrixWorld);var b=t(a.userData.transformData);a.applyMatrix4(b),a.updateWorldMatrix()}}),k=(new g).parse(),1===c.children.length&&c.children[0].isGroup&&(c.children[0].animations=k,c=c.children[0]),c.animations=k},parseModels:function(c,d,e){var h,i,j,k,l,f=new Map,g=a.Objects.Model;for(h in g){if(i=parseInt(h),j=g[h],k=b.get(i),l=this.buildSkeleton(k,c,i,j.attrName),!l){switch(j.attrType){case"Camera":l=this.createCamera(k);break;case"Light":l=this.createLight(k);break;case"Mesh":l=this.createMesh(k,d,e);break;case"NurbsCurve":l=this.createCurve(k,d);break;case"LimbNode":case"Root":l=new THREE.Bone;break;case"Null":default:l=new THREE.Group}l.name=j.attrName?THREE.PropertyBinding.sanitizeNodeName(j.attrName):"",l.ID=i}this.getTransformData(l,j),f.set(i,l)}return f},buildSkeleton:function(a,b,c,d){var e=null;return a.parents.forEach(function(a){var f,g;for(f in b)g=b[f],g.rawBones.forEach(function(b,f){if(b.ID===a.ID){var h=e;e=new THREE.Bone,e.matrixWorld.copy(b.transformLink),e.name=d?THREE.PropertyBinding.sanitizeNodeName(d):"",e.ID=c,g.bones[f]=e,null!==h&&e.add(h)}})}),e},createCamera:function(b){var c,d,e,f,g,h,i,j,k,l;if(b.children.forEach(function(b){var c=a.Objects.NodeAttribute[b.ID];void 0!==c&&(d=c)}),void 0===d)c=new THREE.Object3D;else switch(e=0,void 0!==d.CameraProjectionType&&1===d.CameraProjectionType.value&&(e=1),f=1,void 0!==d.NearPlane&&(f=d.NearPlane.value/1e3),g=1e3,void 0!==d.FarPlane&&(g=d.FarPlane.value/1e3),h=window.innerWidth,i=window.innerHeight,void 0!==d.AspectWidth&&void 0!==d.AspectHeight&&(h=d.AspectWidth.value,i=d.AspectHeight.value),j=h/i,k=45,void 0!==d.FieldOfView&&(k=d.FieldOfView.value),l=d.FocalLength?d.FocalLength.value:null,e){case 0:c=new THREE.PerspectiveCamera(k,j,f,g),null!==l&&c.setFocalLength(l);break;case 1:c=new THREE.OrthographicCamera(-h/2,h/2,i/2,-i/2,f,g);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),c=new THREE.Object3D}return c},createLight:function(b){var c,d,e,f,g,h,i,j,k;if(b.children.forEach(function(b){var c=a.Objects.NodeAttribute[b.ID];void 0!==c&&(d=c)}),void 0===d)c=new THREE.Object3D;else{switch(e=void 0===d.LightType?0:d.LightType.value,f=16777215,void 0!==d.Color&&(f=(new THREE.Color).fromArray(d.Color.value)),g=void 0===d.Intensity?1:d.Intensity.value/100,void 0!==d.CastLightOnObject&&0===d.CastLightOnObject.value&&(g=0),h=0,void 0!==d.FarAttenuationEnd&&(h=void 0!==d.EnableFarAttenuation&&0===d.EnableFarAttenuation.value?0:d.FarAttenuationEnd.value),i=1,e){case 0:c=new THREE.PointLight(f,g,h,i);break;case 1:c=new THREE.DirectionalLight(f,g);break;case 2:j=Math.PI/3,void 0!==d.InnerAngle&&(j=THREE.MathUtils.degToRad(d.InnerAngle.value)),k=0,void 0!==d.OuterAngle&&(k=THREE.MathUtils.degToRad(d.OuterAngle.value),k=Math.max(k,1)),c=new THREE.SpotLight(f,g,h,j,k,i);break;default:console.warn("THREE.FBXLoader: Unknown light type "+d.LightType.value+", defaulting to a THREE.PointLight."),c=new THREE.PointLight(f,g)}void 0!==d.CastShadows&&1===d.CastShadows.value&&(c.castShadow=!0)}return c},createMesh:function(a,b,c){var d,e=null,f=null,g=[];return a.children.forEach(function(a){b.has(a.ID)&&(e=b.get(a.ID)),c.has(a.ID)&&g.push(c.get(a.ID))}),g.length>1?f=g:g.length>0?f=g[0]:(f=new THREE.MeshPhongMaterial({color:13421772}),g.push(f)),"color"in e.attributes&&g.forEach(function(a){a.vertexColors=!0}),e.FBX_Deformer?(g.forEach(function(a){a.skinning=!0}),d=new THREE.SkinnedMesh(e,f),d.normalizeSkinWeights()):d=new THREE.Mesh(e,f),d},createCurve:function(a,b){var c=a.children.reduce(function(a,c){return b.has(c.ID)&&(a=b.get(c.ID)),a},null),d=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(c,d)},getTransformData:function(a,b){var c={};"InheritType"in b&&(c.inheritType=parseInt(b.InheritType.value)),c.eulerOrder="RotationOrder"in b?u(b.RotationOrder.value):"ZYX","Lcl_Translation"in b&&(c.translation=b.Lcl_Translation.value),"PreRotation"in b&&(c.preRotation=b.PreRotation.value),"Lcl_Rotation"in b&&(c.rotation=b.Lcl_Rotation.value),"PostRotation"in b&&(c.postRotation=b.PostRotation.value),"Lcl_Scaling"in b&&(c.scale=b.Lcl_Scaling.value),"ScalingOffset"in b&&(c.scalingOffset=b.ScalingOffset.value),"ScalingPivot"in b&&(c.scalingPivot=b.ScalingPivot.value),"RotationOffset"in b&&(c.rotationOffset=b.RotationOffset.value),"RotationPivot"in b&&(c.rotationPivot=b.RotationPivot.value),a.userData.transformData=c},setLookAtProperties:function(d,e){if("LookAtProperty"in e){var f=b.get(d.ID).children;f.forEach(function(b){var e,f;"LookAtProperty"===b.relationship&&(e=a.Objects.Model[b.ID],"Lcl_Translation"in e&&(f=e.Lcl_Translation.value,void 0!==d.target?(d.target.position.fromArray(f),c.add(d.target)):d.lookAt((new THREE.Vector3).fromArray(f))))})}},bindSkeleton:function(a,c,d){var f,g,h,e=this.parsePoseNodes();for(f in a)g=a[f],h=b.get(parseInt(g.ID)).parents,h.forEach(function(a){var f,h;c.has(a.ID)&&(f=a.ID,h=b.get(f),h.parents.forEach(function(a){if(d.has(a.ID)){var b=d.get(a.ID);b.bind(new THREE.Skeleton(g.bones),e[a.ID])}}))})},parsePoseNodes:function(){var c,d,e,b={};if("Pose"in a.Objects){c=a.Objects.Pose;for(d in c)"BindPose"===c[d].attrType&&(e=c[d].PoseNode,Array.isArray(e)?e.forEach(function(a){b[a.Node]=(new THREE.Matrix4).fromArray(a.Matrix.a)}):b[e.Node]=(new THREE.Matrix4).fromArray(e.Matrix.a))}return b},createAmbientLight:function(){var b,d,e,f,g;"GlobalSettings"in a&&"AmbientColor"in a.GlobalSettings&&(b=a.GlobalSettings.AmbientColor.value,d=b[0],e=b[1],f=b[2],(0!==d||0!==e||0!==f)&&(g=new THREE.Color(d,e,f),c.add(new THREE.AmbientLight(g,1))))},setupMorphMaterials:function(){var a=this;c.traverse(function(b){b.isMesh&&b.geometry.morphAttributes.position&&b.geometry.morphAttributes.position.length&&(Array.isArray(b.material)?b.material.forEach(function(c,d){a.setupMorphMaterial(b,c,d)}):a.setupMorphMaterial(b,b.material))})},setupMorphMaterial:function(a,b,d){var h,e=a.uuid,f=b.uuid,g=!1;c.traverse(function(a){a.isMesh&&(Array.isArray(a.material)?a.material.forEach(function(b){b.uuid===f&&a.uuid!==e&&(g=!0)}):a.material.uuid===f&&a.uuid!==e&&(g=!0))}),g===!0?(h=b.clone(),h.morphTargets=!0,void 0===d?a.material=h:a.material[d]=h):b.morphTargets=!0}},f.prototype={constructor:f,parse:function(c){var e,f,g,h,d=new Map;if("Geometry"in a.Objects){e=a.Objects.Geometry;for(f in e)g=b.get(parseInt(f)),h=this.parseGeometry(g,e[f],c),d.set(parseInt(f),h)}return d},parseGeometry:function(a,b,c){switch(b.attrType){case"Mesh":return this.parseMeshGeometry(a,b,c);case"NurbsCurve":return this.parseNurbsGeometry(b)}},parseMeshGeometry:function(b,c,d){var h,i,j,k,e=d.skeletons,f=[],g=b.parents.map(function(b){return a.Objects.Model[b.ID]});if(0!==g.length)return h=b.children.reduce(function(a,b){return void 0!==e[b.ID]&&(a=e[b.ID]),a},null),b.children.forEach(function(a){void 0!==d.morphTargets[a.ID]&&f.push(d.morphTargets[a.ID])}),i=g[0],j={},"RotationOrder"in i&&(j.eulerOrder=u(i.RotationOrder.value)),"InheritType"in i&&(j.inheritType=parseInt(i.InheritType.value)),"GeometricTranslation"in i&&(j.translation=i.GeometricTranslation.value),"GeometricRotation"in i&&(j.rotation=i.GeometricRotation.value),"GeometricScaling"in i&&(j.scale=i.GeometricScaling.value),k=t(j),this.genGeometry(c,h,f,k)},genGeometry:function(a,b,c,d){var f,g,h,i,j,k,l,m,n,e=new THREE.BufferGeometry;return a.attrName&&(e.name=a.attrName),f=this.parseGeoNode(a,b),g=this.genBuffers(f),h=new THREE.Float32BufferAttribute(g.vertex,3),h.applyMatrix4(d),e.setAttribute("position",h),g.colors.length>0&&e.setAttribute("color",new THREE.Float32BufferAttribute(g.colors,3)),b&&(e.setAttribute("skinIndex",new THREE.Uint16BufferAttribute(g.weightsIndices,4)),e.setAttribute("skinWeight",new THREE.Float32BufferAttribute(g.vertexWeights,4)),e.FBX_Deformer=b),g.normal.length>0&&(i=(new THREE.Matrix3).getNormalMatrix(d),j=new THREE.Float32BufferAttribute(g.normal,3),j.applyNormalMatrix(i),e.setAttribute("normal",j)),g.uvs.forEach(function(a,b){var c="uv"+(b+1).toString();0===b&&(c="uv"),e.setAttribute(c,new THREE.Float32BufferAttribute(g.uvs[b],2))}),f.material&&"AllSame"!==f.material.mappingType&&(k=g.materialIndex[0],l=0,g.materialIndex.forEach(function(a,b){a!==k&&(e.addGroup(l,b-l,k),k=a,l=b)}),e.groups.length>0&&(m=e.groups[e.groups.length-1],n=m.start+m.count,n!==g.materialIndex.length&&e.addGroup(n,g.materialIndex.length-n,k)),0===e.groups.length&&e.addGroup(0,g.materialIndex.length,g.materialIndex[0])),this.addMorphTargets(e,a,c,d),e},parseGeoNode:function(a,b){var d,c={};if(c.vertexPositions=void 0!==a.Vertices?a.Vertices.a:[],c.vertexIndices=void 0!==a.PolygonVertexIndex?a.PolygonVertexIndex.a:[],a.LayerElementColor&&(c.color=this.parseVertexColors(a.LayerElementColor[0])),a.LayerElementMaterial&&(c.material=this.parseMaterialIndices(a.LayerElementMaterial[0])),a.LayerElementNormal&&(c.normal=this.parseNormals(a.LayerElementNormal[0])),a.LayerElementUV)for(c.uv=[],d=0;a.LayerElementUV[d];)a.LayerElementUV[d].UV&&c.uv.push(this.parseUVs(a.LayerElementUV[d])),d++;return c.weightTable={},null!==b&&(c.skeleton=b,b.rawBones.forEach(function(a,b){a.indices.forEach(function(d,e){void 0===c.weightTable[d]&&(c.weightTable[d]=[]),c.weightTable[d].push({id:b,weight:a.weights[e]})})})),c},genBuffers:function(a){var b={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},c=0,d=0,e=!1,f=[],g=[],h=[],i=[],j=[],k=[],l=this;return a.vertexIndices.forEach(function(m,n){var p,r,s,t,u,v,w,o=!1;if(0>m&&(m=-1^m,o=!0),p=[],r=[],f.push(3*m,3*m+1,3*m+2),a.color&&(s=q(n,c,m,a.color),h.push(s[0],s[1],s[2])),a.skeleton){for(void 0!==a.weightTable[m]&&a.weightTable[m].forEach(function(a){r.push(a.weight),p.push(a.id)}),r.length>4&&(e||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),e=!0),t=[0,0,0,0],u=[0,0,0,0],r.forEach(function(a,b){var c=a,d=p[b];u.forEach(function(a,b,e){if(c>a){e[b]=c,c=a;var f=t[b];t[b]=d,d=f}})}),p=t,r=u);r.length<4;)r.push(0),p.push(0);for(v=0;4>v;++v)j.push(r[v]),k.push(p[v])}a.normal&&(s=q(n,c,m,a.normal),g.push(s[0],s[1],s[2])),a.material&&"AllSame"!==a.material.mappingType&&(w=q(n,c,m,a.material)[0]),a.uv&&a.uv.forEach(function(a,b){var d=q(n,c,m,a);void 0===i[b]&&(i[b]=[]),i[b].push(d[0]),i[b].push(d[1])}),d++,o&&(l.genFace(b,a,f,w,g,h,i,j,k,d),c++,d=0,f=[],g=[],h=[],i=[],j=[],k=[])}),b},genFace:function(a,b,c,d,e,f,g,h,i,j){for(var k=2;j>k;k++)a.vertex.push(b.vertexPositions[c[0]]),a.vertex.push(b.vertexPositions[c[1]]),a.vertex.push(b.vertexPositions[c[2]]),a.vertex.push(b.vertexPositions[c[3*(k-1)]]),a.vertex.push(b.vertexPositions[c[3*(k-1)+1]]),a.vertex.push(b.vertexPositions[c[3*(k-1)+2]]),a.vertex.push(b.vertexPositions[c[3*k]]),a.vertex.push(b.vertexPositions[c[3*k+1]]),a.vertex.push(b.vertexPositions[c[3*k+2]]),b.skeleton&&(a.vertexWeights.push(h[0]),a.vertexWeights.push(h[1]),a.vertexWeights.push(h[2]),a.vertexWeights.push(h[3]),a.vertexWeights.push(h[4*(k-1)]),a.vertexWeights.push(h[4*(k-1)+1]),a.vertexWeights.push(h[4*(k-1)+2]),a.vertexWeights.push(h[4*(k-1)+3]),a.vertexWeights.push(h[4*k]),a.vertexWeights.push(h[4*k+1]),a.vertexWeights.push(h[4*k+2]),a.vertexWeights.push(h[4*k+3]),a.weightsIndices.push(i[0]),a.weightsIndices.push(i[1]),a.weightsIndices.push(i[2]),a.weightsIndices.push(i[3]),a.weightsIndices.push(i[4*(k-1)]),a.weightsIndices.push(i[4*(k-1)+1]),a.weightsIndices.push(i[4*(k-1)+2]),a.weightsIndices.push(i[4*(k-1)+3]),a.weightsIndices.push(i[4*k]),a.weightsIndices.push(i[4*k+1]),a.weightsIndices.push(i[4*k+2]),a.weightsIndices.push(i[4*k+3])),b.color&&(a.colors.push(f[0]),a.colors.push(f[1]),a.colors.push(f[2]),a.colors.push(f[3*(k-1)]),a.colors.push(f[3*(k-1)+1]),a.colors.push(f[3*(k-1)+2]),a.colors.push(f[3*k]),a.colors.push(f[3*k+1]),a.colors.push(f[3*k+2])),b.material&&"AllSame"!==b.material.mappingType&&(a.materialIndex.push(d),a.materialIndex.push(d),a.materialIndex.push(d)),b.normal&&(a.normal.push(e[0]),a.normal.push(e[1]),a.normal.push(e[2]),a.normal.push(e[3*(k-1)]),a.normal.push(e[3*(k-1)+1]),a.normal.push(e[3*(k-1)+2]),a.normal.push(e[3*k]),a.normal.push(e[3*k+1]),a.normal.push(e[3*k+2])),b.uv&&b.uv.forEach(function(b,c){void 0===a.uvs[c]&&(a.uvs[c]=[]),a.uvs[c].push(g[c][0]),a.uvs[c].push(g[c][1]),a.uvs[c].push(g[c][2*(k-1)]),a.uvs[c].push(g[c][2*(k-1)+1]),a.uvs[c].push(g[c][2*k]),a.uvs[c].push(g[c][2*k+1])})},addMorphTargets:function(b,c,d,e){if(0!==d.length){b.morphTargetsRelative=!0,b.morphAttributes.position=[];var f=this;d.forEach(function(d){d.rawTargets.forEach(function(d){var g=a.Objects.Geometry[d.geoID];void 0!==g&&f.genMorphGeometry(b,c,g,e,d.name)})})}},genMorphGeometry:function(a,b,c,d,e){var k,l,m,n,o,f=void 0!==b.PolygonVertexIndex?b.PolygonVertexIndex.a:[],g=void 0!==c.Vertices?c.Vertices.a:[],h=void 0!==c.Indexes?c.Indexes.a:[],i=3*a.attributes.position.count,j=new Float32Array(i);for(k=0;k<h.length;k++)l=3*h[k],j[l]=g[3*k],j[l+1]=g[3*k+1],j[l+2]=g[3*k+2];m={vertexIndices:f,vertexPositions:j},n=this.genBuffers(m),o=new THREE.Float32BufferAttribute(n.vertex,3),o.name=e||c.attrName,o.applyMatrix4(d),a.morphAttributes.position.push(o)},parseNormals:function(a){var b=a.MappingInformationType,c=a.ReferenceInformationType,d=a.Normals.a,e=[];return"IndexToDirect"===c&&("NormalIndex"in a?e=a.NormalIndex.a:"NormalsIndex"in a&&(e=a.NormalsIndex.a)),{dataSize:3,buffer:d,indices:e,mappingType:b,referenceType:c}},parseUVs:function(a){var b=a.MappingInformationType,c=a.ReferenceInformationType,d=a.UV.a,e=[];return"IndexToDirect"===c&&(e=a.UVIndex.a),{dataSize:2,buffer:d,indices:e,mappingType:b,referenceType:c}},parseVertexColors:function(a){var b=a.MappingInformationType,c=a.ReferenceInformationType,d=a.Colors.a,e=[];return"IndexToDirect"===c&&(e=a.ColorIndex.a),{dataSize:4,buffer:d,indices:e,mappingType:b,referenceType:c}},parseMaterialIndices:function(a){var d,e,f,b=a.MappingInformationType,c=a.ReferenceInformationType;if("NoMappingInformation"===b)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:c};for(d=a.Materials.a,e=[],f=0;f<d.length;++f)e.push(f);return{dataSize:1,buffer:d,indices:e,mappingType:b,referenceType:c}},parseNurbsGeometry:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;if(b=parseInt(a.Order),isNaN(b))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",a.Order,a.id),new THREE.BufferGeometry;for(c=b-1,d=a.KnotVector.a,e=[],f=a.Points.a,g=0,h=f.length;h>g;g+=4)e.push((new THREE.Vector4).fromArray(f,g));if("Closed"===a.Form)e.push(e[0]);else if("Periodic"===a.Form)for(i=c,j=d.length-1-i,g=0;c>g;++g)e.push(e[g]);return k=new THREE.NURBSCurve(c,d,e,i,j),l=k.getPoints(7*e.length),m=new Float32Array(3*l.length),l.forEach(function(a,b){a.toArray(m,3*b)}),n=new THREE.BufferGeometry,n.setAttribute("position",new THREE.BufferAttribute(m,3)),n}},g.prototype={constructor:g,parse:function(){var c,d,e,a=[],b=this.parseClips();if(void 0!==b)for(c in b)d=b[c],e=this.addClip(d),a.push(e);return a},parseClips:function(){var b,c,d;return void 0===a.Objects.AnimationCurve?void 0:(b=this.parseAnimationCurveNodes(),this.parseAnimationCurves(b),c=this.parseAnimationLayers(b),d=this.parseAnimStacks(c))},parseAnimationCurveNodes:function(){var d,e,f,b=a.Objects.AnimationCurveNode,c=new Map;for(d in b)e=b[d],null!==e.attrName.match(/S|R|T|DeformPercent/)&&(f={id:e.id,attr:e.attrName,curves:{}},c.set(f.id,f));return c},parseAnimationCurves:function(c){var e,f,g,h,i,d=a.Objects.AnimationCurve;for(e in d)f={id:d[e].id,times:d[e].KeyTime.a.map(o),values:d[e].KeyValueFloat.a},g=b.get(f.id),void 0!==g&&(h=g.parents[0].ID,i=g.parents[0].relationship,i.match(/X/)?c.get(h).curves["x"]=f:i.match(/Y/)?c.get(h).curves["y"]=f:i.match(/Z/)?c.get(h).curves["z"]=f:i.match(/d|DeformPercent/)&&c.has(h)&&(c.get(h).curves["morph"]=f))},parseAnimationLayers:function(d){var g,h,i,j,e=a.Objects.AnimationLayer,f=new Map;for(g in e)h=[],i=b.get(parseInt(g)),void 0!==i&&(j=i.children,j.forEach(function(e,f){var g,i,j,k,l,m,n;if(d.has(e.ID))if(g=d.get(e.ID),void 0!==g.curves.x||void 0!==g.curves.y||void 0!==g.curves.z){if(void 0===h[f]&&(i=b.get(e.ID).parents.filter(function(a){return void 0!==a.relationship})[0].ID,void 0!==i)){if(j=a.Objects.Model[i.toString()],void 0===j)return console.warn("THREE.FBXLoader: Encountered a unused curve.",e),void 0;k={modelName:j.attrName?THREE.PropertyBinding.sanitizeNodeName(j.attrName):"",ID:j.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]},c.traverse(function(a){a.ID===j.id&&(k.transform=a.matrix,a.userData.transformData&&(k.eulerOrder=a.userData.transformData.eulerOrder))}),k.transform||(k.transform=new THREE.Matrix4),"PreRotation"in j&&(k.preRotation=j.PreRotation.value),"PostRotation"in j&&(k.postRotation=j.PostRotation.value),h[f]=k}h[f]&&(h[f][g.attr]=g)}else void 0!==g.curves.morph&&(void 0===h[f]&&(l=b.get(e.ID).parents.filter(function(a){return void 0!==a.relationship})[0].ID,m=b.get(l).parents[0].ID,n=b.get(m).parents[0].ID,i=b.get(n).parents[0].ID,j=a.Objects.Model[i],k={modelName:j.attrName?THREE.PropertyBinding.sanitizeNodeName(j.attrName):"",morphName:a.Objects.Deformer[l].attrName},h[f]=k),h[f][g.attr]=g)}),f.set(parseInt(g),h));return f},parseAnimStacks:function(c){var f,g,h,d=a.Objects.AnimationStack,e={};for(f in d)g=b.get(parseInt(f)).children,g.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers."),h=c.get(g[0].ID),e[f]={name:d[f].attrName,layer:h};return e},addClip:function(a){var b=[],c=this;return a.layer.forEach(function(a){b=b.concat(c.generateTracks(a))}),new THREE.AnimationClip(a.name,-1,b)},generateTracks:function(a){var f,g,h,i,b=[],c=new THREE.Vector3,d=new THREE.Quaternion,e=new THREE.Vector3;return a.transform&&a.transform.decompose(c,d,e),c=c.toArray(),d=(new THREE.Euler).setFromQuaternion(d,a.eulerOrder).toArray(),e=e.toArray(),void 0!==a.T&&Object.keys(a.T.curves).length>0&&(f=this.generateVectorTrack(a.modelName,a.T.curves,c,"position"),void 0!==f&&b.push(f)),void 0!==a.R&&Object.keys(a.R.curves).length>0&&(g=this.generateRotationTrack(a.modelName,a.R.curves,d,a.preRotation,a.postRotation,a.eulerOrder),void 0!==g&&b.push(g)),void 0!==a.S&&Object.keys(a.S.curves).length>0&&(h=this.generateVectorTrack(a.modelName,a.S.curves,e,"scale"),void 0!==h&&b.push(h)),void 0!==a.DeformPercent&&(i=this.generateMorphTrack(a),void 0!==i&&b.push(i)),b},generateVectorTrack:function(a,b,c,d){var e=this.getTimesForAllAxes(b),f=this.getKeyframeTrackValues(e,b,c);return new THREE.VectorKeyframeTrack(a+"."+d,e,f)},generateRotationTrack:function(a,b,c,d,e,f){var g,h,i,j,k,l;for(void 0!==b.x&&(this.interpolateRotations(b.x),b.x.values=b.x.values.map(THREE.MathUtils.degToRad)),void 0!==b.y&&(this.interpolateRotations(b.y),b.y.values=b.y.values.map(THREE.MathUtils.degToRad)),void 0!==b.z&&(this.interpolateRotations(b.z),b.z.values=b.z.values.map(THREE.MathUtils.degToRad)),g=this.getTimesForAllAxes(b),h=this.getKeyframeTrackValues(g,b,c),void 0!==d&&(d=d.map(THREE.MathUtils.degToRad),d.push(f),d=(new THREE.Euler).fromArray(d),d=(new THREE.Quaternion).setFromEuler(d)),void 0!==e&&(e=e.map(THREE.MathUtils.degToRad),e.push(f),e=(new THREE.Euler).fromArray(e),e=(new THREE.Quaternion).setFromEuler(e).invert()),i=new THREE.Quaternion,j=new THREE.Euler,k=[],l=0;l<h.length;l+=3)j.set(h[l],h[l+1],h[l+2],f),i.setFromEuler(j),void 0!==d&&i.premultiply(d),void 0!==e&&i.multiply(e),i.toArray(k,4*(l/3));
return new THREE.QuaternionKeyframeTrack(a+".quaternion",g,k)},generateMorphTrack:function(a){var b=a.DeformPercent.curves.morph,d=b.values.map(function(a){return a/100}),e=c.getObjectByName(a.modelName).morphTargetDictionary[a.morphName];return new THREE.NumberKeyframeTrack(a.modelName+".morphTargetInfluences["+e+"]",b.times,d)},getTimesForAllAxes:function(a){var c,d,e,f,b=[];if(void 0!==a.x&&(b=b.concat(a.x.times)),void 0!==a.y&&(b=b.concat(a.y.times)),void 0!==a.z&&(b=b.concat(a.z.times)),b=b.sort(function(a,b){return a-b}),b.length>1){for(c=1,d=b[0],e=1;e<b.length;e++)f=b[e],f!==d&&(b[c]=f,d=f,c++);b=b.slice(0,c)}return b},getKeyframeTrackValues:function(a,b,c){var d=c,e=[],f=-1,g=-1,h=-1;return a.forEach(function(a){var c,i,j;b.x&&(f=b.x.times.indexOf(a)),b.y&&(g=b.y.times.indexOf(a)),b.z&&(h=b.z.times.indexOf(a)),-1!==f?(c=b.x.values[f],e.push(c),d[0]=c):e.push(d[0]),-1!==g?(i=b.y.values[g],e.push(i),d[1]=i):e.push(d[1]),-1!==h?(j=b.z.values[h],e.push(j),d[2]=j):e.push(d[2])}),e},interpolateRotations:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(b=1;b<a.values.length;b++)if(c=a.values[b-1],d=a.values[b]-c,e=Math.abs(d),e>=180){for(f=e/180,g=d/f,h=c+g,i=a.times[b-1],j=a.times[b]-i,k=j/f,l=i+k,m=[],n=[];l<a.times[b];)m.push(l),l+=k,n.push(h),h+=g;a.times=z(a.times,b,m),a.values=z(a.values,b,n)}}},h.prototype={constructor:h,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(a){this.nodeStack.push(a),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(a,b){this.currentProp=a,this.currentPropName=b},parse:function(a){var b,c;return this.currentIndent=0,this.allNodes=new k,this.nodeStack=[],this.currentProp=[],this.currentPropName="",b=this,c=a.split(/[\r\n]+/),c.forEach(function(a,d){var g,h,i,e=a.match(/^[\s\t]*;/),f=a.match(/^[\s\t]*$/);e||f||(g=a.match("^\\t{"+b.currentIndent+"}(\\w+):(.*){",""),h=a.match("^\\t{"+b.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),i=a.match("^\\t{"+(b.currentIndent-1)+"}}"),g?b.parseNodeBegin(a,g):h?b.parseNodeProperty(a,h,c[++d]):i?b.popStack():a.match(/^[^\s\t}]/)&&b.parseNodePropertyContinued(a))}),this.allNodes},parseNodeBegin:function(a,b){var c=b[1].trim().replace(/^"/,"").replace(/"$/,""),d=b[2].split(",").map(function(a){return a.trim().replace(/^"/,"").replace(/"$/,"")}),e={name:c},f=this.parseNodeAttr(d),g=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(c,e):c in g?("PoseNode"===c?g.PoseNode.push(e):void 0!==g[c].id&&(g[c]={},g[c][g[c].id]=g[c]),""!==f.id&&(g[c][f.id]=e)):"number"==typeof f.id?(g[c]={},g[c][f.id]=e):"Properties70"!==c&&(g[c]="PoseNode"===c?[e]:e),"number"==typeof f.id&&(e.id=f.id),""!==f.name&&(e.attrName=f.name),""!==f.type&&(e.attrType=f.type),this.pushStack(e)},parseNodeAttr:function(a){var c,d,b=a[0];return""!==a[0]&&(b=parseInt(a[0]),isNaN(b)&&(b=a[0])),c="",d="",a.length>1&&(c=a[1].replace(/^(\w+)::/,""),d=a[2]),{id:b,name:c,type:d}},parseNodeProperty:function(a,b,c){var f,g,h,i,j,k,d=b[1].replace(/^"/,"").replace(/"$/,"").trim(),e=b[2].replace(/^"/,"").replace(/"$/,"").trim();return"Content"===d&&","===e&&(e=c.replace(/"/g,"").replace(/,$/,"").trim()),f=this.getCurrentNode(),g=f.name,"Properties70"===g?(this.parseNodeSpecialProperty(a,d,e),void 0):("C"===d&&(h=e.split(",").slice(1),i=parseInt(h[0]),j=parseInt(h[1]),k=e.split(",").slice(3),k=k.map(function(a){return a.trim().replace(/^"/,"")}),d="connections",e=[i,j],x(e,k),void 0===f[d]&&(f[d]=[])),"Node"===d&&(f.id=e),d in f&&Array.isArray(f[d])?f[d].push(e):"a"!==d?f[d]=e:f.a=e,this.setCurrentProp(f,d),"a"===d&&","!==e.slice(-1)&&(f.a=v(e)),void 0)},parseNodePropertyContinued:function(a){var b=this.getCurrentNode();b.a+=a,","!==a.slice(-1)&&(b.a=v(b.a))},parseNodeSpecialProperty:function(a,b,c){var d=c.split('",').map(function(a){return a.trim().replace(/^\"/,"").replace(/\s/,"_")}),e=d[0],f=d[1],g=d[2],h=d[3],i=d[4];switch(f){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":i=parseFloat(i);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":i=v(i)}this.getPrevNode()[e]={type:f,type2:g,flag:h,value:i},this.setCurrentProp(this.getPrevNode(),e)}},i.prototype={constructor:i,parse:function(a){var c,d,e,b=new j(a);if(b.skip(23),c=b.getUint32(),6400>c)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+c);for(d=new k;!this.endOfContent(b);)e=this.parseNode(b,c),null!==e&&d.add(e.name,e);return d},endOfContent:function(a){return 0===a.size()%16?(-16&a.getOffset()+160+16)>=a.size():a.getOffset()+160+16>=a.size()},parseNode:function(a,b){var f,g,h,i,j,k,l,m,c={},d=b>=7500?a.getUint64():a.getUint32(),e=b>=7500?a.getUint64():a.getUint32();if(b>=7500?a.getUint64():a.getUint32(),f=a.getUint8(),g=a.getString(f),0===d)return null;for(h=[],i=0;e>i;i++)h.push(this.parseProperty(a));for(j=h.length>0?h[0]:"",k=h.length>1?h[1]:"",l=h.length>2?h[2]:"",c.singleProperty=1===e&&a.getOffset()===d?!0:!1;d>a.getOffset();)m=this.parseNode(a,b),null!==m&&this.parseSubNode(g,c,m);return c.propertyList=h,"number"==typeof j&&(c.id=j),""!==k&&(c.attrName=k),""!==l&&(c.attrType=l),""!==g&&(c.name=g),c},parseSubNode:function(a,b,c){var d,e,f,g,h,i,j,k;c.singleProperty===!0?(d=c.propertyList[0],Array.isArray(d)?(b[c.name]=c,c.a=d):b[c.name]=d):"Connections"===a&&"C"===c.name?(e=[],c.propertyList.forEach(function(a,b){0!==b&&e.push(a)}),void 0===b.connections&&(b.connections=[]),b.connections.push(e)):"Properties70"===c.name?(f=Object.keys(c),f.forEach(function(a){b[a]=c[a]})):"Properties70"===a&&"P"===c.name?(g=c.propertyList[0],h=c.propertyList[1],i=c.propertyList[2],j=c.propertyList[3],0===g.indexOf("Lcl ")&&(g=g.replace("Lcl ","Lcl_")),0===h.indexOf("Lcl ")&&(h=h.replace("Lcl ","Lcl_")),k="Color"===h||"ColorRGB"===h||"Vector"===h||"Vector3D"===h||0===h.indexOf("Lcl_")?[c.propertyList[4],c.propertyList[5],c.propertyList[6]]:c.propertyList[4],b[g]={type:h,type2:i,flag:j,value:k}):void 0===b[c.name]?"number"==typeof c.id?(b[c.name]={},b[c.name][c.id]=c):b[c.name]=c:"PoseNode"===c.name?(Array.isArray(b[c.name])||(b[c.name]=[b[c.name]]),b[c.name].push(c)):void 0===b[c.name][c.id]&&(b[c.name][c.id]=c)},parseProperty:function(a){var c,d,e,f,g,h,b=a.getString(1);switch(b){case"C":return a.getBoolean();case"D":return a.getFloat64();case"F":return a.getFloat32();case"I":return a.getInt32();case"L":return a.getInt64();case"R":return c=a.getUint32(),a.getArrayBuffer(c);case"S":return c=a.getUint32(),a.getString(c);case"Y":return a.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":if(d=a.getUint32(),e=a.getUint32(),f=a.getUint32(),0===e)switch(b){case"b":case"c":return a.getBooleanArray(d);case"d":return a.getFloat64Array(d);case"f":return a.getFloat32Array(d);case"i":return a.getInt32Array(d);case"l":return a.getInt64Array(d)}switch("undefined"==typeof fflate&&console.error("THREE.FBXLoader: External library fflate.min.js required."),g=fflate.unzlibSync(new Uint8Array(a.getArrayBuffer(f))),h=new j(g.buffer),b){case"b":case"c":return h.getBooleanArray(d);case"d":return h.getFloat64Array(d);case"f":return h.getFloat32Array(d);case"i":return h.getInt32Array(d);case"l":return h.getInt64Array(d)}default:throw new Error("THREE.FBXLoader: Unknown property type "+b)}}},j.prototype={constructor:j,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(a){this.offset+=a},getBoolean:function(){return 1===(1&this.getUint8())},getBooleanArray:function(a){var c,b=[];for(c=0;a>c;c++)b.push(this.getBoolean());return b},getUint8:function(){var a=this.dv.getUint8(this.offset);return this.offset+=1,a},getInt16:function(){var a=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,a},getInt32:function(){var a=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,a},getInt32Array:function(a){var c,b=[];for(c=0;a>c;c++)b.push(this.getInt32());return b},getUint32:function(){var a=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,a},getInt64:function(){var a,b;return this.littleEndian?(a=this.getUint32(),b=this.getUint32()):(b=this.getUint32(),a=this.getUint32()),2147483648&b?(b=4294967295&~b,a=4294967295&~a,4294967295===a&&(b=4294967295&b+1),a=4294967295&a+1,-(4294967296*b+a)):4294967296*b+a},getInt64Array:function(a){var c,b=[];for(c=0;a>c;c++)b.push(this.getInt64());return b},getUint64:function(){var a,b;return this.littleEndian?(a=this.getUint32(),b=this.getUint32()):(b=this.getUint32(),a=this.getUint32()),4294967296*b+a},getFloat32:function(){var a=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,a},getFloat32Array:function(a){var c,b=[];for(c=0;a>c;c++)b.push(this.getFloat32());return b},getFloat64:function(){var a=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,a},getFloat64Array:function(a){var c,b=[];for(c=0;a>c;c++)b.push(this.getFloat64());return b},getArrayBuffer:function(a){var b=this.dv.buffer.slice(this.offset,this.offset+a);return this.offset+=a,b},getString:function(a){var c,d,b=[];for(c=0;a>c;c++)b[c]=this.getUint8();return d=b.indexOf(0),d>=0&&(b=b.slice(0,d)),THREE.LoaderUtils.decodeText(new Uint8Array(b))}},k.prototype={constructor:k,add:function(a,b){this[a]=b}},p=[],r=new THREE.Euler,s=new THREE.Vector3,d}();

const Canvas2Image=(function(){const $support=(function(){const canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");return{canvas:!!ctx,imageData:!!ctx.getImageData,dataURL:!!canvas.toDataURL,btoa:!!window.btoa,};})();const downloadMime="image/octet-stream";function scaleCanvas(canvas,width,height){const w=canvas.width,h=canvas.height;if(width===undefined){width=w;}
if(height===undefined){height=h;}
let retCanvas=document.createElement("canvas");let retCtx=retCanvas.getContext("2d");retCanvas.width=width;retCanvas.height=height;retCtx.drawImage(canvas,0,0,w,h,0,0,width,height);return retCanvas;}
function getDataURL(canvas,type,width,height){canvas=scaleCanvas(canvas,width,height);return canvas.toDataURL(type);}
function saveFile(strData,fileType,fileName="name"){let saveLink=document.createElement("a");saveLink.download=fileName+"."+fileType;saveLink.href=strData;saveLink.click();}
function genImage(strData){let img=document.createElement("img");img.src=strData;return img;}
function fixType(type){type=type.toLowerCase().replace(/jpg/i,"jpeg");const r=type.match(/png|jpeg|bmp|gif/)[0];return"image/"+r;}
function encodeData(data){if(!window.btoa){throw"btoa undefined";}
let str="";if(typeof data=="string"){str=data;}else{for(let i=0;i<data.length;i++){str+=String.fromCharCode(data[i]);}}
return btoa(str);}
function getImageData(canvas){const w=canvas.width,h=canvas.height;return canvas.getContext("2d").getImageData(0,0,w,h);}
function makeURI(strData,type){return"data:"+type+";base64,"+strData;}
const genBitmapImage=function(oData){const biWidth=oData.width;const biHeight=oData.height;const biSizeImage=biWidth*biHeight*3;const bfSize=biSizeImage+54;const BITMAPFILEHEADER=[0x42,0x4d,bfSize&0xff,(bfSize>>8)&0xff,(bfSize>>16)&0xff,(bfSize>>24)&0xff,0,0,0,0,54,0,0,0,];const BITMAPINFOHEADER=[40,0,0,0,biWidth&0xff,(biWidth>>8)&0xff,(biWidth>>16)&0xff,(biWidth>>24)&0xff,biHeight&0xff,(biHeight>>8)&0xff,(biHeight>>16)&0xff,(biHeight>>24)&0xff,1,0,24,0,0,0,0,0,biSizeImage&0xff,(biSizeImage>>8)&0xff,(biSizeImage>>16)&0xff,(biSizeImage>>24)&0xff,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,];const iPadding=(4-((biWidth*3)%4))%4;const aImgData=oData.data;let strPixelData="";const biWidth4=biWidth<<2;let y=biHeight;const fromCharCode=String.fromCharCode;do{const iOffsetY=biWidth4*(y-1);let strPixelRow="";for(let x=0;x<biWidth;x++){const iOffsetX=x<<2;strPixelRow+=fromCharCode(aImgData[iOffsetY+iOffsetX+2])+
fromCharCode(aImgData[iOffsetY+iOffsetX+1])+
fromCharCode(aImgData[iOffsetY+iOffsetX]);}
for(let c=0;c<iPadding;c++){strPixelRow+=String.fromCharCode(0);}
strPixelData+=strPixelRow;}while(--y);return(encodeData(BITMAPFILEHEADER.concat(BITMAPINFOHEADER))+
encodeData(strPixelData));};const saveAsImage=function(canvas,width,height,type,fileName){const fileType=type;if($support.canvas&&$support.dataURL){if(typeof canvas=="string"){canvas=document.getElementById(canvas);}
if(type===undefined){type="png";}
type=fixType(type);if(/bmp/.test(type)){const data=getImageData(scaleCanvas(canvas,width,height));const strData=genBitmapImage(data);saveFile(makeURI(strData,downloadMime),fileType,fileName);}else{const strData=getDataURL(canvas,type,width,height);saveFile(strData.replace(type,downloadMime),fileType,fileName);}}};const convertToImage=function(canvas,width,height,type){if($support.canvas&&$support.dataURL){if(typeof canvas=="string"){canvas=document.getElementById(canvas);}
if(type===undefined){type="png";}
type=fixType(type);if(/bmp/.test(type)){const data=getImageData(scaleCanvas(canvas,width,height));const strData=genBitmapImage(data);return genImage(makeURI(strData,"image/bmp"));}else{const strData=getDataURL(canvas,type,width,height);return genImage(strData);}}};return{saveAsImage:saveAsImage,saveAsPNG:function(canvas,width,height,fileName){return saveAsImage(canvas,width,height,"png",fileName);},saveAsJPEG:function(canvas,width,height,fileName){return saveAsImage(canvas,width,height,"jpeg",fileName);},saveAsGIF:function(canvas,width,height,fileName){return saveAsImage(canvas,width,height,"gif",fileName);},saveAsBMP:function(canvas,width,height,fileName){return saveAsImage(canvas,width,height,"bmp",fileName);},convertToImage:convertToImage,convertToPNG:function(canvas,width,height){return convertToImage(canvas,width,height,"png");},convertToJPEG:function(canvas,width,height){return convertToImage(canvas,width,height,"jpeg");},convertToGIF:function(canvas,width,height){return convertToImage(canvas,width,height,"gif");},convertToBMP:function(canvas,width,height){return convertToImage(canvas,width,height,"bmp");},};})();